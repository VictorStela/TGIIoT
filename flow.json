[{"id":"1f65e450.19ba9c","type":"tab","label":"Desabilitado","disabled":true,"info":""},{"id":"b5ab8ba.7eb7578","type":"tab","label":"Inicialização","disabled":false,"info":""},{"id":"b1828f58.199e6","type":"tab","label":"TryCatch","disabled":false,"info":""},{"id":"49ecca28.ef9cc4","type":"tab","label":"SKU","disabled":false,"info":""},{"id":"7e8bd831.628288","type":"tab","label":"Ordem","disabled":false,"info":""},{"id":"93413fb0.966e1","type":"tab","label":"Produção","disabled":false,"info":""},{"id":"fa212271.2d00f","type":"tab","label":"Operacional","disabled":false,"info":""},{"id":"7cb4d8dd.834de8","type":"tab","label":"DB Update","disabled":false,"info":""},{"id":"75378547.fac50c","type":"subflow","name":"Persistence Helper","info":"","in":[{"x":45.5,"y":85,"wires":[{"id":"7e59d012.5605e"}]}],"out":[{"x":749.5,"y":53,"wires":[{"id":"aff39338.12aa4","port":0}]},{"x":755,"y":169,"wires":[{"id":"d6c96f3.73c199","port":0}]}]},{"id":"deb5e2ac.bf7d9","type":"ui_tab","z":"","name":"Receitas","icon":"receipt","order":2,"disabled":false,"hidden":false},{"id":"62eb2591.81fb2c","type":"ui_group","z":"","name":"Criar SKU","tab":"deb5e2ac.bf7d9","order":2,"disp":true,"width":"18","collapse":false},{"id":"90d07383.5a36","type":"cloudant","z":"","host":"8c46d960-1fe3-4931-a83e-2c1842052ecb-bluemix.cloudant.com","name":"BD Cloudant"},{"id":"1fcaf060.6cd5f","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"Lucida Sans Typewriter,Lucida Console,Monaco,monospace","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"IIoT","default":"#4B7930","baseColor":"#4a755e","baseFont":"Lucida Sans Typewriter,Lucida Console,Monaco,monospace","reset":false},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":true},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":true},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":true},"group-textColor":{"value":"#1bbfff","edited":true},"group-borderColor":{"value":"#ffffff","edited":true},"group-backgroundColor":{"value":"#ffffff","edited":true},"widget-textColor":{"value":"#111111","edited":true},"widget-backgroundColor":{"value":"#0094ce","edited":true},"widget-borderColor":{"value":"#ffffff","edited":true},"base-font":{"value":"Lucida Sans Typewriter,Lucida Console,Monaco,monospace"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"485819ea.514d78","type":"ui_group","z":"","name":"Alterar SKU","tab":"deb5e2ac.bf7d9","order":3,"disp":true,"width":"18","collapse":false},{"id":"8179319f.da615","type":"ui_group","z":"","name":"Abrir ordem","tab":"a26260b5.0c7c5","order":3,"disp":true,"width":"18","collapse":true},{"id":"a26260b5.0c7c5","type":"ui_tab","z":"","name":"Ordem","icon":"archive","order":3,"disabled":false,"hidden":false},{"id":"bd160cb1.3394e","type":"ui_group","z":"","name":"Consultar ordem","tab":"a26260b5.0c7c5","order":2,"disp":true,"width":"18","collapse":false},{"id":"141a5297.cc40fd","type":"ui_group","z":"","name":"Selecionar SKU","tab":"deb5e2ac.bf7d9","order":1,"disp":false,"width":"6","collapse":false},{"id":"ac03d5c3.0df428","type":"ui_spacer","name":"spacer","group":"141a5297.cc40fd","order":1,"width":"1","height":"5"},{"id":"4bb83922.d144c8","type":"ui_spacer","name":"spacer","group":"141a5297.cc40fd","order":2,"width":"5","height":1},{"id":"b2d9c17f.f4c43","type":"ui_spacer","name":"spacer","group":"141a5297.cc40fd","order":8,"width":"5","height":1},{"id":"75f697ce.0b2378","type":"ui_group","z":"","name":"Deletar SKU","tab":"deb5e2ac.bf7d9","disp":true,"width":"18","collapse":false},{"id":"89d6e588.8cf598","type":"ui_spacer","name":"spacer","group":"485819ea.514d78","order":5,"width":"16","height":"2"},{"id":"3915cecb.4b6d32","type":"ui_group","z":"","name":"Selecionar Ordem","tab":"a26260b5.0c7c5","order":1,"disp":false,"width":"6","collapse":false},{"id":"b25ef2bb.d769d","type":"ui_spacer","name":"spacer","group":"3915cecb.4b6d32","order":1,"width":1,"height":"18"},{"id":"92e29cb6.6be8","type":"ui_spacer","name":"spacer","group":"3915cecb.4b6d32","order":2,"width":"5","height":1},{"id":"4c47a616.9a8898","type":"ui_spacer","name":"spacer","group":"3915cecb.4b6d32","order":12,"width":"5","height":1},{"id":"f52d6df9.0e76b","type":"ui_spacer","name":"spacer","group":"75f697ce.0b2378","order":2,"width":"18","height":"1"},{"id":"711cf87f.3b7128","type":"ui_tab","z":"","name":"Produção","icon":"fa-gears","order":1,"disabled":false,"hidden":false},{"id":"b11f2258.53dd7","type":"ui_group","z":"","name":"Quadro de Produção","tab":"711cf87f.3b7128","order":3,"disp":true,"width":"18","collapse":false},{"id":"361751bb.55a20e","type":"ui_group","z":"","name":"Selecionar Linha","tab":"711cf87f.3b7128","order":1,"disp":false,"width":"6","collapse":false},{"id":"ac58133c.5d745","type":"ui_spacer","name":"spacer","group":"361751bb.55a20e","order":2,"width":"5","height":1},{"id":"542f9b8d.5a2944","type":"ui_spacer","name":"spacer","group":"361751bb.55a20e","order":12,"width":"5","height":1},{"id":"a390ef0a.a4e46","type":"ui_spacer","name":"spacer","group":"361751bb.55a20e","order":1,"width":1,"height":"20"},{"id":"db01d65c.4c9438","type":"ui_spacer","name":"spacer","group":"b11f2258.53dd7","order":4,"width":1,"height":1},{"id":"91ae1a41.8ce6b8","type":"ui_spacer","name":"spacer","group":"a54e7e9e.9e2a4","order":5,"width":"1","height":"2"},{"id":"94b61342.9d906","type":"ui_spacer","name":"spacer","group":"b11f2258.53dd7","order":2,"width":1,"height":1},{"id":"21a5ccec.8b4e44","type":"ui_spacer","name":"spacer","group":"a54e7e9e.9e2a4","order":3,"width":"1","height":"2"},{"id":"b9023ceb.e0d6c","type":"ui_spacer","name":"spacer","group":"a54e7e9e.9e2a4","order":1,"width":1,"height":"2"},{"id":"b986e756.3275e8","type":"ui_spacer","name":"spacer","group":"aa1d9824.087868","order":3,"width":1,"height":1},{"id":"79937ea6.15758","type":"ui_spacer","name":"spacer","group":"aa1d9824.087868","order":2,"width":1,"height":1},{"id":"a54e7e9e.9e2a4","type":"ui_group","z":"","name":"OEE","tab":"711cf87f.3b7128","order":3,"disp":false,"width":"18","collapse":false},{"id":"f8a4e06.64dd62","type":"ui_group","z":"","name":"Produção","tab":"711cf87f.3b7128","order":4,"disp":false,"width":"18","collapse":false},{"id":"6e9d9f1d.0385b","type":"ui_group","z":"","name":"Disponibilidade","tab":"711cf87f.3b7128","order":5,"disp":false,"width":"18","collapse":false},{"id":"e3b6e43b.656848","type":"ui_group","z":"","name":"Performance","tab":"711cf87f.3b7128","order":6,"disp":false,"width":"18","collapse":false},{"id":"d1d93dce.5c52e","type":"ui_group","z":"","name":"Qualidade","tab":"711cf87f.3b7128","order":7,"disp":false,"width":"18","collapse":false},{"id":"ed31f2b1.1e3b4","type":"ui_group","z":"","name":"Perdas","tab":"711cf87f.3b7128","order":8,"disp":false,"width":"18","collapse":false},{"id":"a3d59ae2.60f788","type":"ui_spacer","name":"spacer","group":"361751bb.55a20e","order":15,"width":1,"height":1},{"id":"de5fc37d.9535f","type":"ui_group","z":"","name":"OEE Acc","tab":"711cf87f.3b7128","order":9,"disp":false,"width":"18","collapse":false},{"id":"37736700.5f0f4a","type":"ui_group","z":"","name":"Produção","tab":"a26260b5.0c7c5","order":4,"disp":false,"width":"18","collapse":false},{"id":"7e36fb82.8439e4","type":"ui_group","z":"","name":"Disponibilidade","tab":"a26260b5.0c7c5","order":5,"disp":false,"width":"18","collapse":false},{"id":"20e514ad.116bcc","type":"ui_group","z":"","name":"Performance","tab":"a26260b5.0c7c5","order":6,"disp":false,"width":"18","collapse":false},{"id":"7d65e4f9.12b05c","type":"ui_group","z":"","name":"Qualidade","tab":"a26260b5.0c7c5","order":7,"disp":false,"width":"18","collapse":false},{"id":"b7adbefb.bd68e","type":"ui_group","z":"","name":"Perdas","tab":"a26260b5.0c7c5","order":8,"disp":false,"width":"18","collapse":false},{"id":"955a3b7a.3b7f88","type":"ui_group","z":"","name":"OEE Acc","tab":"a26260b5.0c7c5","order":9,"disp":false,"width":"18","collapse":false},{"id":"7a012799.9bd2c8","type":"ui_group","z":"","name":"Data","tab":"a26260b5.0c7c5","order":10,"disp":false,"width":"18","collapse":false},{"id":"66ab7d87.dcb504","type":"ui_spacer","name":"spacer","group":"7a012799.9bd2c8","order":2,"width":"6","height":1},{"id":"6ac8aa2c.1d93b4","type":"ui_spacer","name":"spacer","group":"7a012799.9bd2c8","order":4,"width":"6","height":1},{"id":"feeaee76.3b461","type":"ui_spacer","name":"spacer","group":"bd160cb1.3394e","order":4,"width":"10","height":1},{"id":"4dc7323.a1177cc","type":"ui_group","z":"","name":"Pareto","tab":"711cf87f.3b7128","order":10,"disp":false,"width":"18","collapse":false},{"id":"56ed9179.96185","type":"ui_group","z":"","name":"Pareto","tab":"a26260b5.0c7c5","order":11,"disp":false,"width":"18","collapse":false},{"id":"2cfb9136.b0c45e","type":"ui_form","z":"49ecca28.ef9cc4","name":"","label":"","group":"62eb2591.81fb2c","order":1,"width":0,"height":0,"options":[{"label":"Nome do SKU","value":"sku","type":"text","required":true},{"label":"Velocidade padrão (pçs/min)","value":"velocidade","type":"number","required":true},{"label":"Ativo","value":"estado","type":"switch","required":true}],"formValue":{"sku":"","velocidade":"","estado":false},"payload":"","submit":"Salvar","cancel":"Limpar","topic":"","x":170,"y":300,"wires":[["c89c5d22.a7511"]]},{"id":"497f304e.70cbb","type":"cloudant out","z":"49ecca28.ef9cc4","name":"Salvar SKU","cloudant":"90d07383.5a36","database":"listadesku","service":"_ext_","payonly":false,"operation":"insert","x":890,"y":300,"wires":[]},{"id":"881811d5.21d58","type":"function","z":"49ecca28.ef9cc4","name":"Cria ciclo e _id","func":"var lista = global.get('listaSku') || [];\nvar index = lista.length\nvar msg1 = []\nfor(index in lista){\n    if(msg.payload.sku === lista[index]){\n        msg1 = { \"payload\": 'Este SKU já é cadastrado'};\n        return [null,msg1]\n    } \n}\nmsg.payload.ciclo = parseInt((msg.payload.velocidade / 60)*1000)/1000;\nreturn [msg,null];\n","outputs":2,"noerr":0,"x":680,"y":300,"wires":[["497f304e.70cbb","ee21c467.60e158","9d55bf06.0693d"],["c42786ce.a68428"]]},{"id":"6a74e635.460d18","type":"moment","z":"49ecca28.ef9cc4","name":"Data","topic":"","input":"","inputType":"date","inTz":"America/Sao_Paulo","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD/MM/YYYY - HH:mm:ss","locale":"pt_BR","output":"payload.data","outputType":"msg","outTz":"America/Sao_Paulo","x":490,"y":300,"wires":[["881811d5.21d58"]]},{"id":"317c7761.2c0f48","type":"cloudant in","z":"49ecca28.ef9cc4","name":"Consulta SKU","cloudant":"90d07383.5a36","database":"listadesku","service":"_ext_","search":"_all_","design":"","index":"","x":510,"y":120,"wires":[["14d3f64b.fbc96a"]]},{"id":"6b904b6d.f387c4","type":"comment","z":"49ecca28.ef9cc4","name":"Criar um novo SKU","info":"Criar um novo SKU","x":210,"y":200,"wires":[]},{"id":"24b0d504.80da4a","type":"comment","z":"49ecca28.ef9cc4","name":"Seleciona um SKU para deletar","info":"Seleciona um SKU para deletar","x":250,"y":400,"wires":[]},{"id":"2ffc2fbf.07eb4","type":"ui_dropdown","z":"49ecca28.ef9cc4","name":"Droplist deletar SKU","label":"Selecione um SKU para apagar","tooltip":"","place":"Selecione um SKU","group":"75f697ce.0b2378","order":1,"width":0,"height":0,"passthru":false,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":500,"y":460,"wires":[["1e7ab9b6.774db6"]]},{"id":"a7b8fbce.99ddf8","type":"ui_button","z":"49ecca28.ef9cc4","name":"Limpar","group":"75f697ce.0b2378","order":3,"width":"4","height":"1","passthru":false,"label":"Cancelar","tooltip":"","color":"","bgcolor":"","icon":"cancel","payload":"null","payloadType":"json","topic":"","x":170,"y":500,"wires":[["2ffc2fbf.07eb4"]]},{"id":"54e0f6c8.389fc8","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"deletarSKU","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":460,"wires":[[]]},{"id":"46aabcc5.006ed4","type":"ui_button","z":"49ecca28.ef9cc4","name":"Apagar","group":"75f697ce.0b2378","order":4,"width":"4","height":"1","passthru":false,"label":"Apagar","tooltip":"","color":"","bgcolor":"","icon":"delete","payload":"null","payloadType":"json","topic":"","x":180,"y":560,"wires":[["af3b5319.53d54","633f1ba5.420bb4","2ffc2fbf.07eb4"]]},{"id":"af3b5319.53d54","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"deletarSKU","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":520,"wires":[["66d99031.ea83c"]]},{"id":"66d99031.ea83c","type":"cloudant in","z":"49ecca28.ef9cc4","name":"Consulta SKU","cloudant":"90d07383.5a36","database":"listadesku","service":"_ext_","search":"_id_","design":"","index":"","x":710,"y":520,"wires":[["ab2ae5e7.aff1c8","4fcc4ad0.812764"]]},{"id":"ab2ae5e7.aff1c8","type":"cloudant out","z":"49ecca28.ef9cc4","name":"Deletar SKU","cloudant":"90d07383.5a36","database":"listadesku","service":"_ext_","payonly":false,"operation":"delete","x":920,"y":520,"wires":[]},{"id":"b1040f1b.863f5","type":"change","z":"49ecca28.ef9cc4","name":"Limpa payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":120,"wires":[["317c7761.2c0f48"]]},{"id":"4af72fce.bb7a9","type":"comment","z":"49ecca28.ef9cc4","name":"Alterar SKU","info":"Alterar SKU","x":190,"y":640,"wires":[]},{"id":"adf16cf6.ad84e","type":"ui_dropdown","z":"49ecca28.ef9cc4","name":"Droplist alterar SKU","label":"Selecione um SKU para alterar","tooltip":"","place":"Selecione um SKU","group":"485819ea.514d78","order":1,"width":0,"height":0,"passthru":false,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":300,"y":760,"wires":[["27922ce8.7d5244"]]},{"id":"3bbc91d2.95a70e","type":"function","z":"49ecca28.ef9cc4","name":"Escreve lista","func":"var lista = global.get(\"listaSku\") || [];\nvar listaatual = flow.get('listaSkuAtual') || [];\nif (lista.length != listaatual.length){\n    flow.set('listaSkuAtual',lista);\n    return msg;\n}","outputs":1,"noerr":0,"x":950,"y":100,"wires":[["7c8e98.28458168"]]},{"id":"94d1bfa9.e87e2","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"alterarSKU","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":760,"wires":[["90adfa82.aa99f8"]]},{"id":"90adfa82.aa99f8","type":"cloudant in","z":"49ecca28.ef9cc4","name":"Consulta SKU","cloudant":"90d07383.5a36","database":"listadesku","service":"_ext_","search":"_id_","design":"","index":"","x":970,"y":760,"wires":[["68aa8376.6df53c","e4a09676.5108a8"]]},{"id":"68aa8376.6df53c","type":"function","z":"49ecca28.ef9cc4","name":"Split","func":"var msg1 = { payload: msg.payload.payload.sku,\n             enabled: true};\nvar msg2 = { payload: msg.payload.payload.velocidade,\n             enabled: true};\nvar msg3 = { payload: msg.payload.payload.estado,\n             enabled: true};\nvar msg4 = { payload: msg.payload.payload.data};\n\nreturn [msg1,msg2,msg3,msg4];","outputs":4,"noerr":0,"x":1170,"y":760,"wires":[["84b98fa9.131ab"],["6749a804.460438"],["47993d78.1201c4"],["b8e873f2.f798c"]]},{"id":"84b98fa9.131ab","type":"ui_text_input","z":"49ecca28.ef9cc4","name":"Nome do SKU","label":"Nome do SKU","tooltip":"","group":"485819ea.514d78","order":2,"width":0,"height":0,"passthru":true,"mode":"text","delay":"0","topic":"","x":1400,"y":720,"wires":[["897db7f2.526ee8"]]},{"id":"6749a804.460438","type":"ui_text_input","z":"49ecca28.ef9cc4","name":"Velocidade do SKU","label":"Velocidade do SKU (pç/min)","tooltip":"","group":"485819ea.514d78","order":3,"width":0,"height":0,"passthru":true,"mode":"number","delay":"0","topic":"","x":1410,"y":760,"wires":[["7e8cff8f.2c71"]]},{"id":"897db7f2.526ee8","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"novoNomeSKU","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1610,"y":720,"wires":[[]]},{"id":"7e8cff8f.2c71","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"novaVelocidadeSKU","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1640,"y":760,"wires":[[]]},{"id":"6d2794d8.22c80c","type":"ui_button","z":"49ecca28.ef9cc4","name":"Limpar","group":"485819ea.514d78","order":9,"width":"4","height":"1","passthru":false,"label":"Cancelar","tooltip":"","color":"","bgcolor":"","icon":"cancel","payload":" null","payloadType":"num","topic":"","x":150,"y":920,"wires":[["76e9ea64.a60f44","adf16cf6.ad84e"]]},{"id":"bd9f864d.3678f8","type":"comment","z":"49ecca28.ef9cc4","name":"Remonta lista de SKU global","info":"Inicialização e refresh","x":230,"y":40,"wires":[]},{"id":"ad4f101d.33aaf","type":"ui_button","z":"49ecca28.ef9cc4","name":"Alterar","group":"485819ea.514d78","order":11,"width":"4","height":"1","passthru":false,"label":"Alterar","tooltip":"","color":"","bgcolor":"","icon":"autorenew","payload":"null","payloadType":"num","topic":"","x":150,"y":840,"wires":[["797899a0.d17868","efd0cd29.71a93","adf16cf6.ad84e"]]},{"id":"c4e16a49.5c8098","type":"cloudant out","z":"49ecca28.ef9cc4","name":"Salvar SKU","cloudant":"90d07383.5a36","database":"listadesku","service":"_ext_","payonly":false,"operation":"insert","x":910,"y":840,"wires":[]},{"id":"4061ff31.9db4b","type":"function","z":"49ecca28.ef9cc4","name":"Altera SKU","func":"var velocidade = flow.get('novaVelocidadeSKU');\nvar sku = flow.get('novoNomeSKU');\nvar estado = flow.get('novaEstadoSKU');\nvar ciclo = parseInt((velocidade / 60)*1000)/1000;\nvar data = msg.payload.data;\nvar dataAnterior = flow.get('dataAntiga');\nvar rev = flow.get('rev');\nvar id = flow.get('id');\nvar msg1 = {\n    \"payload\": \"init\"\n}\nmsg = {\n    \"payload\": {\n        \"sku\": sku,\n        \"velocidade\": velocidade,\n        \"estado\": estado,\n        \"ciclo\": ciclo,\n        \"data\": data,\n        \"ultimaData\": dataAnterior\n    },\n    \"_id\": id,\n    \"_rev\": rev\n}\n\nreturn [msg,msg1];","outputs":2,"noerr":0,"x":710,"y":860,"wires":[["c4e16a49.5c8098"],["8a0844d0.b84008"]]},{"id":"fef618f4.eea998","type":"moment","z":"49ecca28.ef9cc4","name":"Data","topic":"","input":"","inputType":"date","inTz":"America/Sao_Paulo","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD/MM/YYYY - HH:mm:ss","locale":"pt_BR","output":"payload.data","outputType":"msg","outTz":"America/Sao_Paulo","x":530,"y":860,"wires":[["4061ff31.9db4b"]]},{"id":"efd0cd29.71a93","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"_event","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":860,"wires":[["fef618f4.eea998"]]},{"id":"76e4d5ec.a4612c","type":"ui_toast","z":"49ecca28.ef9cc4","position":"dialog","displayTime":"3","highlight":"","outputs":1,"ok":"OK","cancel":"","topic":"","name":"Alerta","x":530,"y":820,"wires":[[]]},{"id":"797899a0.d17868","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Alterando as informações. Por favor aguarde!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":820,"wires":[["76e4d5ec.a4612c"]]},{"id":"47993d78.1201c4","type":"ui_switch","z":"49ecca28.ef9cc4","name":"Estado","label":"Ativo","tooltip":"","group":"485819ea.514d78","order":4,"width":"2","height":"1","passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":1380,"y":800,"wires":[["1dec6bbc.3e0324"]]},{"id":"1dec6bbc.3e0324","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"novaEstadoSKU","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1610,"y":800,"wires":[[]]},{"id":"b8e873f2.f798c","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"dataAntiga","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1410,"y":840,"wires":[[]]},{"id":"ce8575f7.96d438","type":"comment","z":"7e8bd831.628288","name":"Inicialização e refresh","info":"Inicialização e refresh","x":220,"y":40,"wires":[]},{"id":"7dd9c90f.0e5f68","type":"comment","z":"7e8bd831.628288","name":"Seleciona um SKU para Ordem","info":"Seleciona um SKU para Ordem","x":250,"y":300,"wires":[]},{"id":"e0ad195a.500e88","type":"comment","z":"7e8bd831.628288","name":"Grava ordem","info":"Grava ordem","x":190,"y":600,"wires":[]},{"id":"14d3f64b.fbc96a","type":"function","z":"49ecca28.ef9cc4","name":"Monta lista de SKU","func":"var lista = msg.payload\nvar index = msg.payload.length\nmsg.id = []\nfor (index in lista){\n    msg.id.push(lista[index]._id)\n}\nmsg.sku = []\nfor (index in lista){\n    msg.sku.push(lista[index].payload.sku)\n}\nmsg.skuativos = []\nfor (index in lista){\n    if(lista[index].payload.estado === true){\n        msg.skuativos.push(lista[index].payload.sku)\n    }\n}\nmsg.idativos = []\nfor (index in lista){\n    if(lista[index].payload.estado === true){\n        msg.idativos.push(lista[index]._id)\n    }\n}\nvar msg1 = {\n    \"options\": msg.skuativos\n};\nmsg.options = msg.sku;\nglobal.set(\"listaId\",msg.id)\nglobal.set(\"listaSku\",msg.sku)\nglobal.set(\"listaIdAtivos\",msg.idativos)\nglobal.set(\"listaSkuAtivos\",msg.skuativos)\nreturn [msg,msg1];\n","outputs":2,"noerr":0,"x":730,"y":120,"wires":[["7c8e98.28458168"],["cdfa33fd.57339"]]},{"id":"e4691c0a.dbb2a","type":"comment","z":"7e8bd831.628288","name":"Seleciona um Ordem para consultar","info":"Seleciona um SKU para deletar","x":260,"y":740,"wires":[]},{"id":"12be908d.0cfedf","type":"ui_dropdown","z":"7e8bd831.628288","name":"Droplist consultar ordem","label":"Selecione uma ordem para consultar","tooltip":"","place":"Selecione uma ordem","group":"bd160cb1.3394e","order":1,"width":"18","height":"1","passthru":false,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":310,"y":820,"wires":[["95d68cc6.6d1fc"]]},{"id":"95d68cc6.6d1fc","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"encerrarOrdem","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":820,"wires":[["2f99cdaf.2b9b42"]]},{"id":"92fadd66.5f0f6","type":"link in","z":"7e8bd831.628288","name":"encerraOrdem","links":["4b1936f1.5af368","3cf45352.1689ec","89ffc309.17ec9","38a10355.b3037c","73263f8d.b4b79"],"x":135,"y":820,"wires":[["12be908d.0cfedf"]]},{"id":"2f99cdaf.2b9b42","type":"cloudant in","z":"7e8bd831.628288","name":"Consulta ordens","cloudant":"90d07383.5a36","database":"listadeordem","service":"_ext_","search":"_id_","design":"","index":"","x":840,"y":820,"wires":[["919ddfbb.df3b7"]]},{"id":"b9ca7a68.cc5b98","type":"comment","z":"b5ab8ba.7eb7578","name":"Inicialização do Tema","info":"Inicialização","x":150,"y":40,"wires":[]},{"id":"e4a09676.5108a8","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"rev","pt":"flow","to":"payload._rev","tot":"msg"},{"t":"set","p":"id","pt":"flow","to":"payload._id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1200,"y":700,"wires":[[]]},{"id":"1e7ab9b6.774db6","type":"function","z":"49ecca28.ef9cc4","name":"Select ID","func":"var lista = global.get('listaSku');\nvar listaid = global.get('listaId');\nvar id = lista.indexOf(msg.payload);\n\nmsg.payload = listaid[id];\n\nreturn msg;","outputs":1,"noerr":0,"x":720,"y":460,"wires":[["54e0f6c8.389fc8"]]},{"id":"27922ce8.7d5244","type":"function","z":"49ecca28.ef9cc4","name":"Select ID","func":"if(msg.payload === null || msg.payload.length === 0 || msg.payload === undefined){\n    return;\n}\nvar lista = global.get('listaSku');\nvar listaid = global.get('listaId');\nvar id = lista.indexOf(msg.payload);\n\nmsg.payload = listaid[id];\n\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":760,"wires":[["94d1bfa9.e87e2"]]},{"id":"ee21c467.60e158","type":"link out","z":"49ecca28.ef9cc4","name":"novoSKU","links":["a32f20.1f0b30e","a4f86298.d7ecd"],"x":835,"y":220,"wires":[]},{"id":"7ac2100b.dba3f","type":"link in","z":"49ecca28.ef9cc4","name":"deletaSKU","links":["7c8e98.28458168","b5aab5b3.5a63e8"],"x":135,"y":460,"wires":[["2ffc2fbf.07eb4"]]},{"id":"a32f20.1f0b30e","type":"link in","z":"49ecca28.ef9cc4","name":"refresh","links":["4fcc4ad0.812764","8a0844d0.b84008","dc6836f5.498de8","de341d9.91c56e","df3970f4.19add","ee21c467.60e158"],"x":135,"y":120,"wires":[["b1040f1b.863f5"]]},{"id":"7c8e98.28458168","type":"link out","z":"49ecca28.ef9cc4","name":"optionsDropbox","links":["7ac2100b.dba3f","7b525622.a8f5e8"],"x":1095,"y":100,"wires":[]},{"id":"7b525622.a8f5e8","type":"link in","z":"49ecca28.ef9cc4","name":"alteraSKU","links":["7c8e98.28458168","b5aab5b3.5a63e8"],"x":115,"y":760,"wires":[["adf16cf6.ad84e"]]},{"id":"4fcc4ad0.812764","type":"link out","z":"49ecca28.ef9cc4","name":"deletaSKU","links":["a32f20.1f0b30e","a4f86298.d7ecd"],"x":865,"y":560,"wires":[]},{"id":"e8801c5a.9a3a3","type":"ui_ui_control","z":"b5ab8ba.7eb7578","name":"","x":400,"y":560,"wires":[[]]},{"id":"996b79eb.4ce3a8","type":"comment","z":"b5ab8ba.7eb7578","name":"Ui control para esconder e mostrar campos","info":"Try catch para erros do BD","x":220,"y":380,"wires":[]},{"id":"70e25002.a1387","type":"ui_button","z":"b5ab8ba.7eb7578","name":"","group":"141a5297.cc40fd","order":3,"width":"4","height":"1","passthru":false,"label":"Criar SKU","tooltip":"","color":"","bgcolor":"{{background}}","icon":"","payload":"{\"group\":{\"hide\":[\"Receitas_Alterar_SKU\",\"Receitas_Deletar_SKU\"],\"show\":[\"Receitas_Criar_SKU\"]}}","payloadType":"json","topic":"","x":180,"y":440,"wires":[["dc6836f5.498de8","e8801c5a.9a3a3"]]},{"id":"7db71dd.9c7e5e4","type":"ui_button","z":"b5ab8ba.7eb7578","name":"","group":"141a5297.cc40fd","order":5,"width":"4","height":"1","passthru":false,"label":"Alterar SKU","tooltip":"","color":"","bgcolor":"{{background}}","icon":"","payload":"{\"group\":{\"hide\":[\"Receitas_Criar_SKU\",\"Receitas_Deletar_SKU\"],\"show\":[\"Receitas_Alterar_SKU\"]}}","payloadType":"json","topic":"","x":170,"y":500,"wires":[["dc6836f5.498de8","e8801c5a.9a3a3"]]},{"id":"f4000506.7e3e78","type":"ui_button","z":"b5ab8ba.7eb7578","name":"","group":"141a5297.cc40fd","order":7,"width":"4","height":"1","passthru":false,"label":"Deletar SKU","tooltip":"","color":"","bgcolor":"{{background}}","icon":"","payload":"{\"group\":{\"hide\":[\"Receitas_Criar_SKU\",\"Receitas_Alterar_SKU\"],\"show\":[\"Receitas_Deletar_SKU\"]}}","payloadType":"json","topic":"","x":170,"y":560,"wires":[["dc6836f5.498de8","e8801c5a.9a3a3"]]},{"id":"8250c79d.45dfa8","type":"ui_ui_control","z":"b5ab8ba.7eb7578","name":"","x":400,"y":760,"wires":[[]]},{"id":"af39112b.0b355","type":"comment","z":"b5ab8ba.7eb7578","name":"Ui control para esconder e mostrar campos","info":"Try catch para erros do BD","x":220,"y":620,"wires":[]},{"id":"85fb4751.9f13a8","type":"ui_button","z":"b5ab8ba.7eb7578","name":"","group":"3915cecb.4b6d32","order":3,"width":"4","height":"1","passthru":false,"label":"Abrir Ordem","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"show\":[\"Ordem_Abrir_ordem\"],\"hide\":[\"Ordem_Consultar_ordem\",\"Ordem_Produção\",\"Ordem_Disponibilidade\",\"Ordem_Qualidade\",\"Ordem_Perdas\",\"Ordem_OEE_Acc\",\"Ordem_Data\"]}}","payloadType":"json","topic":"","x":210,"y":700,"wires":[["df3970f4.19add","8250c79d.45dfa8"]]},{"id":"9f9c556b.1c9048","type":"ui_button","z":"b5ab8ba.7eb7578","name":"","group":"3915cecb.4b6d32","order":4,"width":"4","height":"1","passthru":false,"label":"Consultar Ordem","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"hide\":[\"Ordem_Abrir_ordem\",\"Ordem_Data\"],\"show\":[\"Ordem_Consultar_ordem\"]}}","payloadType":"json","topic":"","x":210,"y":760,"wires":[["df3970f4.19add","8250c79d.45dfa8"]]},{"id":"c66b0465.928c98","type":"catch","z":"b1828f58.199e6","name":"Catch SKU repetido","scope":["497f304e.70cbb","c4e16a49.5c8098"],"uncaught":false,"x":170,"y":100,"wires":[["70e2e717.027438"]]},{"id":"3db03504.463f8a","type":"comment","z":"b1828f58.199e6","name":"Try catch para erros do BD","info":"Try catch para erros do BD","x":190,"y":40,"wires":[]},{"id":"70e2e717.027438","type":"function","z":"b1828f58.199e6","name":"Reposta","func":"if(msg.error.message === 'Failed to insert document: couch returned 409'){\n    msg.payload = [];\n    msg.payload = 'Este SKU já existe';\n    return msg\n}\n","outputs":1,"noerr":0,"x":380,"y":100,"wires":[["41821c1a.604f54"]]},{"id":"41821c1a.604f54","type":"ui_toast","z":"b1828f58.199e6","position":"dialog","displayTime":"3","highlight":"","outputs":1,"ok":"Ok","cancel":"","topic":"","name":"Alerta","x":550,"y":100,"wires":[[]]},{"id":"6fecaf66.c45b1","type":"ui_toast","z":"49ecca28.ef9cc4","position":"dialog","displayTime":"3","highlight":"","outputs":1,"ok":"OK","cancel":"","topic":"","name":"Alerta","x":680,"y":560,"wires":[[]]},{"id":"633f1ba5.420bb4","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"SKU deletado com sucesso!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":560,"wires":[["6fecaf66.c45b1"]]},{"id":"a80126e0.1af3b8","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"json"},{"t":"set","p":"enabled","pt":"msg","to":"false","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":880,"wires":[["47993d78.1201c4"]]},{"id":"8a0844d0.b84008","type":"link out","z":"49ecca28.ef9cc4","name":"alteraSKU","links":["a32f20.1f0b30e","fc4b9cb2.a3b1c","a4f86298.d7ecd"],"x":855,"y":880,"wires":[]},{"id":"fc4b9cb2.a3b1c","type":"link in","z":"49ecca28.ef9cc4","name":"limpaSKU","links":["76e9ea64.a60f44","8a0844d0.b84008","f6f97615.a43f58","4d090518.8fbd9c"],"x":1015,"y":880,"wires":[["a80126e0.1af3b8","7884d046.30287"]]},{"id":"76e9ea64.a60f44","type":"link out","z":"49ecca28.ef9cc4","name":"limpaDeletaSKU","links":["fc4b9cb2.a3b1c"],"x":275,"y":920,"wires":[]},{"id":"7884d046.30287","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"},{"t":"set","p":"enabled","pt":"msg","to":"false","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":840,"wires":[["6749a804.460438","84b98fa9.131ab"]]},{"id":"dc6836f5.498de8","type":"link out","z":"b5ab8ba.7eb7578","name":"uiSKU","links":["a32f20.1f0b30e","99f976e7.a34d58","a4f86298.d7ecd","edba45a1.8b9808","38483c66.f1e714"],"x":355,"y":440,"wires":[]},{"id":"df3970f4.19add","type":"link out","z":"b5ab8ba.7eb7578","name":"uiOrdem","links":["99f976e7.a34d58","a32f20.1f0b30e","edba45a1.8b9808","38483c66.f1e714"],"x":355,"y":700,"wires":[]},{"id":"cdbc57fa.1f1d28","type":"ui_toast","z":"49ecca28.ef9cc4","position":"dialog","displayTime":"3","highlight":"","outputs":1,"ok":"OK","cancel":"","topic":"","name":"Alerta","x":1010,"y":260,"wires":[[]]},{"id":"9d55bf06.0693d","type":"change","z":"49ecca28.ef9cc4","name":"Alerta","rules":[{"t":"set","p":"payload","pt":"msg","to":"SKU criado com sucesso!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":870,"y":260,"wires":[["cdbc57fa.1f1d28"]]},{"id":"fdfcb4c1.5f7908","type":"cloudant in","z":"7e8bd831.628288","name":"Consulta SKU","cloudant":"90d07383.5a36","database":"listadesku","service":"_ext_","search":"_id_","design":"","index":"","x":1070,"y":400,"wires":[["b34c77c3.169048"]]},{"id":"ab044e26.8acb8","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"SKUSelecionado","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":400,"wires":[["fdfcb4c1.5f7908"]]},{"id":"b34c77c3.169048","type":"function","z":"7e8bd831.628288","name":"Split","func":"if(msg.payload.payload !== undefined){\n    var item = msg.payload.payload;\n    var msg1 = {\"payload\": item.sku};\n    var msg2 = {\"payload\": item.ciclo};\n    var msg3 = {\"payload\": item.velocidade};\n    var msg4 = {\"payload\": item.data};\n    return [msg1,msg2,msg3,msg4];\n}","outputs":4,"noerr":0,"x":1250,"y":400,"wires":[["3bdd362.bf01aca"],["2c6cbdd1.90f702"],["1363547a.50f6fc"],[]]},{"id":"343c65e0.7140fa","type":"function","z":"7e8bd831.628288","name":"Select ID","func":"if(msg.payload === undefined || msg.payload === null || msg.payload.length === 0 || msg.payload === []){\n    return\n}\nvar lista = global.get('listaSku');\nvar listaid = global.get('listaId');\nvar id = lista.indexOf(msg.payload);\nmsg.payload = listaid[id];\nreturn msg;\n\n\n","outputs":1,"noerr":0,"x":600,"y":400,"wires":[["ab044e26.8acb8"]]},{"id":"3bdd362.bf01aca","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"SKU","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1430,"y":340,"wires":[[]]},{"id":"2c6cbdd1.90f702","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"ciclo","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1430,"y":380,"wires":[[]]},{"id":"1363547a.50f6fc","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"velocidade","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1450,"y":420,"wires":[[]]},{"id":"c5c73cff.5e96d","type":"ui_dropdown","z":"7e8bd831.628288","name":"Droplist SKU ativo","label":"Selecione um SKU ativo","tooltip":"","place":"Selecione um SKU ativo","group":"8179319f.da615","order":1,"width":0,"height":0,"passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":390,"y":400,"wires":[["343c65e0.7140fa"]]},{"id":"5b397e65.e8d75","type":"ui_button","z":"7e8bd831.628288","name":"Limpar","group":"8179319f.da615","order":6,"width":"4","height":"1","passthru":false,"label":"Cancelar","tooltip":"","color":"","bgcolor":"","icon":"cancel","payload":"null","payloadType":"json","topic":"","x":170,"y":440,"wires":[["c5c73cff.5e96d","1927f1c7.56e37e"]]},{"id":"96644b4d.413588","type":"link in","z":"7e8bd831.628288","name":"escolheSKU","links":["3ccb2b54.2acd64","d18ddaf6.46dbb8","cdfa33fd.57339"],"x":135,"y":400,"wires":[["c5c73cff.5e96d"]]},{"id":"9a5c5c08.b9a82","type":"ui_button","z":"7e8bd831.628288","name":"Criar ordem","group":"8179319f.da615","order":5,"width":"4","height":"1","passthru":false,"label":"Criar ordem","tooltip":"","color":"","bgcolor":"","icon":"","payload":"null","payloadType":"json","topic":"","x":190,"y":660,"wires":[["c5c73cff.5e96d","3b8a49bb.da4406","1927f1c7.56e37e"]]},{"id":"1927f1c7.56e37e","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"null","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":500,"wires":[["f1ff0ad.0f45df8"]]},{"id":"3b8a49bb.da4406","type":"moment","z":"7e8bd831.628288","name":"Gera ordem","topic":"","input":"","inputType":"date","inTz":"America/Sao_Paulo","adjAmount":0,"adjType":"days","adjDir":"add","format":"DDMMYYYYHHmmss","locale":"pt_BR","output":"ordem","outputType":"flow","outTz":"America/Sao_Paulo","x":390,"y":660,"wires":[["e87c5611.b0f018"]]},{"id":"f1ff0ad.0f45df8","type":"ui_text_input","z":"7e8bd831.628288","name":"Produção prevista","label":"Quantidade de produção prevista","tooltip":"","group":"8179319f.da615","order":3,"width":0,"height":0,"passthru":true,"mode":"number","delay":"0","topic":"","x":610,"y":500,"wires":[["c63b6eb6.c035"]]},{"id":"e87c5611.b0f018","type":"moment","z":"7e8bd831.628288","name":"Data","topic":"","input":"","inputType":"date","inTz":"America/Sao_Paulo","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD/MM/YYYY - HH:mm:ss","locale":"pt_BR","output":"payload","outputType":"msg","outTz":"America/Sao_Paulo","x":570,"y":660,"wires":[["a40570cb.e17e1"]]},{"id":"c63b6eb6.c035","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"producao","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":500,"wires":[["238b242e.6a572c"]]},{"id":"a40570cb.e17e1","type":"function","z":"7e8bd831.628288","name":"Grava ordem","func":"var sku = flow.get('SKU');\nvar ciclo = flow.get('ciclo');\nvar velocidade = flow.get('velocidade');\nvar tempo = flow.get('tempo');\nvar tempoS = flow.get('tempoS');\nvar ordem = flow.get('ordem');\nvar producao = flow.get('producao');\nvar data = msg.payload;\nmsg.payload = []\nif(producao > 0 && sku !== null){\n    msg = {\n    \"payload\":{\n        \"skuInformacoes\":{\n            \"sku\": sku,\n            \"ciclo\": ciclo,\n            \"velocidadePadrao\": velocidade,\n            \"tempoDeProducao\": tempo,\n            \"tempoDeProducaoSec\": tempoS,\n            \"quantidadePrevista\": producao,\n        },\n        \"ordemInformacoes\":{\n            \"ordem\": ordem,\n            \"produzido\": 0,\n            \"tempoProduzido\": \"00:00:00\",\n            \"tempoProduzidoSec\": 0,\n            \"statusDeOrdem\": \"Programada\",\n            \"dataInicial\": data\n        },\n        \"dadosDeProducao\": {\n\n        }\n    },\n    \"_id\": ordem\n    }\n    return [msg,null];\n}\nif(producao <= 0){\n    var msg1 = {\"payload\": \"Informe a quantidade de produção prevista!\"}\n    return [null,msg1];\n}\nif(sku === null){\n    var msg1 = {\"payload\": \"Informe um SKU!\"}\n    return [null,msg1];\n}","outputs":2,"noerr":0,"x":760,"y":660,"wires":[["fe234d71.21618","44a3672f.2999c8","6328c35b.0fc7ec"],["12fdabd7.3601e4"]]},{"id":"238b242e.6a572c","type":"function","z":"7e8bd831.628288","name":"Cacula tempo","func":"var producao = msg.payload;\nvar ciclo = flow.get('ciclo') || 0;\nvar segundos = producao / ciclo;\n\nfunction format(numero){\n    if (numero <= 9){\n\t    numero = \"0\"+numero;\n    }\n    return numero;\n    }\n\nvar fhora = format(Math.round(segundos/3600));\nvar fmin = format(Math.floor((segundos%3600)/60));\nvar fseg = format(Math.floor((segundos%3600)%60));\n    \nvar tempo = fhora+\":\"+fmin+\":\"+fseg;\n\nif(tempo === 0){\n    return msg;\n}\nif(tempo !== 0){\n    msg.payload = tempo;\n}\n\nmsg.segundos = segundos;\n\nreturn msg;","outputs":1,"noerr":0,"x":1070,"y":500,"wires":[["78ea82e9.b8521c"]]},{"id":"fe234d71.21618","type":"cloudant out","z":"7e8bd831.628288","name":"Salvar ordem","cloudant":"90d07383.5a36","database":"listadeordem","service":"_ext_","payonly":false,"operation":"insert","x":980,"y":620,"wires":[]},{"id":"44a3672f.2999c8","type":"function","z":"7e8bd831.628288","name":"Gera notificação","func":"var sku = flow.get('SKU');\nvar ciclo = flow.get('ciclo');\nvar velocidade = flow.get('velocidade');\nvar tempo = flow.get('tempo');\nvar ordem = flow.get('ordem');\nvar producao = flow.get('producao');\nvar tempoS = flow.get('tempoS')\n\nmsg.topic = \"Ordem aberta com sucesso!\"\nmsg.payload = \"Ordem: \"+ordem+\"; Produto: \"+sku+\"; Quantidade: \"+producao+\".\";\nreturn msg;","outputs":1,"noerr":0,"x":990,"y":660,"wires":[["4edd4f31.21cf"]]},{"id":"12fdabd7.3601e4","type":"ui_toast","z":"7e8bd831.628288","position":"dialog","displayTime":"3","highlight":"","outputs":1,"ok":"OK","cancel":"","topic":"","name":"Alerta","x":960,"y":700,"wires":[[]]},{"id":"6328c35b.0fc7ec","type":"link out","z":"7e8bd831.628288","name":"criaOrdem","links":["99f976e7.a34d58","edba45a1.8b9808","524ee5c4.2c631c","38483c66.f1e714"],"x":925,"y":580,"wires":[]},{"id":"78ea82e9.b8521c","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"tempo","pt":"flow","to":"payload","tot":"msg"},{"t":"set","p":"tempoS","pt":"flow","to":"segundos","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1280,"y":500,"wires":[[]]},{"id":"4edd4f31.21cf","type":"ui_toast","z":"7e8bd831.628288","position":"dialog","displayTime":"3","highlight":"","outputs":1,"ok":"OK","cancel":"","topic":"","name":"Alerta","x":1180,"y":660,"wires":[[]]},{"id":"c42786ce.a68428","type":"ui_toast","z":"49ecca28.ef9cc4","position":"dialog","displayTime":"3","highlight":"","outputs":1,"ok":"OK","cancel":"","topic":"","name":"Alerta","x":870,"y":340,"wires":[[]]},{"id":"324061be.38949e","type":"ui_dropdown","z":"93413fb0.966e1","name":"Droplist ordem","label":"Ordem","tooltip":"","place":"Selecione uma ordem","group":"b11f2258.53dd7","order":1,"width":"10","height":"1","passthru":false,"options":[],"payload":"","topic":"","x":1140,"y":200,"wires":[["cf3e12fa.351ff"]]},{"id":"4d3a0edf.ff8ec","type":"comment","z":"93413fb0.966e1","name":"Selecionar a ordem para a linha","info":"Selecionar a ordem para a linha","x":190,"y":160,"wires":[]},{"id":"4b7e6018.60205","type":"ui_template","z":"1f65e450.19ba9c","group":"","name":"CSS","order":1,"width":0,"height":0,"format":"            <style>\n\n            body.nr-dashboard-theme {\n                background-color: #e9dfdf;\n                font-family: Arial;\n            }\n            button, html, input, select, textarea {\n                font-family: Arial;\n            }\n            body.nr-dashboard-theme md-content md-card {\n                background-color: #33333300;\n                color: #d0d0d0;\n            }\n\n            body.nr-dashboard-theme md-sidenav{\n                background-image: linear-gradient(to right, rgba(183,222,237,1) 0%, rgba(233,223,223,1) 100%);\n                font-family: Arial;;\n            }\n\n            body.nr-dashboard-theme md-list{\n                color: #707070;\n            }\n\n            body.nr-dashboard-theme .nr-menu-item-active {\n                color: rgb(55, 170, 216);\n            }\n\n            body.nr-dashboard-theme .md-list-item-inner{\n                background-image: linear-gradient(to right, rgba(183,222,237,1) 0%, rgba(233,223,223,1) 100%);\n            }\n\n            body.nr-dashboard-theme md-toolbar {\n                background-image: c;\n                box-shadow: 0px 1px 15px #000000;\n            }\n\n            body.nr-dashboard-theme md-toolbar .ng-binding {\n                color: black;\n            }\n\n            body.nr-dashboard-theme md-toolbar .ng-scope {\n                color: black;\n            }\n\n            .nr-dashboard-theme ui-card-panel {\n                background-image: linear-gradient(45deg, rgba(247,247,247,1) 0%, rgba(227,227,227,1) 51%, rgba(240,240,240,1) 74%, rgba(255,255,255,1) 100%);\n                border: 1px solid #555555;\n                box-shadow: 0 0 20px #00000066;\n            }\n\n            body.nr-dashboard-theme md-input-container p.label{\n                color: black;\n            }\n\n            body.nr-dashboard-theme md-card p.label{\n                color: black;\n            }\n\n            .nr-dashboard-theme ui-card-panel p.nr-dashboard-cardtitle {\n                height: 48px;\n                background-image: linear-gradient(to right, rgba(102,188,222,1) 0%, rgba(233,223,223,1) 100%);\n                border-radius: 100px 100px 100px 100px;\n                text-align: center;\n                box-shadow: 0px 0px 17px 1px rgba(0,0,0,0.75);\n                color: black;\n                text-shadow: 0 0 2px black;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-form-button {\n                width: 210px;\n                height: 48px;\n                background-image: linear-gradient(to right, rgba(102,188,222,1) 0%, rgba(233,223,223,1) 100%);\n                color: #0a0a0a;\n                text-shadow: 0 0 2px #525252;\n                border-radius:6px;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-form-button:hover {\n                background-image: linear-gradient(to right, rgb(0, 150, 209) 0%, rgb(179, 176, 176) 100%);;\n            }\n            \n            .nr-dashboard-theme .nr-dashboard-form-button:active {\n                background-image: linear-gradient(to right, rgb(0, 17, 255) 0%, rgb(179, 176, 176) 100%);;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-button .md-button {\n                background-image: linear-gradient(to right, rgba(102,188,222,1) 0%, rgba(233,223,223,1) 100%);\n                color: #0a0a0a;\n                text-shadow: 0 0 2px #525252;\n                border-radius:6px;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-button .md-button:hover {\n                background-image: linear-gradient(to right, rgb(0, 150, 209) 0%, rgb(179, 176, 176) 100%);;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-button .md-button:active {\n                background-image: linear-gradient(to right, rgb(0, 17, 255) 0%, rgb(179, 176, 176) 100%);;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-form md-switch .md-thumb {\n                background-image: linear-gradient(to bottom right, rgb(0, 17, 255), #115009);\n            }\n\n            .nr-dashboard-theme .nr-dashboard-switch md-switch .md-thumb {\n                background-image: linear-gradient(to bottom right, rgb(0, 17, 255), #115009);\n            }\n\n            .nr-dashboard-button .md-button {\n                box-shadow: 0 1px 3px 0 rgba(0,0,0,.26)!important;\n                width: 100%!important;\n                height: 100%!important;\n                margin: 0!important;\n                min-width: 0!important;\n                min-height: 0!important;\n            }\n            .nr-dashboard-theme .nr-dashboard-slider .md-thumb:after {\n                background-image: linear-gradient(to bottom right, #48b349, #115009);\n                border-style: none;\n            }\n            .nr-dashboard-theme .nr-dashboard-numeric .value {\n                background-color: #33333300;\n                color:#d0d0d0;\n            }\n\n            .nr-dashboard-numeric .value {\n                font-weight: 700;\n                text-align: center;\n                border: 0;\n            }\n\n            .nr-dashboard-form {\n                display: inline-block;\n                width: 100%;\n                overflow-y: visible;\n            }\n            #SETTINGS_TEATED_cards {\n                min-height: 260px;\n            }\n\n            </style>    <style>\n\n            body.nr-dashboard-theme {\n                background-color: #e9dfdf;\n                font-family: Arial;\n            }\n            button, html, input, select, textarea {\n                font-family: Arial;\n            }\n            body.nr-dashboard-theme md-content md-card {\n                background-color: #33333300;\n                color: #d0d0d0;\n            }\n\n            body.nr-dashboard-theme md-sidenav{\n                background-image: linear-gradient(to right, rgba(183,222,237,1) 0%, rgba(233,223,223,1) 100%);\n                font-family: Arial;;\n            }\n\n            body.nr-dashboard-theme md-list{\n                color: #707070;\n            }\n\n            body.nr-dashboard-theme .nr-menu-item-active {\n                color: rgb(55, 170, 216);\n            }\n\n            body.nr-dashboard-theme .md-list-item-inner{\n                background-image: linear-gradient(to right, rgba(183,222,237,1) 0%, rgba(233,223,223,1) 100%);\n            }\n\n            body.nr-dashboard-theme md-toolbar {\n                background-image: c;\n                box-shadow: 0px 1px 15px #000000;\n            }\n\n            body.nr-dashboard-theme md-toolbar .ng-binding {\n                color: black;\n            }\n\n            body.nr-dashboard-theme md-toolbar .ng-scope {\n                color: black;\n            }\n\n            .nr-dashboard-theme ui-card-panel {\n                background-image: linear-gradient(45deg, rgba(247,247,247,1) 0%, rgba(227,227,227,1) 51%, rgba(240,240,240,1) 74%, rgba(255,255,255,1) 100%);\n                border: 1px solid #555555;\n                box-shadow: 0 0 20px #00000066;\n            }\n\n            .nr-dashboard-theme ui-card-panel p.nr-dashboard-cardtitle {\n                width: 800px;\n                height: 48px;\n                background-image: linear-gradient(to right, rgba(102,188,222,1) 0%, rgba(233,223,223,1) 100%);\n\n                text-align: center;\n                box-shadow: 0px 0px 17px 1px rgba(0,0,0,0.75);\n                color: black;\n                text-shadow: 0 0 2px black;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-form-button {\n                width: 210px;\n                height: 48px;\n                background-image: linear-gradient(to right, rgba(102,188,222,1) 0%, rgba(233,223,223,1) 100%);\n                color: #0a0a0a;\n                text-shadow: 0 0 2px #525252;\n                border-radius:6px;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-form-button:hover {\n                background-image: linear-gradient(to right, rgb(0, 150, 209) 0%, rgb(179, 176, 176) 100%);;\n            }\n            \n            .nr-dashboard-theme .nr-dashboard-form-button:active {\n                background-image: linear-gradient(to right, rgb(0, 17, 255) 0%, rgb(179, 176, 176) 100%);;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-button .md-button {\n                background-image: linear-gradient(to right, rgba(102,188,222,1) 0%, rgba(233,223,223,1) 100%);\n                color: #0a0a0a;\n                text-shadow: 0 0 2px #525252;\n                border-radius:6px;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-button .md-button:hover {\n                background-image: linear-gradient(to right, rgb(0, 150, 209) 0%, rgb(179, 176, 176) 100%);;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-button .md-button:active {\n                background-image: linear-gradient(to right, rgb(0, 17, 255) 0%, rgb(179, 176, 176) 100%);;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-form md-switch .md-thumb {\n                background-image: linear-gradient(to bottom right, rgb(0, 17, 255), #115009);\n            }\n\n            .nr-dashboard-theme .nr-dashboard-switch md-switch .md-thumb {\n                background-image: linear-gradient(to bottom right, rgb(0, 17, 255), #115009);\n            }\n\n            .nr-dashboard-button .md-button {\n                box-shadow: 0 1px 3px 0 rgba(0,0,0,.26)!important;\n                width: 100%!important;\n                height: 100%!important;\n                margin: 0!important;\n                min-width: 0!important;\n                min-height: 0!important;\n            }\n            .nr-dashboard-theme .nr-dashboard-slider .md-thumb:after {\n                background-image: linear-gradient(to bottom right, #48b349, #115009);\n                border-style: none;\n            }\n            .nr-dashboard-theme .nr-dashboard-numeric .value {\n                background-color: #33333300;\n                color:#d0d0d0;\n            }\n\n            .nr-dashboard-numeric .value {\n                font-weight: 700;\n                text-align: center;\n                border: 0;\n            }\n\n            .nr-dashboard-form {\n                display: inline-block;\n                width: 100%;\n                overflow-y: visible;\n            }\n            #SETTINGS_TEATED_cards {\n                min-height: 260px;\n            }\n\n            </style>            <style>\n\n            body.nr-dashboard-theme {\n                background-color: #e9dfdf;\n                font-family: Arial;\n            }\n            button, html, input, select, textarea {\n                font-family: Arial;\n            }\n            body.nr-dashboard-theme md-content md-card {\n                background-color: #33333300;\n                color: #d0d0d0;\n            }\n\n            body.nr-dashboard-theme md-sidenav{\n                background-image: linear-gradient(to right, rgba(183,222,237,1) 0%, rgba(233,223,223,1) 100%);\n                font-family: Arial;;\n            }\n\n            body.nr-dashboard-theme md-list{\n                color: #707070;\n            }\n\n            body.nr-dashboard-theme .nr-menu-item-active {\n                color: rgb(55, 170, 216);\n            }\n\n            body.nr-dashboard-theme .md-list-item-inner{\n                background-image: linear-gradient(to right, rgba(183,222,237,1) 0%, rgba(233,223,223,1) 100%);\n            }\n\n            body.nr-dashboard-theme md-toolbar {\n                background-image: c;\n                box-shadow: 0px 1px 15px #000000;\n            }\n\n            body.nr-dashboard-theme md-toolbar .ng-binding {\n                color: black;\n            }\n\n            body.nr-dashboard-theme md-toolbar .ng-scope {\n                color: black;\n            }\n\n            .nr-dashboard-theme ui-card-panel {\n                background-image: linear-gradient(45deg, rgba(247,247,247,1) 0%, rgba(227,227,227,1) 51%, rgba(240,240,240,1) 74%, rgba(255,255,255,1) 100%);\n                border: 1px solid #555555;\n                box-shadow: 0 0 20px #00000066;\n            }\n\n            body.nr-dashboard-theme md-input-container p.label{\n                color: black;\n            }\n\n            body.nr-dashboard-theme md-card p.label{\n                color: black;\n            }\n\n            .nr-dashboard-theme ui-card-panel p.nr-dashboard-cardtitle {\n                background-image: linear-gradient(to right, rgba(102,188,222,1) 0%, rgba(233,223,223,1) 100%);\n                border-radius: 100px 100px 100px 100px;\n                text-align: center;\n                box-shadow: 0px 0px 17px 1px rgba(0,0,0,0.75);\n                color: black;\n                text-shadow: 0 0 2px black;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-form-button {\n                width: 210px;\n                height: 48px;\n                background-image: linear-gradient(to right, rgba(102,188,222,1) 0%, rgba(233,223,223,1) 100%);\n                color: #0a0a0a;\n                text-shadow: 0 0 2px #525252;\n                border-radius:6px;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-form-button:hover {\n                background-image: linear-gradient(to right, rgb(0, 150, 209) 0%, rgb(179, 176, 176) 100%);;\n            }\n            \n            .nr-dashboard-theme .nr-dashboard-form-button:active {\n                background-image: linear-gradient(to right, rgb(0, 17, 255) 0%, rgb(179, 176, 176) 100%);;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-button .md-button {\n                background-image: linear-gradient(to right, rgba(102,188,222,1) 0%, rgba(233,223,223,1) 100%);\n                color: #0a0a0a;\n                text-shadow: 0 0 2px #525252;\n                border-radius:6px;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-button .md-button:hover {\n                background-image: linear-gradient(to right, rgb(0, 150, 209) 0%, rgb(179, 176, 176) 100%);;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-button .md-button:active {\n                background-image: linear-gradient(to right, rgb(0, 17, 255) 0%, rgb(179, 176, 176) 100%);;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-form md-switch .md-thumb {\n                background-image: linear-gradient(to bottom right, rgb(0, 17, 255), #115009);\n            }\n\n            .nr-dashboard-theme .nr-dashboard-switch md-switch .md-thumb {\n                background-image: linear-gradient(to bottom right, rgb(0, 17, 255), #115009);\n            }\n\n            .nr-dashboard-button .md-button {\n                box-shadow: 0 1px 3px 0 rgba(0,0,0,.26)!important;\n                width: 100%!important;\n                height: 100%!important;\n                margin: 0!important;\n                min-width: 0!important;\n                min-height: 0!important;\n            }\n            .nr-dashboard-theme .nr-dashboard-slider .md-thumb:after {\n                background-image: linear-gradient(to bottom right, #48b349, #115009);\n                border-style: none;\n            }\n            .nr-dashboard-theme .nr-dashboard-numeric .value {\n                background-color: #33333300;\n                color:#d0d0d0;\n            }\n\n            .nr-dashboard-numeric .value {\n                font-weight: 700;\n                text-align: center;\n                border: 0;\n            }\n\n            .nr-dashboard-form {\n                display: inline-block;\n                width: 100%;\n                overflow-y: visible;\n            }\n            #SETTINGS_TEATED_cards {\n                min-height: 260px;\n            }\n\n            </style>    <style>\n\n            body.nr-dashboard-theme {\n                background-color: #e9dfdf;\n                font-family: Arial;\n            }\n            button, html, input, select, textarea {\n                font-family: Arial;\n            }\n            body.nr-dashboard-theme md-content md-card {\n                background-color: #33333300;\n                color: #d0d0d0;\n            }\n\n            body.nr-dashboard-theme md-sidenav{\n                background-image: linear-gradient(to right, rgba(183,222,237,1) 0%, rgba(233,223,223,1) 100%);\n                font-family: Arial;;\n            }\n\n            body.nr-dashboard-theme md-list{\n                color: #707070;\n            }\n\n            body.nr-dashboard-theme .nr-menu-item-active {\n                color: rgb(55, 170, 216);\n            }\n\n            body.nr-dashboard-theme .md-list-item-inner{\n                background-image: linear-gradient(to right, rgba(183,222,237,1) 0%, rgba(233,223,223,1) 100%);\n            }\n\n            body.nr-dashboard-theme md-toolbar {\n                background-image: c;\n                box-shadow: 0px 1px 15px #000000;\n            }\n\n            body.nr-dashboard-theme md-toolbar .ng-binding {\n                color: black;\n            }\n\n            body.nr-dashboard-theme md-toolbar .ng-scope {\n                color: black;\n            }\n\n            .nr-dashboard-theme ui-card-panel {\n                background-image: linear-gradient(45deg, rgba(247,247,247,1) 0%, rgba(227,227,227,1) 51%, rgba(240,240,240,1) 74%, rgba(255,255,255,1) 100%);\n                border: 1px solid #555555;\n                box-shadow: 0 0 20px #00000066;\n            }\n\n            .nr-dashboard-theme ui-card-panel p.nr-dashboard-cardtitle {\n                width: 800px;\n                height: 48px;\n                background-image: linear-gradient(to right, rgba(102,188,222,1) 0%, rgba(233,223,223,1) 100%);\n\n                text-align: center;\n                box-shadow: 0px 0px 17px 1px rgba(0,0,0,0.75);\n                color: black;\n                text-shadow: 0 0 2px black;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-form-button {\n                width: 210px;\n                height: 48px;\n                background-image: linear-gradient(to right, rgba(102,188,222,1) 0%, rgba(233,223,223,1) 100%);\n                color: #0a0a0a;\n                text-shadow: 0 0 2px #525252;\n                border-radius:6px;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-form-button:hover {\n                background-image: linear-gradient(to right, rgb(0, 150, 209) 0%, rgb(179, 176, 176) 100%);;\n            }\n            \n            .nr-dashboard-theme .nr-dashboard-form-button:active {\n                background-image: linear-gradient(to right, rgb(0, 17, 255) 0%, rgb(179, 176, 176) 100%);;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-button .md-button {\n                background-image: linear-gradient(to right, rgba(102,188,222,1) 0%, rgba(233,223,223,1) 100%);\n                color: #0a0a0a;\n                text-shadow: 0 0 2px #525252;\n                border-radius:6px;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-button .md-button:hover {\n                background-image: linear-gradient(to right, rgb(0, 150, 209) 0%, rgb(179, 176, 176) 100%);;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-button .md-button:active {\n                background-image: linear-gradient(to right, rgb(0, 17, 255) 0%, rgb(179, 176, 176) 100%);;\n            }\n\n            .nr-dashboard-theme .nr-dashboard-form md-switch .md-thumb {\n                background-image: linear-gradient(to bottom right, rgb(0, 17, 255), #115009);\n            }\n\n            .nr-dashboard-theme .nr-dashboard-switch md-switch .md-thumb {\n                background-image: linear-gradient(to bottom right, rgb(0, 17, 255), #115009);\n            }\n\n            .nr-dashboard-button .md-button {\n                box-shadow: 0 1px 3px 0 rgba(0,0,0,.26)!important;\n                width: 100%!important;\n                height: 100%!important;\n                margin: 0!important;\n                min-width: 0!important;\n                min-height: 0!important;\n            }\n            .nr-dashboard-theme .nr-dashboard-slider .md-thumb:after {\n                background-image: linear-gradient(to bottom right, #48b349, #115009);\n                border-style: none;\n            }\n            .nr-dashboard-theme .nr-dashboard-numeric .value {\n                background-color: #33333300;\n                color:#d0d0d0;\n            }\n\n            .nr-dashboard-numeric .value {\n                font-weight: 700;\n                text-align: center;\n                border: 0;\n            }\n\n            .nr-dashboard-form {\n                display: inline-block;\n                width: 100%;\n                overflow-y: visible;\n            }\n            #SETTINGS_TEATED_cards {\n                min-height: 260px;\n            }\n\n            </style>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"global","x":110,"y":60,"wires":[[]]},{"id":"ca73faf6.381a88","type":"link in","z":"93413fb0.966e1","name":"escolheOrdem","links":["6c22211a.87c5b","a8f522b4.5ea2f","f4796586.3bd7d8","f031ea27.1c2988"],"x":755,"y":180,"wires":[["ca646806.34e8f8"]]},{"id":"d303e04e.e5cf1","type":"comment","z":"93413fb0.966e1","name":"Seleciona Linha","info":"Seleciona Linha","x":140,"y":40,"wires":[]},{"id":"b5cee936.891448","type":"cloudant in","z":"93413fb0.966e1","name":"Consulta Ordem","cloudant":"90d07383.5a36","database":"listadeordem","service":"_ext_","search":"_id_","design":"","index":"","x":1580,"y":200,"wires":[["47992fde.01f3d"]]},{"id":"cf3e12fa.351ff","type":"change","z":"93413fb0.966e1","name":"","rules":[{"t":"set","p":"_id","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"ordematual_id","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1360,"y":200,"wires":[["b5cee936.891448"]]},{"id":"47992fde.01f3d","type":"change","z":"93413fb0.966e1","name":"","rules":[{"t":"set","p":"ordematual","pt":"global","to":"payload.payload","tot":"msg"},{"t":"set","p":"ordematual_rev","pt":"global","to":"payload._rev","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1800,"y":200,"wires":[[]]},{"id":"44f7b835.806a88","type":"ui_button","z":"93413fb0.966e1","name":"","group":"b11f2258.53dd7","order":3,"width":"2","height":"1","passthru":false,"label":"Iniciar","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":510,"y":260,"wires":[["6c309f03.c1827","e795fa58.9a85f8","c6c77a2c.2b1b68"]]},{"id":"c6c77a2c.2b1b68","type":"change","z":"93413fb0.966e1","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"false","tot":"json"},{"t":"set","p":"process_id","pt":"global","to":"100","tot":"num"},{"t":"set","p":"ordematual.ordemInformacoes.statusDeOrdem","pt":"global","to":"Em produção","tot":"str"},{"t":"set","p":"reason_code","pt":"global","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":260,"wires":[["5efdf4b4.4e300c","759b29d.b24a9d8"]]},{"id":"4195337.8f275cc","type":"inject","z":"93413fb0.966e1","name":"Trigger","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":"1","x":140,"y":460,"wires":[["e7c44338.7950d"]]},{"id":"e7c44338.7950d","type":"function","z":"93413fb0.966e1","name":"Escreve na tabela","func":"var reason_code = global.get('reason_code');\nif(reason_code === 0){\n    msg.reason_code = 'Parada não informada';\n}\nif(reason_code === 1){\n    msg.reason_code = 'Produzindo';\n}\nif(reason_code === 200){\n    msg.reason_code = 'Setup';\n}\nif(reason_code === 300){\n    msg.reason_code = 'Ajuste / Regulagem';\n}\nif(reason_code === 999){\n    msg.reason_code = 'Manutenção planejada';\n}\nif(reason_code === 260){\n    msg.reason_code = 'Refeição';\n}\n\nvar velocidadereal = global.get('velocidade') || null;\nmsg.velocidadereal = velocidadereal;\n\nvar ordem = global.get('ordematual') || [];\nif(ordem === null){\n    return msg;\n}\nmsg.payload = ordem;\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":460,"wires":[["20c05c56.56d7f4"]]},{"id":"bef1e521.8a4b08","type":"comment","z":"93413fb0.966e1","name":"Atualiza painel de gestão a vista","info":"Atualiza painel de gestão a vista","x":210,"y":400,"wires":[]},{"id":"f294fad6.ca9f98","type":"ui_button","z":"93413fb0.966e1","name":"","group":"b11f2258.53dd7","order":5,"width":"3","height":"1","passthru":false,"label":"Encerrar Ordem","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":540,"y":580,"wires":[["74437ce7.b534d4","1c19612e.26e60f","d0356c2.354c39","5dde2766.f56eb8"]]},{"id":"74437ce7.b534d4","type":"change","z":"93413fb0.966e1","name":"","rules":[{"t":"set","p":"ordematual.ordemInformacoes.statusDeOrdem","pt":"global","to":"Encerrada","tot":"str"},{"t":"set","p":"process_id","pt":"global","to":"900","tot":"str"},{"t":"set","p":"reason_code","pt":"global","to":"null","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":660,"wires":[["f031ea27.1c2988"]]},{"id":"bfe1ecd4.70a3","type":"comment","z":"93413fb0.966e1","name":"Encerra ordem","info":"Encerra ordem","x":150,"y":520,"wires":[]},{"id":"968684b8.9efc58","type":"ui_template","z":"7e8bd831.628288","group":"bd160cb1.3394e","name":"Tabela Gestão a Vista","order":2,"width":"18","height":"5","format":"<!DOCTYPE html>\n<html>\n<head>\n<style>\ntable {\nborder-collapse: collapse;\nwidth: 100%;\nborder-collapse:separate;\n    -webkit-border-radius: 5px;\n    -moz-border-radius: 5px;\n            border-radius: 5px;\n}\n\nth, td {\npadding: 8px;\ntext-align: center;\nborder-collapse:separate;\n    -webkit-border-radius: 5px;\n    -moz-border-radius: 5px;\n            border-radius: 5px;\n}\n\ntd{\n    background: #faf7ff;\n}\n\nth{\n    background:#cccfdb;\n    border-collapse:separate;\n    -webkit-border-radius: 5px;\n    -moz-border-radius: 5px;\n            border-radius: 5px;\n}\n\ntd:hover {\n    border-collapse:separate;\n    border: solid #ccc 1px;\n    -webkit-border-radius: 5px;\n    -moz-border-radius: 5px;\n            border-radius: 5px;\n    background-color: #cbc7ff;\n;\n    }\n\n</style>\n</head>\n<body>\n\n<h2></h2>\n\n<table>\n<tr>\n    <th>Ordem</th>\n    <th>SKU</th>\n    <th>Status</th>\n    <th>Data Inicial</th>\n    <th>Data Final</th>\n    <th>Data Reprogramada</th>\n</tr>\n<tr>\n    <td>{{msg.payload.payload.ordemInformacoes.ordem}}</td>\n    <td>{{msg.payload.payload.skuInformacoes.sku}}</td>\n    <td>{{msg.payload.payload.ordemInformacoes.statusDeOrdem}}</td>\n    <td>{{msg.payload.payload.ordemInformacoes.dataInicial}}</td>\n    <td>{{msg.payload.payload.ordemInformacoes.dataFinal}}</td>\n    <td>{{msg.payload.payload.ordemInformacoes.dataReprogramada}}</td>\n</tr>\n</table>\n<h2></h2>\n<table>\n    <tr>\n        <th>Ciclo padrão [s]</th>\n        <th>Velocidade padrão [pçs/min]</th>\n        <th>Tempo previsto</th>\n        <th>Tempo de ordem</th>\n        <th>Quantidade prevista</th>\n        <th>Quantidade produzida</th>\n        <th>OEE</th>\n    </tr>\n    <tr>\n        <td>{{msg.payload.payload.skuInformacoes.ciclo}}</td>\n        <td>{{msg.payload.payload.skuInformacoes.velocidadePadrao}}</td>\n        <td>{{msg.payload.payload.skuInformacoes.tempoDeProducao}}</td>\n        <td>{{msg.payload.payload.ordemInformacoes.tempoProduzido}}</td>\n        <td>{{msg.payload.payload.skuInformacoes.quantidadePrevista}}</td>\n        <td>{{msg.payload.payload.ordemInformacoes.produzido}}</td>\n        <td>{{msg.payload.payload.ordemInformacoes.oeeAcc}}</td>\n    </tr>\n</table>\n</body>\n</html>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":660,"y":1180,"wires":[["35f3339f.aed1ac"]]},{"id":"e12edcbb.e271","type":"function","z":"93413fb0.966e1","name":"Process_id","func":"var process_id = global.get(\"process_id\") || [];\nif (process_id == 900){\n    var id = global.get(\"ordematual_id\") || [];\n    var rev = global.get(\"ordematual_rev\") || [];\n    var ordem = global.get(\"ordematual\") || [];\n    msg = {\n        \"payload\":{\n            \"_id\": id,\n            \"_rev\": rev,\n            \"payload\": ordem\n        }\n    }\n    ordem = null;\n    id = null;\n    process_id = 0;\n    global.set(\"ordematual\",ordem);\n    global.set(\"ordematual_id\",id);\n    global.set(\"ordematual_rev\",rev);\n    global.set(\"process_id\",process_id);\n    return msg;\n}","outputs":1,"noerr":0,"x":930,"y":700,"wires":[["2aa08a2f.2416f6"]]},{"id":"2aa08a2f.2416f6","type":"cloudant out","z":"93413fb0.966e1","name":"Salvar ordem","cloudant":"90d07383.5a36","database":"listadeordem","service":"_ext_","payonly":true,"operation":"insert","x":1140,"y":700,"wires":[]},{"id":"ce2ebfb2.55ddb","type":"function","z":"93413fb0.966e1","name":"Process_id","func":"var process_id = global.get(\"process_id\");\nif (process_id == 100){\n    var id = global.get(\"ordematual_id\") || [];\n    var rev = global.get(\"ordematual_rev\") || [];\n    var ordem = global.get(\"ordematual\") || [];\n    msg = {\n        \"payload\":{\n            \"_id\": id,\n            \"_rev\": rev,\n            \"payload\": ordem\n        }\n    }\n    process_id = 150;\n    global.set(\"process_id\",process_id);\n    return msg;\n}","outputs":1,"noerr":0,"x":1090,"y":260,"wires":[["6a9980b1.a98bc","cddbd764.a6e1d8"]]},{"id":"6a9980b1.a98bc","type":"cloudant out","z":"93413fb0.966e1","name":"Salvar ordem","cloudant":"90d07383.5a36","database":"listadeordem","service":"_ext_","payonly":true,"operation":"insert","x":1290,"y":260,"wires":[]},{"id":"d32ecd9.3f5643","type":"cloudant in","z":"93413fb0.966e1","name":"Consulta Ordem","cloudant":"90d07383.5a36","database":"listadeordem","service":"_ext_","search":"_id_","design":"","index":"","x":1640,"y":300,"wires":[["a99d5114.28fc3"]]},{"id":"cddbd764.a6e1d8","type":"delay","z":"93413fb0.966e1","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1280,"y":300,"wires":[["182361cf.be794e","551f4199.2ab68"]]},{"id":"182361cf.be794e","type":"function","z":"93413fb0.966e1","name":"_id","func":"var ordem = global.get(\"ordematual\") || [];\nmsg.payload = ordem.ordemInformacoes.ordem;\nreturn msg;\n","outputs":1,"noerr":0,"x":1450,"y":300,"wires":[["d32ecd9.3f5643"]]},{"id":"a99d5114.28fc3","type":"change","z":"93413fb0.966e1","name":"","rules":[{"t":"set","p":"ordematual","pt":"global","to":"payload.payload","tot":"msg"},{"t":"set","p":"ordematual_rev","pt":"global","to":"payload._rev","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1860,"y":300,"wires":[[]]},{"id":"242a88b.c589278","type":"comment","z":"7e8bd831.628288","name":"Reprogramar Ordem","info":"Reprogramar Ordem","x":210,"y":1040,"wires":[]},{"id":"919ddfbb.df3b7","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"ordematual","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1080,"y":820,"wires":[["d1783f93.d1cf"]]},{"id":"35f3339f.aed1ac","type":"function","z":"7e8bd831.628288","name":"Filtro","func":"var ordem = flow.get(\"ordematual\");\nif(ordem === null || ordem === undefined){\n    return;\n}\nif(ordem.payload.ordemInformacoes.statusDeOrdem !== \"Encerrada\" || ordem === null || ordem === undefined){\n    msg.enabled = false;\n    return msg;\n}\nif(ordem.payload.ordemInformacoes.statusDeOrdem === \"Encerrada\"){\n    msg.enabled = true;\n    return msg;\n}","outputs":1,"noerr":0,"x":250,"y":1100,"wires":[["2a6d79ba.68b616"]]},{"id":"2a6d79ba.68b616","type":"ui_button","z":"7e8bd831.628288","name":"","group":"bd160cb1.3394e","order":3,"width":"4","height":"1","passthru":false,"label":"Reprogramar Ordem","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":460,"y":1100,"wires":[["2988622c.3b9a2e","8597a5e.a549458"]]},{"id":"b2a11816.f19048","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"ordematual.payload.ordemInformacoes.statusDeOrdem","pt":"flow","to":"Reprogramada","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1060,"y":1100,"wires":[["e0a11dbf.e692d"]]},{"id":"e0a11dbf.e692d","type":"function","z":"7e8bd831.628288","name":"Reprogramar","func":"var ordem = flow.get(\"ordematual\") || [];\n    msg = {\n        \"payload\": ordem\n        }\nordem = null;\nflow.set(\"ordematual\",ordem);\nreturn msg;","outputs":1,"noerr":0,"x":1430,"y":1100,"wires":[["ce3fb968.c43718","9d51bc4.54dcc4"]]},{"id":"ce3fb968.c43718","type":"cloudant out","z":"7e8bd831.628288","name":"Salvar ordem","cloudant":"90d07383.5a36","database":"listadeordem","service":"_ext_","payonly":true,"operation":"insert","x":1640,"y":1120,"wires":[]},{"id":"3cf45352.1689ec","type":"link out","z":"7e8bd831.628288","name":"reprogramaOrdem","links":["92fadd66.5f0f6"],"x":1815,"y":1080,"wires":[]},{"id":"9d51bc4.54dcc4","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"null","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1650,"y":1080,"wires":[["3cf45352.1689ec"]]},{"id":"d1783f93.d1cf","type":"link out","z":"7e8bd831.628288","name":"selecionaOrdem","links":["4fccc181.a0ed7"],"x":1255,"y":820,"wires":[]},{"id":"4fccc181.a0ed7","type":"link in","z":"7e8bd831.628288","name":"atualizaOrdem","links":["d1783f93.d1cf"],"x":135,"y":1100,"wires":[["35f3339f.aed1ac"]]},{"id":"78906282.504f3c","type":"inject","z":"7e8bd831.628288","name":"Trigger","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":"1","x":200,"y":1180,"wires":[["7651386b.8ef518"]]},{"id":"7651386b.8ef518","type":"function","z":"7e8bd831.628288","name":"Escreve na tabela","func":"var ordem = flow.get('ordematual') || [];\nif(ordem === null){\n    return msg;\n}\nmsg.payload = ordem;\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":1180,"wires":[["968684b8.9efc58"]]},{"id":"c7419ee6.3d2f","type":"function","z":"93413fb0.966e1","name":"Process_id","func":"var process_id = global.get(\"process_id\") || 0;\nif (process_id !== 0){\n    msg.enabled = false;\n    return msg;\n}\nif (process_id === 0){\n    msg.enabled = true;\n    return msg;\n}","outputs":1,"noerr":0,"x":330,"y":260,"wires":[["44f7b835.806a88"]]},{"id":"9c0c0e6e.6d894","type":"inject","z":"93413fb0.966e1","name":"Trigger","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":"1","x":140,"y":260,"wires":[["c7419ee6.3d2f"]]},{"id":"f031ea27.1c2988","type":"link out","z":"93413fb0.966e1","name":"encerrarOrdem","links":["524ee5c4.2c631c","ca73faf6.381a88"],"x":915,"y":660,"wires":[]},{"id":"1d98b379.a9148d","type":"function","z":"93413fb0.966e1","name":"Process_id","func":"var process_id = global.get(\"process_id\") || 0;\nif (process_id !== 150){\n    msg.enabled = false;\n    return msg;\n}\nif (process_id === 150){\n    msg.enabled = true;\n    return msg;\n}","outputs":1,"noerr":0,"x":330,"y":580,"wires":[["f294fad6.ca9f98"]]},{"id":"721d5d2f.00fa64","type":"inject","z":"93413fb0.966e1","name":"Trigger","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":"1","x":140,"y":580,"wires":[["1d98b379.a9148d"]]},{"id":"f5d1240a.3c6048","type":"comment","z":"fa212271.2d00f","name":"Conta peças","info":"Encerra ordem","x":110,"y":200,"wires":[]},{"id":"2fcc03ac.a7c02c","type":"function","z":"fa212271.2d00f","name":"Conta peças","func":"var process_id = global.get(\"process_id\") || 0;\nvar reason_code = global.get('reason_code');\nif (process_id !== 150 || reason_code === 0){\n    msg1 = {\n        \"reset\":true\n    }\n    return [null,msg1,null]\n}\nif (process_id === 150 && reason_code === 1 && msg.topic === \"good\"){\n    return [msg,null,msg];\n}\nif (process_id === 150 && reason_code === 1){\n    return [msg,null,null];\n}\n","outputs":3,"noerr":0,"x":1090,"y":240,"wires":[["7be3cc6d.0841b4","9e5e4f1a.6a665","9babb1fc.dd234","c64003e7.11dc","289f6e71.09ae82"],["fab6fc01.2fd13"],["fab6fc01.2fd13"]]},{"id":"74407d11.f7e044","type":"moment","z":"fa212271.2d00f","name":"hour","topic":"","input":"","inputType":"date","inTz":"America/Sao_Paulo","adjAmount":"3","adjType":"hours","adjDir":"subtract","format":"H","locale":"en_US","output":"payload","outputType":"msg","outTz":"Etc/UTC","x":270,"y":60,"wires":[["263ba30b.a72cac"]]},{"id":"d71d3ba9.7ffa88","type":"inject","z":"fa212271.2d00f","name":"exec","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":60,"wires":[["74407d11.f7e044"]]},{"id":"263ba30b.a72cac","type":"function","z":"fa212271.2d00f","name":"set global context","func":"var hour = global.set(\"hour\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":60,"wires":[[]]},{"id":"17a325cd.f3e8ba","type":"function","z":"fa212271.2d00f","name":"get seconds of hour","func":"var seconds = global.get('secondsOfHour') || 0;\nvar time = msg.payload.split(\",\");\n\ntime[0] = parseInt(time[0]*60);\ntime[1] = parseInt(time[1]);\n\nseconds = time.reduce(function(anterior, atual) {\n  return anterior + atual;\n});\n\nglobal.set('secondsOfHour',seconds);\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":100,"wires":[[]]},{"id":"48b7c8f3.15f628","type":"moment","z":"fa212271.2d00f","name":"min/sec","topic":"","input":"","inputType":"date","inTz":"America/Sao_Paulo","adjAmount":"3","adjType":"hours","adjDir":"subtract","format":"mm,ss","locale":"en_US","output":"payload","outputType":"msg","outTz":"Etc/UTC","x":300,"y":100,"wires":[["17a325cd.f3e8ba"]]},{"id":"e4a54177.7e626","type":"inject","z":"fa212271.2d00f","name":"","topic":"","payload":"trigger","payloadType":"str","repeat":"0.5","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":100,"wires":[["48b7c8f3.15f628"]]},{"id":"7a5edafe.5f53e4","type":"comment","z":"fa212271.2d00f","name":"Registra a hora","info":"Registra a hora","x":120,"y":20,"wires":[]},{"id":"7be3cc6d.0841b4","type":"function","z":"fa212271.2d00f","name":"Dados de Produção","func":"var hour = global.get(\"hour\");\nvar data = global.get(\"data\");\nvar ordematual = global.get(\"ordematual\");\nvar ordem = ordematual.dadosDeProducao[data];\nvar goodProduction = ordem.goodProduction;\nvar badProduction = ordem.badProduction;\nvar totalProduction = ordem.totalProduction;\n\nif(msg.topic === \"good\"){\n    goodProduction[hour] ++;\n}\nif(msg.topic === \"bad\"){\n    badProduction[hour] ++;\n}\n\ntotalProduction[hour] = goodProduction[hour] + badProduction[hour];\nvar ttotalProduction = totalProduction.reduce(function(anterior, atual) {\n  return anterior + atual;\n});\n\nordematual.ordemInformacoes.produzido = ttotalProduction;\nordem.goodProduction = goodProduction;\nordem.badProduction = badProduction;\nordem.totalProduction = totalProduction;\n\nmsg.payload = goodProduction[hour];\n\nglobal.set(\"ordematual\",ordematual);\nreturn msg;","outputs":1,"noerr":0,"x":1320,"y":260,"wires":[[]]},{"id":"d6358416.af1598","type":"function","z":"fa212271.2d00f","name":"control random events","func":"if(msg.payload === 'start'){\n    global.set('count',true);\n    msg.topic = 'control';\n}\nif(msg.payload === 'stop'){\n    global.set('count',false);\n    msg.topic = 'control';\n}\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":260,"wires":[["9d6106aa.498138","b352799d.5b8d08","ff8ec231.f517a","60f30cad.c479e4"]]},{"id":"29263d46.bfd782","type":"change","z":"fa212271.2d00f","name":"delete trash","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"delay","pt":"msg"},{"t":"delete","p":"socketid","pt":"msg"},{"t":"delete","p":"_msgid","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":240,"wires":[["2fcc03ac.a7c02c"]]},{"id":"e0b42e3f.6f1da","type":"change","z":"fa212271.2d00f","name":"delete trash","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"delay","pt":"msg"},{"t":"delete","p":"socketid","pt":"msg"},{"t":"delete","p":"_msgid","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":280,"wires":[["2fcc03ac.a7c02c"]]},{"id":"9d6106aa.498138","type":"event","z":"fa212271.2d00f","name":"good production","controlTopic":"control","meanInterval":"1","distribution":"uniform","minInterval":"0","maxInterval":"1","outputTopic":"good","outputPayload":"timestamp","x":670,"y":280,"wires":[[]]},{"id":"b352799d.5b8d08","type":"event","z":"fa212271.2d00f","name":"bad production","controlTopic":"control","meanInterval":"2","distribution":"uniform","minInterval":"2","maxInterval":"10","outputTopic":"bad","outputPayload":"timestamp","x":660,"y":240,"wires":[[]]},{"id":"f42279b4.2e00e8","type":"ui_switch","z":"fa212271.2d00f","name":"","label":"Enable random inputs","tooltip":"","group":"361751bb.55a20e","order":13,"width":"5","height":"1","passthru":false,"decouple":"false","topic":"","style":"","onvalue":"start","onvalueType":"str","onicon":"","oncolor":"","offvalue":"stop","offvalueType":"str","officon":"","offcolor":"","x":140,"y":260,"wires":[["d6358416.af1598"]]},{"id":"922782a7.5d3ff","type":"comment","z":"fa212271.2d00f","name":"Tempo de Produção","info":"Tempo de Produção","x":130,"y":580,"wires":[]},{"id":"1ee805f9.d78a4a","type":"function","z":"fa212271.2d00f","name":"format time","func":"var seconds = msg.payload;\n\nif(msg.payload === undefined || msg.topic === 'stopped'){\n    seconds = 0;\n}\n\nfunction format(number){\n    if (number <= 9){\n\t    number = \"0\"+number;\n    }\n    return number;\n    }\n\nvar fhour = format(Math.round(seconds/3600));\nvar fmin = format(Math.floor((seconds%3600)/60));\nvar fseg = format((seconds%3600)%60);\n    \nvar formatedTime = fhour+\":\"+fmin+\":\"+fseg;\n\nif(formatedTime === 0){\n    return msg;\n}\nif(formatedTime !== 0){\n    msg.payload = formatedTime;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":640,"wires":[["a28c6410.2ef418"]]},{"id":"a28c6410.2ef418","type":"change","z":"fa212271.2d00f","name":"delete trash","rules":[{"t":"delete","p":"hour","pt":"msg"},{"t":"delete","p":"preState","pt":"msg"},{"t":"delete","p":"data","pt":"msg"},{"t":"delete","p":"topic","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":640,"wires":[[]]},{"id":"5709409c.bcace","type":"function","z":"fa212271.2d00f","name":"format time","func":"var seconds = msg.payload;\n\nif(msg.payload === undefined || msg.topic === 'stopped'){\n    seconds = 0;\n}\n\nfunction format(number){\n    if (number <= 9){\n\t    number = \"0\"+number;\n    }\n    return number;\n    }\n\nvar fhour = format(Math.round(seconds/3600));\nvar fmin = format(Math.floor((seconds%3600)/60));\nvar fseg = format((seconds%3600)%60);\n    \nvar formatedTime = fhour+\":\"+fmin+\":\"+fseg;\n\nif(formatedTime === 0){\n    return msg;\n}\nif(formatedTime !== 0){\n    msg.payload = formatedTime;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":870,"y":700,"wires":[["e3a67c2c.629e5"]]},{"id":"e3a67c2c.629e5","type":"change","z":"fa212271.2d00f","name":"delete trash","rules":[{"t":"delete","p":"hour","pt":"msg"},{"t":"delete","p":"preState","pt":"msg"},{"t":"delete","p":"data","pt":"msg"},{"t":"delete","p":"topic","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":700,"wires":[[]]},{"id":"44ffe7e1.5c0288","type":"function","z":"fa212271.2d00f","name":"get stop time","func":"if(global.get('ordematual') === null){\n    return;\n}\n\nvar hour = global.get('hour');\nvar data = global.get('data');\nvar ordematual = global.get('ordematual');\nvar ordem = ordematual.dadosDeProducao[data];\nvar time = ordem.timeStopMachine || [];\nvar stime = msg.payload;\n\nvar test = isNaN(stime);\n\nif(test === true){\n    stime = 0;\n}\n\nif(msg.payload === 0){\n    stime = 0;\n}\n\ntime[hour] = time[hour] + stime - (stime - 1);\nif(time[hour] < 0){\n    time[hour] = 0;\n}\n\nglobal.set('ordematual',ordematual);","outputs":1,"noerr":0,"x":870,"y":760,"wires":[[]]},{"id":"6dfecb95.e008f4","type":"dsm","z":"fa212271.2d00f","name":"running count time","sm_config":"{\n    \"currentState\": \"stopped\",\n    \"states\": {\n        \"stopped\": {\n            \"on\": \"started\"\n        },\n        \"started\": {\n            \"inc\": \"counting\",\n            \"off\": \"stopped\"\n        },\n        \"counting\": {\n            \"inc\": \"counting\",\n            \"off\": \"stopped\"\n        }\n    },\n    \"data\": {\n        \"prev_time\": null,\n        \"time\": 0,\n        \"seconds\": 0,\n        \"interval\": 1\n    },\n    \"methods\": {\n        \"init\": [\n            \"sm.calc_time = function () {\",\n            \"   var now = Date.now();\",\n            \"   sm.data.time += now - sm.data.prev_time;\",\n            \"   sm.data.prev_time = now;\",\n            \"   sm.data.seconds = Math.round(sm.data.time / 1000);\",\n            \"}\"\n        ],\n        \"on\": [\n            \"if (sm.currentState === 'started') {\",\n            \"   sm.data.prev_time = Date.now();\",\n            \"   node.send(msg);\",\n            \"   resume('inc', msg);\",\n            \"}\",\n            \"output = false;\"\n        ],\n        \"inc\": [\n            \"timeout.interval = setTimeout(function() {\",\n            \"   sm.calc_time();\",\n            \"   msg.data = sm.data;\",\n            \"   msg.payload = sm.data.seconds;\",\n            \"   node.send(msg);\",\n            \"   resume('inc', msg);\",\n            \"}, sm.data.interval*1000);\",\n            \"output = false;\"\n        ],\n        \"off\": [\n            \"clearTimeout(timeout.interval);\",\n            \"sm.calc_time();\",\n            \"msg.payload = sm.data.seconds;\",\n            \"sm.data.time = 0;\",\n            \"sm.data.seconds = 0;\"\n        ],\n        \"reset\": [\n            \"sm.data.time = 0;\",\n            \"sm.data.seconds = 0;\"\n        ],\n        \"status\": {\n            \"fill\": {\n                \"get\": \"sm.currentState === 'counting' ? 'green' : 'grey';\"\n            },\n            \"shape\": \"dot\",\n            \"text\": {\n                \"get\": \"'time '+ sm.data.seconds;\"\n            }\n        }\n    }\n}","x":640,"y":640,"wires":[["1ee805f9.d78a4a"]]},{"id":"4b25d8c4.fe9a78","type":"dsm","z":"fa212271.2d00f","name":"running count time","sm_config":"{\n    \"currentState\": \"stopped\",\n    \"states\": {\n        \"stopped\": {\n            \"off\": \"started\"\n        },\n        \"started\": {\n            \"inc\": \"counting\",\n            \"on\": \"stopped\"\n        },\n        \"counting\": {\n            \"inc\": \"counting\",\n            \"on\": \"stopped\"\n        }\n    },\n    \"data\": {\n        \"prev_time\": null,\n        \"time\": 0,\n        \"seconds\": 0,\n        \"interval\": 1\n    },\n    \"methods\": {\n        \"init\": [\n            \"sm.calc_time = function () {\",\n            \"   var now = Date.now();\",\n            \"   sm.data.time += now - sm.data.prev_time;\",\n            \"   sm.data.prev_time = now;\",\n            \"   sm.data.seconds = Math.round(sm.data.time / 1000);\",\n            \"}\"\n        ],\n        \"off\": [\n            \"if (sm.currentState === 'started') {\",\n            \"   sm.data.prev_time = Date.now();\",\n            \"   node.send(msg);\",\n            \"   resume('inc', msg);\",\n            \"}\",\n            \"output = false;\"\n        ],\n        \"inc\": [\n            \"timeout.interval = setTimeout(function() {\",\n            \"   sm.calc_time();\",\n            \"   msg.data = sm.data;\",\n            \"   msg.payload = sm.data.seconds;\",\n            \"   node.send(msg);\",\n            \"   resume('inc', msg);\",\n            \"}, sm.data.interval*1000);\",\n            \"output = false;\"\n        ],\n        \"on\": [\n            \"clearTimeout(timeout.interval);\",\n            \"sm.calc_time();\",\n            \"msg.payload = sm.data.seconds;\",\n            \"sm.data.time = 0;\",\n            \"sm.data.seconds = 0;\"\n        ],\n        \"reset\": [\n            \"sm.data.time = 0;\",\n            \"sm.data.seconds = 0;\"\n        ],\n        \"status\": {\n            \"fill\": {\n                \"get\": \"sm.currentState === 'counting' ? 'green' : 'grey';\"\n            },\n            \"shape\": \"dot\",\n            \"text\": {\n                \"get\": \"'time '+ sm.data.seconds;\"\n            }\n        }\n    }\n}","x":640,"y":700,"wires":[["5709409c.bcace","44ffe7e1.5c0288"]]},{"id":"3317490.7ad59b8","type":"function","z":"fa212271.2d00f","name":"get machine status","func":"if(msg.payload === 'running'){\n    var mstatus = 'running';\n    msg.topic = 'on';\n    global.set('reason_code',1);\n}\nif(msg.payload === 'stopped'){\n    var mstatus = 'stopped';\n    msg.topic = 'off';\n    global.set('reason_code',0);\n}\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":640,"wires":[["6dfecb95.e008f4","4b25d8c4.fe9a78"]]},{"id":"65f73755.751278","type":"ui_switch","z":"fa212271.2d00f","name":"","label":"Enable run machine","tooltip":"","group":"361751bb.55a20e","order":14,"width":"5","height":"1","passthru":false,"decouple":"false","topic":"","style":"","onvalue":"running","onvalueType":"str","onicon":"","oncolor":"","offvalue":"stopped","offvalueType":"str","officon":"","offcolor":"","x":140,"y":640,"wires":[["3317490.7ad59b8","e9d1ab3a.fb6658"]]},{"id":"32c1b822.ccef58","type":"dsm","z":"fa212271.2d00f","name":"running count time","sm_config":"{\n    \"currentState\": \"stopped\",\n    \"states\": {\n        \"stopped\": {\n            \"on\": \"started\"\n        },\n        \"started\": {\n            \"inc\": \"counting\",\n            \"off\": \"stopped\"\n        },\n        \"counting\": {\n            \"inc\": \"counting\",\n            \"off\": \"stopped\"\n        }\n    },\n    \"data\": {\n        \"prev_time\": null,\n        \"time\": 0,\n        \"seconds\": 0,\n        \"interval\": 1\n    },\n    \"methods\": {\n        \"init\": [\n            \"sm.calc_time = function () {\",\n            \"   var now = Date.now();\",\n            \"   sm.data.time += now - sm.data.prev_time;\",\n            \"   sm.data.prev_time = now;\",\n            \"   sm.data.seconds = Math.round(sm.data.time / 1000);\",\n            \"}\"\n        ],\n        \"on\": [\n            \"if (sm.currentState === 'started') {\",\n            \"   sm.data.prev_time = Date.now();\",\n            \"   node.send(msg);\",\n            \"   resume('inc', msg);\",\n            \"}\",\n            \"output = false;\"\n        ],\n        \"inc\": [\n            \"timeout.interval = setTimeout(function() {\",\n            \"   sm.calc_time();\",\n            \"   msg.data = sm.data;\",\n            \"   msg.payload = sm.data.seconds;\",\n            \"   node.send(msg);\",\n            \"   resume('inc', msg);\",\n            \"}, sm.data.interval*1000);\",\n            \"output = false;\"\n        ],\n        \"off\": [\n            \"clearTimeout(timeout.interval);\",\n            \"sm.calc_time();\",\n            \"msg.payload = sm.data.seconds;\",\n            \"sm.data.time = 0;\",\n            \"sm.data.seconds = 0;\"\n        ],\n        \"reset\": [\n            \"sm.data.time = 0;\",\n            \"sm.data.seconds = 0;\"\n        ],\n        \"status\": {\n            \"fill\": {\n                \"get\": \"sm.currentState === 'counting' ? 'green' : 'grey';\"\n            },\n            \"shape\": \"dot\",\n            \"text\": {\n                \"get\": \"'time '+ sm.data.seconds;\"\n            }\n        }\n    }\n}","x":560,"y":820,"wires":[["e32678c5.20cf48"]]},{"id":"44c0d172.0fd9","type":"inject","z":"fa212271.2d00f","name":"","topic":"","payload":"","payloadType":"date","repeat":"0.1","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":820,"wires":[["c64fba98.829b28","7f4cc043.6bc9d","4e934f7d.36c6d","9b7ed189.e4f43","c21a6404.9ee878","4c89e46.1d01e1c","f92d2046.b246c"]]},{"id":"c64fba98.829b28","type":"function","z":"fa212271.2d00f","name":"Process_id","func":"var process_id = global.get(\"process_id\") || [];\nif (process_id === 150){\n    msg.topic = 'on'\n    return msg;\n}\nif(process_id !== 150){\n    msg.topic = 'off';\n    return msg;\n}","outputs":1,"noerr":0,"x":330,"y":820,"wires":[["32c1b822.ccef58"]]},{"id":"e32678c5.20cf48","type":"function","z":"fa212271.2d00f","name":"Tempo de ordem","func":"if(global.get('ordematual') === null){\n    return;\n}\n\nvar hour = global.get('hour');\nvar data = global.get('data');\nvar ordematual = global.get('ordematual');\nvar ordem = ordematual.ordemInformacoes;\nvar time = ordem.tempoProduzidoSec;\nvar time1 = ordematual.dadosDeProducao[data].timeTotal;\nvar stime = msg.payload;\n\ntime = time + stime - (stime - 1);\nif(time < 0){\n    time = 0;\n}\n\ntime1[hour] = time1[hour] + stime - (stime - 1);\nif(time1[hour] < 0){\n    time1[hour] = 0;\n}\n\nfunction format(number){\n    if (number <= 9){\n\t    number = \"0\"+number;\n    }\n    return number;\n    }\n\nvar fhour = format(Math.round(time/3600));\nvar fmin = format(Math.floor((time%3600)/60));\nvar fseg = format((time%3600)%60);\n    \nvar formatedTime = fhour+\":\"+fmin+\":\"+fseg;\n\nif(formatedTime === 0){\n    return msg;\n}\nif(formatedTime !== 0){\n    ordem.tempoProduzido = formatedTime;\n}\n\nordem.tempoProduzidoSec = time;\nordematual.dadosDeProducao[data].timeTotal = time1;\n\nglobal.set('ordematual',ordematual);","outputs":1,"noerr":0,"x":800,"y":820,"wires":[[]]},{"id":"9049ec7a.dd34c","type":"inject","z":"fa212271.2d00f","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":1720,"wires":[["c3e4cf9c.c39f7","6ca9c3a9.2d8f3c"]]},{"id":"4a5b149d.eaf2bc","type":"ui_template","z":"fa212271.2d00f","group":"a54e7e9e.9e2a4","name":"Custom element style","order":7,"width":0,"height":0,"format":"<style>\n #level-hor-value {\n font-size: 1.4em;\n fill:black;\n }\n #level-minmax {\n font-size: 60%;\n fill:black;\n }\n #level-3x3-stripe {\n fill: #404040;\n }\n #level-ver-value {\n font-size: 1.8em;\n fill:#d0d0d0;\n }\n #chart-hour {\n font-size: 60%;\n fill:#d0d0d0;\n }\n #chart-stripe {\n fill: #404040;\n }\n\n</style>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":540,"y":1660,"wires":[[]]},{"id":"61e9eb47.52d404","type":"inject","z":"fa212271.2d00f","name":"init","topic":"init","payload":"create","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":120,"y":1660,"wires":[["cb0e69c1.adf948"]]},{"id":"cb0e69c1.adf948","type":"function","z":"fa212271.2d00f","name":"set site properties","func":"var unit = {\"h\":48,w:48}; // site sizes 1x1 wdget size\nvar colormap = {on:\"#47d147\",off:\"black\",warn:\"#ff9933\", high:\"#ff5c33\", full:\"red\"} // green, gray, orange, red \nvar site = {\"unit\":unit,\"widgetcolors\":colormap}; //merge to store to global as one variable\nglobal.set(\"site\",site);\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":1660,"wires":[["4a5b149d.eaf2bc"]]},{"id":"337a0edc.5e3452","type":"ui_template","z":"fa212271.2d00f","group":"a54e7e9e.9e2a4","name":"Produção","order":2,"width":"4","height":"2","format":"<svg width=100% height=100%>\n <defs>\n <filter id=\"level-filter\" x=\"0\" y=\"0\" width=\"200%\" height=\"200%\">\n <feOffset result=\"offOut\" in=\"SourceGraphic\" dx=\"1\" dy=\"1\" />\n <feColorMatrix result=\"matrixOut\" in=\"offOut\" type=\"matrix\"\n values=\"0.1 0 0 0 0 0 0.1 0 0 0 0 0 0.1 0 0 0 0 0 1 0\" />\n <feGaussianBlur result=\"blurOut\" in=\"matrixOut\" stdDeviation=\"5\" />\n <feBlend in=\"SourceGraphic\" in2=\"blurOut\" mode=\"normal\" />\n </filter>\n </defs>\n <rect ng-repeat=\"obj in msg.colors track by $index\" \n y=80% \n ng:attr:x=\"{{$index * 4}}px\"\n width=\"2\"\n height=\"6\" \n style=\"fill:{{msg.colors[$index]}}\" filter=\"url(#level-filter)\"\n />\n <text id=\"level-hor-value\"\n text-anchor=\"middle\" alignment-baseline=\"hanging\"\n x=50%\n y=0>\n {{msg.text}}\n </text>\n <text id=\"level-hor-value\"\n text-anchor=\"middle\" alignment-baseline=\"hanging\"\n x=50%\n y=50%>\n {{msg.value}}{{msg.valuesuffix}}\n </text>\n <text id=\"level-minmax\"\n text-anchor=\"start\" alignment-baseline=\"ideographic\"\n x=0\n y=80%>\n {{msg.min}}\n </text>\n <text id=\"level-minmax\"\n text-anchor=\"end\" alignment-baseline=\"ideographic\"\n x=100%\n y=80%>\n {{msg.max}}\n </text>\n</svg> ","storeOutMessages":false,"fwdInMessages":true,"templateScope":"local","x":680,"y":1720,"wires":[[]]},{"id":"c3e4cf9c.c39f7","type":"function","z":"fa212271.2d00f","name":"Configure","func":"if(global.get('ordematual') !== null){\n    msg.value = parseInt(((global.get(\"ordematual\").ordemInformacoes.produzido*100)/global.get(\"ordematual\").skuInformacoes.quantidadePrevista)*100)/100;\n    msg.min = 0; //expected minimum value of incoming data\n    msg.max = 100; //expected maximum value of incoming data\n    msg.valuesuffix = \"%\" //kind of data \n    msg.direction = \"horizontal\"; //widget look\n    msg.units = 4; //how many units widget takes in direction \n    msg.text=\"Produção\";\n}\n\nif(global.get(\"ordematual\") === null){\n    msg.value = 0;\n    msg.min = 0; //expected minimum value of incoming data\n    msg.max = 100; //expected maximum value of incoming data\n    msg.valuesuffix = \"%\" //kind of data \n    msg.direction = \"horizontal\"; //widget look\n    msg.units = 4; //how many units widget takes in direction \n    msg.text=\"Produção\"; \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":1720,"wires":[["a323bf6.4ed354"]]},{"id":"a323bf6.4ed354","type":"function","z":"fa212271.2d00f","name":"Generate","func":"//drawing of stripes will be done on exact pixels to avoid blur\n//calculated count of stripes will not fill 100% of area.\n\n\n// get global variables\nvar unit = global.get(\"site\").unit.h;\nvar colormap = global.get(\"site\").widgetcolors;\n// declare local variables\nvar c;\nvar colors = [];\n\n// how many stripes should be drawn according to calculated widget size\nvar count = Math.floor(unit * msg.units / 4) - 2; \n\n// parameters for range incoming values into size of widget\nvar params = {minin:msg.min, maxin:msg.max+1, minout:0, maxout:count};\n\n// range\nfunction range(n,params){\n var divisor = params.maxin - params.minin;\n n = ((n - params.minin) % divisor + divisor) % divisor + params.minin;\n n = ((n - params.minin) / (params.maxin - params.minin) * (params.maxout - params.minout)) + params.minout;\n return n;\n}\nvar rangedvalue = Math.round(range(msg.value,params));\n\n// determine color for each stripe\nfor(var i=0; i<count; i++){\n c = rangedvalue <= i ? colormap.off : ( i < (count-5) ? colormap.on : ( i < (count-2) ? colormap.warn : colormap.high));\n colors.push(c);\n}\n//vertical starts drawing from top. colors needed to be in reverse order \nif(msg.direction === \"vertical\"){\n colors.reverse();\n}\n\nif(msg.value >= msg.max){\n    for(var j=0; j<colors.length; j++){\n        c = colormap.full;\n        colors[j]=c;\n    }\n}\n\n// set msg parameters\nmsg.colors = colors;\n\n// for vertical, the last stripe will not be at the bottom exactly.\n// for adjusting min value position.\nmsg.minpos = count*4; \nreturn msg;","outputs":1,"noerr":0,"x":500,"y":1720,"wires":[["337a0edc.5e3452"]]},{"id":"214a25f0.e7535a","type":"comment","z":"fa212271.2d00f","name":"Gráficos Lineares","info":"Gráficos Lineares","x":120,"y":1600,"wires":[]},{"id":"66c83f1e.e3588","type":"ui_template","z":"fa212271.2d00f","group":"a54e7e9e.9e2a4","name":"Tempo","order":6,"width":"4","height":"2","format":"<svg width=100% height=100%>\n <defs>\n <filter id=\"level-filter\" x=\"0\" y=\"0\" width=\"200%\" height=\"200%\">\n <feOffset result=\"offOut\" in=\"SourceGraphic\" dx=\"1\" dy=\"1\" />\n <feColorMatrix result=\"matrixOut\" in=\"offOut\" type=\"matrix\"\n values=\"0.1 0 0 0 0 0 0.1 0 0 0 0 0 0.1 0 0 0 0 0 1 0\" />\n <feGaussianBlur result=\"blurOut\" in=\"matrixOut\" stdDeviation=\"5\" />\n <feBlend in=\"SourceGraphic\" in2=\"blurOut\" mode=\"normal\" />\n </filter>\n </defs>\n <rect ng-repeat=\"obj in msg.colors track by $index\" \n y=80% \n ng:attr:x=\"{{$index * 4}}px\"\n width=\"2\"\n height=\"6\" \n style=\"fill:{{msg.colors[$index]}}\" filter=\"url(#level-filter)\"\n />\n <text id=\"level-hor-value\"\n text-anchor=\"middle\" alignment-baseline=\"hanging\"\n x=50%\n y=0>\n {{msg.text}}\n </text>\n <text id=\"level-hor-value\"\n text-anchor=\"middle\" alignment-baseline=\"hanging\"\n x=50%\n y=50%>\n {{msg.value}}{{msg.valuesuffix}}\n </text>\n <text id=\"level-minmax\"\n text-anchor=\"start\" alignment-baseline=\"ideographic\"\n x=0\n y=80%>\n {{msg.min}}\n </text>\n <text id=\"level-minmax\"\n text-anchor=\"end\" alignment-baseline=\"ideographic\"\n x=100%\n y=80%>\n {{msg.max}}\n </text>\n</svg> ","storeOutMessages":false,"fwdInMessages":true,"templateScope":"local","x":670,"y":1780,"wires":[[]]},{"id":"6ca9c3a9.2d8f3c","type":"function","z":"fa212271.2d00f","name":"Configure","func":"if(global.get('ordematual') !== null){\n    msg.value = parseInt(((global.get(\"ordematual\").ordemInformacoes.tempoProduzidoSec*100)/global.get(\"ordematual\").skuInformacoes.tempoDeProducaoSec)*100)/100; //expected to be a number\n    msg.min = 0; //expected minimum value of incoming data\n    msg.max = 100; //expected maximum value of incoming data\n    msg.valuesuffix = \"%\" //kind of data \n    msg.direction = \"horizontal\"; //widget look\n    msg.units = 4; //how many units widget takes in direction \n    msg.text=\"Tempo\";\n}\n\nif(global.get(\"ordematual\") === null){\n    msg.value = 0;\n    msg.min = 0; //expected minimum value of incoming data\n    msg.max = 100; //expected maximum value of incoming data\n    msg.valuesuffix = \"%\" //kind of data \n    msg.direction = \"horizontal\"; //widget look\n    msg.units = 4; //how many units widget takes in direction \n    msg.text=\"Tempo\"; \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":320,"y":1780,"wires":[["2dcc2a50.2ddb76"]]},{"id":"2dcc2a50.2ddb76","type":"function","z":"fa212271.2d00f","name":"Generate","func":"//drawing of stripes will be done on exact pixels to avoid blur\n//calculated count of stripes will not fill 100% of area.\n\n\n// get global variables\nvar unit = global.get(\"site\").unit.h;\nvar colormap = global.get(\"site\").widgetcolors;\n// declare local variables\nvar c;\nvar colors = [];\n\n// how many stripes should be drawn according to calculated widget size\nvar count = Math.floor(unit * msg.units / 4) - 2; \n\n// parameters for range incoming values into size of widget\nvar params = {minin:msg.min, maxin:msg.max+1, minout:0, maxout:count};\n\n// range\nfunction range(n,params){\n var divisor = params.maxin - params.minin;\n n = ((n - params.minin) % divisor + divisor) % divisor + params.minin;\n n = ((n - params.minin) / (params.maxin - params.minin) * (params.maxout - params.minout)) + params.minout;\n return n;\n}\nvar rangedvalue = Math.round(range(msg.value,params));\n\n// determine color for each stripe\nfor(var i=0; i<count; i++){\n c = rangedvalue <= i ? colormap.off : ( i < (count-5) ? colormap.on : ( i < (count-2) ? colormap.warn : colormap.high));\n colors.push(c);\n}\n//vertical starts drawing from top. colors needed to be in reverse order \nif(msg.direction === \"vertical\"){\n colors.reverse();\n}\n\nif(msg.value >= msg.max){\n    for(var j=0; j<colors.length; j++){\n        c = colormap.full;\n        colors[j]=c;\n    }\n}\n\n\n// set msg parameters\nmsg.colors = colors;\n\n// for vertical, the last stripe will not be at the bottom exactly.\n// for adjusting min value position.\nmsg.minpos = count*4; \nreturn msg;","outputs":1,"noerr":0,"x":500,"y":1780,"wires":[["66c83f1e.e3588"]]},{"id":"dfaa9331.558a7","type":"inject","z":"b5ab8ba.7eb7578","name":"Inicialização","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"0.5","x":150,"y":100,"wires":[["c119ad40.f7be5","eb18bfe6.0555","773e9fe6.c429c"]]},{"id":"c119ad40.f7be5","type":"change","z":"b5ab8ba.7eb7578","name":"Reset global values","rules":[{"t":"set","p":"ordematual","pt":"global","to":"null","tot":"json"},{"t":"set","p":"process_id","pt":"global","to":"0","tot":"num"},{"t":"set","p":"reason_code","pt":"global","to":"null","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":370,"y":260,"wires":[["ff60269c.853a58"]]},{"id":"9e5e4f1a.6a665","type":"function","z":"fa212271.2d00f","name":"Qualidade","func":"var process_id = global.get('process_id') || 0;\nif(process_id !== 150){\n    return;\n}\n\nvar hour = global.get(\"hour\");\nvar data = global.get(\"data\");\nvar ordematual = global.get('ordematual');\nvar ordem = ordematual.dadosDeProducao[data];\nvar badProduction = ordem.badProduction;\nvar goodProduction = ordem.goodProduction;\nvar quality = ordem.qualidade || [];\nvar total = 0;\n\nfor (var h = 0; h < 24; h++) {\n    total = goodProduction[h] + badProduction[h];\n    quality[h] = (goodProduction[h]/total)*100;\n    quality[h] = parseInt(quality[h]*100)/100;\n    test = isNaN(quality[h]);\n    if(test === true){\n        quality[h] = 0;\n    }\n}\n\nglobal.set(\"ordematual\",ordematual);\n\nreturn msg;","outputs":1,"noerr":0,"x":1290,"y":380,"wires":[[]]},{"id":"1b9d2fa3.07948","type":"inject","z":"fa212271.2d00f","name":"Trigger","topic":"trigger","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":900,"y":200,"wires":[["2fcc03ac.a7c02c","f38b97ef.5e7d68","5d4d0e7d.b6975"]]},{"id":"9babb1fc.dd234","type":"function","z":"fa212271.2d00f","name":"Performance","func":"var process_id = global.get('process_id') || 0;\nif(process_id !== 150){\n    return;\n}\n\nvar hour = global.get(\"hour\");\nvar data = global.get(\"data\");\nvar ordematual = global.get(\"ordematual\");\nvar ordem = ordematual.dadosDeProducao[data];\nvar timeTP = ordem.timeProduzido;\nvar performance = ordem.performance;\nvar producao = ordem.totalProduction;\nvar meta = ordem.metaProducao;\n\nfor (var h = 0; h < 24; h++) {\n    meta[h] = (ordematual.skuInformacoes.velocidadePadrao / 60) * timeTP[h];\n    performance[h] = (producao[h]/meta[h])*100;\n    if(producao[h] === 0 && meta[h] === 0){\n        performance[h] = 0;\n    }\n    performance[h] = parseInt(performance[h]*100)/100;\n}\n\nglobal.set(\"ordematual\",ordematual);","outputs":1,"noerr":0,"x":1290,"y":440,"wires":[[]]},{"id":"c64003e7.11dc","type":"function","z":"fa212271.2d00f","name":"Disponibilidade","func":"var process_id = global.get('process_id') || 0;\nif(process_id !== 150){\n    return;\n}\nvar hour = global.get(\"hour\");\nvar data = global.get(\"data\");\nvar ordematual = global.get(\"ordematual\");\nvar ordem = ordematual.dadosDeProducao[data];\nvar availability = ordem.disponibilidade;\nvar timeTC = ordem.timeCarga;\nvar timeTP = ordem.timeProduzido;\nvar timeNA = ordem.timeNaoApontada;\nvar timeNP = ordem.timeUnscheduledStop;\n\nfor (var h = 0; h < 24; h++) {\n    timeTP[h] = timeTC[h] - (timeNA[h] + timeNP[h]);\n    availability[h] = parseInt((timeTP[h]/timeTC[h])*10000)/100;\n    if(timeTP[h] === 0 || timeTC[h] === 0){\n        availability[h] = 0;\n    }\n    if(h > hour){\n        availability[h] = 0;\n    }\n}\n\nglobal.set(\"ordematual\",ordematual);","outputs":1,"noerr":0,"x":1300,"y":500,"wires":[[]]},{"id":"63ec5831.8e53a8","type":"dsm","z":"fa212271.2d00f","name":"count time","sm_config":"{\n    \"currentState\": \"stopped\",\n    \"states\": {\n        \"stopped\": {\n            \"off\": \"started\"\n        },\n        \"started\": {\n            \"inc\": \"counting\",\n            \"on\": \"stopped\"\n        },\n        \"counting\": {\n            \"inc\": \"counting\",\n            \"on\": \"stopped\"\n        }\n    },\n    \"data\": {\n        \"prev_time\": null,\n        \"time\": 0,\n        \"seconds\": 0,\n        \"interval\": 1\n    },\n    \"methods\": {\n        \"init\": [\n            \"sm.calc_time = function () {\",\n            \"   var now = Date.now();\",\n            \"   sm.data.time += now - sm.data.prev_time;\",\n            \"   sm.data.prev_time = now;\",\n            \"   sm.data.seconds = Math.round(sm.data.time / 1000);\",\n            \"}\"\n        ],\n        \"off\": [\n            \"if (sm.currentState === 'started') {\",\n            \"   sm.data.prev_time = Date.now();\",\n            \"   node.send(msg);\",\n            \"   resume('inc', msg);\",\n            \"}\",\n            \"output = false;\"\n        ],\n        \"inc\": [\n            \"timeout.interval = setTimeout(function() {\",\n            \"   sm.calc_time();\",\n            \"   msg.data = sm.data;\",\n            \"   msg.payload = sm.data.seconds;\",\n            \"   node.send(msg);\",\n            \"   resume('inc', msg);\",\n            \"}, sm.data.interval*1000);\",\n            \"output = false;\"\n        ],\n        \"on\": [\n            \"clearTimeout(timeout.interval);\",\n            \"sm.calc_time();\",\n            \"msg.payload = sm.data.seconds;\",\n            \"sm.data.time = 0;\",\n            \"sm.data.seconds = 0;\"\n        ],\n        \"reset\": [\n            \"sm.data.time = 0;\",\n            \"sm.data.seconds = 0;\"\n        ],\n        \"status\": {\n            \"fill\": {\n                \"get\": \"sm.currentState === 'counting' ? 'green' : 'grey';\"\n            },\n            \"shape\": \"dot\",\n            \"text\": {\n                \"get\": \"'time '+ sm.data.seconds;\"\n            }\n        }\n    }\n}","x":530,"y":880,"wires":[["8df6b8ab.26ef28"]]},{"id":"8df6b8ab.26ef28","type":"function","z":"fa212271.2d00f","name":"Parada planejada","func":"if(global.get('ordematual') === null){\n    return;\n}\n\nvar hour = global.get('hour');\nvar data = global.get('data');\nvar ordematual = global.get('ordematual');\nvar ordem = ordematual.dadosDeProducao[data];\nvar time = ordem.timeScheduledStop;\nvar stime = msg.payload;\n\nif(msg.payload === 0){\n    stime = 0;\n}\n\ntime[hour] = time[hour] + stime - (stime - 1);\nif(time[hour] < 0){\n    time[hour] = 0;\n}\n\nordem.timeScheduledStop = time;\n\nglobal.set('ordematual',ordematual);","outputs":1,"noerr":0,"x":750,"y":880,"wires":[[]]},{"id":"7f4cc043.6bc9d","type":"function","z":"fa212271.2d00f","name":"reason_code","func":"var reason_code = global.get(\"reason_code\");\nif (reason_code === 260 || reason_code === 999){\n    msg.topic = 'off'\n    return msg;\n}\nif(reason_code !== 260 && reason_code !== 999){\n    msg.topic = 'on';\n    return msg;\n}","outputs":1,"noerr":0,"x":330,"y":880,"wires":[["63ec5831.8e53a8"]]},{"id":"32a92325.a37b9c","type":"comment","z":"fa212271.2d00f","name":"Apontamento de Paradas","info":"Apontamento de Paradas","x":150,"y":1860,"wires":[]},{"id":"f9d7fa4b.1e32f8","type":"function","z":"fa212271.2d00f","name":"reason_code","func":"var reason_code = global.get(\"reason_code\");\nvar process_id = global.get(\"process_id\");\nif (reason_code === 0 && process_id === 150){\n    return msg;\n    }\nif (reason_code === 1 || process_id !== 150){\n    msg.payload = \"stop\"\n    return msg;\n    }","outputs":1,"noerr":0,"x":210,"y":1940,"wires":[["b8cf63dd.7d9c5"]]},{"id":"230d5781.d9bac8","type":"change","z":"fa212271.2d00f","name":"delete trash","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":1940,"wires":[["ffa67f73.2a921"]]},{"id":"cea0aaca.3b93f8","type":"function","z":"fa212271.2d00f","name":"set stop","func":"if(msg.payload === 'Parada não programada'){\n    return [msg,null];\n}\nif(msg.payload === 'Parada programada'){\n    return [null,msg];\n}","outputs":2,"noerr":0,"x":220,"y":2000,"wires":[["f9319716.83aac8"],["379c4b7a.26c284"]]},{"id":"379c4b7a.26c284","type":"change","z":"fa212271.2d00f","name":"delete trash","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":2040,"wires":[["9c7ab7d8.55fd18"]]},{"id":"f9319716.83aac8","type":"change","z":"fa212271.2d00f","name":"delete trash","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":2000,"wires":[["8825c8a9.9bfbb8"]]},{"id":"ffa67f73.2a921","type":"ui_toast","z":"fa212271.2d00f","position":"dialog","displayTime":"3","highlight":"","outputs":1,"ok":"Parada não programada","cancel":"Parada programada","topic":"A máquina está parada, qual é o motivo?","name":"","x":830,"y":1940,"wires":[["cea0aaca.3b93f8"]]},{"id":"8825c8a9.9bfbb8","type":"ui_toast","z":"fa212271.2d00f","position":"dialog","displayTime":"3","highlight":"","outputs":1,"ok":"Setup","cancel":"Ajuste / Regulagem","topic":"Qual o motivo da parada não programada?","name":"","x":590,"y":2000,"wires":[["20fb03ec.16116c"]]},{"id":"9c7ab7d8.55fd18","type":"ui_toast","z":"fa212271.2d00f","position":"dialog","displayTime":"3","highlight":"","outputs":1,"ok":"Refeição","cancel":"Manutenção programada","topic":"Qual o motivo da parada programada?","name":"","x":590,"y":2040,"wires":[["20fb03ec.16116c"]]},{"id":"e9d1ab3a.fb6658","type":"link out","z":"fa212271.2d00f","name":"run","links":["33201b93.ab7d54"],"x":320,"y":680,"wires":[]},{"id":"33201b93.ab7d54","type":"link in","z":"fa212271.2d00f","name":"apontamento","links":["e9d1ab3a.fb6658","551f4199.2ab68"],"x":55,"y":1940,"wires":[["f9d7fa4b.1e32f8"]]},{"id":"20fb03ec.16116c","type":"function","z":"fa212271.2d00f","name":"reason_code","func":"var motivo = msg.payload;\nvar reason_code = 0;\nif(motivo === 'Setup'){\n    reason_code = 200;\n}\nif(motivo === 'Ajuste / Regulagem'){\n    reason_code = 300;\n}\nif(motivo === 'Refeição'){\n    reason_code = 260;\n}\nif(motivo === 'Manutenção programada'){\n    reason_code = 999;\n}\nglobal.set('reason_code',reason_code);\nmsg.reason_code = reason_code;\nreturn msg;","outputs":1,"noerr":0,"x":790,"y":2020,"wires":[[]]},{"id":"f5c95f4d.0ca77","type":"dsm","z":"fa212271.2d00f","name":"count time","sm_config":"{\n    \"currentState\": \"stopped\",\n    \"states\": {\n        \"stopped\": {\n            \"off\": \"started\"\n        },\n        \"started\": {\n            \"inc\": \"counting\",\n            \"on\": \"stopped\"\n        },\n        \"counting\": {\n            \"inc\": \"counting\",\n            \"on\": \"stopped\"\n        }\n    },\n    \"data\": {\n        \"prev_time\": null,\n        \"time\": 0,\n        \"seconds\": 0,\n        \"interval\": 1\n    },\n    \"methods\": {\n        \"init\": [\n            \"sm.calc_time = function () {\",\n            \"   var now = Date.now();\",\n            \"   sm.data.time += now - sm.data.prev_time;\",\n            \"   sm.data.prev_time = now;\",\n            \"   sm.data.seconds = Math.round(sm.data.time / 1000);\",\n            \"}\"\n        ],\n        \"off\": [\n            \"if (sm.currentState === 'started') {\",\n            \"   sm.data.prev_time = Date.now();\",\n            \"   node.send(msg);\",\n            \"   resume('inc', msg);\",\n            \"}\",\n            \"output = false;\"\n        ],\n        \"inc\": [\n            \"timeout.interval = setTimeout(function() {\",\n            \"   sm.calc_time();\",\n            \"   msg.data = sm.data;\",\n            \"   msg.payload = sm.data.seconds;\",\n            \"   node.send(msg);\",\n            \"   resume('inc', msg);\",\n            \"}, sm.data.interval*1000);\",\n            \"output = false;\"\n        ],\n        \"on\": [\n            \"clearTimeout(timeout.interval);\",\n            \"sm.calc_time();\",\n            \"msg.payload = sm.data.seconds;\",\n            \"sm.data.time = 0;\",\n            \"sm.data.seconds = 0;\"\n        ],\n        \"reset\": [\n            \"sm.data.time = 0;\",\n            \"sm.data.seconds = 0;\"\n        ],\n        \"status\": {\n            \"fill\": {\n                \"get\": \"sm.currentState === 'counting' ? 'green' : 'grey';\"\n            },\n            \"shape\": \"dot\",\n            \"text\": {\n                \"get\": \"'time '+ sm.data.seconds;\"\n            }\n        }\n    }\n}","x":530,"y":940,"wires":[["518c549.24951ac"]]},{"id":"518c549.24951ac","type":"function","z":"fa212271.2d00f","name":"Parada não planejada","func":"if(global.get('ordematual') === null){\n    return;\n}\n\nvar hour = global.get('hour');\nvar data = global.get('data');\nvar ordematual = global.get('ordematual');\nvar ordem = ordematual.dadosDeProducao[data];\nvar time = ordem.timeUnscheduledStop;\nvar stime = msg.payload;\n\nif(msg.payload === 0){\n    stime = 0;\n}\n\ntime[hour] = time[hour] + stime - (stime - 1);\nif(time[hour] < 0){\n    time[hour] = 0;\n}\n\nordem.timeUnscheduledStop = time;\n\nglobal.set('ordematual',ordematual);","outputs":1,"noerr":0,"x":760,"y":940,"wires":[[]]},{"id":"4e934f7d.36c6d","type":"function","z":"fa212271.2d00f","name":"reason_code","func":"var reason_code = global.get(\"reason_code\");\nif (reason_code === 200 || reason_code === 300){\n    msg.topic = 'off'\n    return msg;\n}\nif(reason_code !== 200 && reason_code !== 300){\n    msg.topic = 'on';\n    return msg;\n}","outputs":1,"noerr":0,"x":330,"y":940,"wires":[["f5c95f4d.0ca77"]]},{"id":"551f4199.2ab68","type":"link out","z":"93413fb0.966e1","name":"iniciaOrdem","links":["33201b93.ab7d54"],"x":1415,"y":340,"wires":[]},{"id":"b8cf63dd.7d9c5","type":"stoptimer","z":"fa212271.2d00f","duration":"5","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":420,"y":1940,"wires":[["230d5781.d9bac8"],[]]},{"id":"289f6e71.09ae82","type":"function","z":"fa212271.2d00f","name":"OEE","func":"var process_id = global.get('process_id') || 0;\nif(process_id !== 150){\n    return;\n}\n\nvar hour = global.get(\"hour\");\nvar data = global.get(\"data\");\nvar ordematual = global.get(\"ordematual\");\nvar ordem = ordematual.dadosDeProducao[data];\n\nif(process_id !== 0){\n    var quality = ordem.qualidade;\n    var performance = ordem.performance;\n    var availability = ordem.disponibilidade;\n    var oee = ordem.oee;\n    for (var h = 0; h < 24; h++) {\n        oee[h] = parseInt((performance[h] * quality[h] * availability[h]) / 100)/100;\n    }\n    global.set(\"ordematual\",ordematual);\n}\n","outputs":1,"noerr":0,"x":1270,"y":560,"wires":[[]]},{"id":"f38b97ef.5e7d68","type":"function","z":"fa212271.2d00f","name":"machine oee","func":"var process_id = global.get('process_id');\nvar msg1 = [];\nif(process_id === 0 || process_id === null){\n    msg.payload = 0;\n    return [msg,null];\n}\n\nvar data = global.get('data');\nvar ordematual = global.get(\"ordematual\");\nvar ordem = ordematual.dadosDeProducao[data];\n\nif(process_id !== 0){\n    var oee = ordem.oee;\n    var hour = global.get(\"hour\");\n    var instoee = flow.get(\"instoee\") || 0;\n    var count = context.get(\"count\") || 0;\n    var inst = context.get(\"inst\") || 0;\n\n    inst = 0;\n    instoee = 0;\n    count = 0;\n\n    for(var h = 0; 24 > h; h++){\n        if(oee[h] !== 0){\n        var oeeh = parseInt(oee[h]);\n        inst = parseInt(inst + oeeh);\n        count = parseInt(count + 1);\n        context.set(\"count\", count);\n        context.set(\"inst\", inst);\n        }\n        instoee = parseInt((inst / count)*100)/100;\n        flow.set(\"instoee\", instoee);\n    }\n\n    msg.payload = instoee;\n    msg1 = {\n        'payload': instoee\n    }\n    //ordem.dadosDeProducao[data].oeeAcc = msg1.payload;\n    //global.set('ordematual',ordematual);\n    return msg;\n}\nelse {\n    msg.payload = 0;\n    msg1.payload = 0;\n    //ordem.dadosDeProducao[data].oeeAcc = msg1.payload;\n    //global.set('ordematual',ordematual);\n    return msg;\n}","outputs":1,"noerr":0,"x":1290,"y":200,"wires":[["8eaeb75b.d4cfc8"]]},{"id":"8eaeb75b.d4cfc8","type":"ui_gauge","z":"fa212271.2d00f","name":"","group":"a54e7e9e.9e2a4","order":4,"width":"6","height":"4","gtype":"gage","title":"OEE","label":"%","format":"{{value}}","min":0,"max":"100","colors":["#ff0000","#ffff00","#00ff00"],"seg1":"30","seg2":"60","x":1470,"y":200,"wires":[]},{"id":"20c05c56.56d7f4","type":"ui_template","z":"93413fb0.966e1","group":"b11f2258.53dd7","name":"Tabela Gestão a Vista","order":6,"width":"18","height":"5","format":"<!DOCTYPE html>\n<html>\n<head>\n<style>\ntable {\nborder-collapse: collapse;\nwidth: 100%;\nborder-collapse:separate;\n    -webkit-border-radius: 5px;\n    -moz-border-radius: 5px;\n            border-radius: 5px;\n}\n\nth, td {\npadding: 8px;\ntext-align: center;\nborder-collapse:separate;\n    -webkit-border-radius: 5px;\n    -moz-border-radius: 5px;\n            border-radius: 5px;\n}\n\ntd{\n    background: #faf7ff;\n}\n\nth{\n    background:#cccfdb;\n    border-collapse:separate;\n    -webkit-border-radius: 5px;\n    -moz-border-radius: 5px;\n            border-radius: 5px;\n}\n\ntd:hover {\n    border-collapse:separate;\n    border: solid #ccc 1px;\n    -webkit-border-radius: 5px;\n    -moz-border-radius: 5px;\n            border-radius: 5px;\n    background-color: #cbc7ff;\n;\n    }\n\n</style>\n</head>\n<body>\n\n<h2></h2>\n\n<table>\n<tr>\n    <th>Ordem</th>\n    <th>SKU</th>\n    <th>Quantidade Prevista</th>\n    <th>Tempo Previsto</th>\n    <th>Velocidade Padrão [pç/min]</th>\n    <th>Velocidade Real [pç/min]</th>\n</tr>\n<tr>\n    <td>{{msg.payload.ordemInformacoes.ordem}}</td>\n    <td>{{msg.payload.skuInformacoes.sku}}</td>\n    <td>{{msg.payload.skuInformacoes.quantidadePrevista}}</td>\n    <td>{{msg.payload.skuInformacoes.tempoDeProducao}}</td>\n    <td>{{msg.payload.skuInformacoes.velocidadePadrao}}</td>\n    <td>{{msg.velocidadereal}}</td>\n</tr>\n</table>\n<h2></h2>\n<table>\n<tr>\n    <th>Quantidade Produzida</th>\n    <th>Tempo de Produção</th>\n    <th>Status da Ordem</th>\n    <th>Status do Processo</th>\n</tr>\n<tr>\n    <td>{{msg.payload.ordemInformacoes.produzido}}</td>\n    <td>{{msg.payload.ordemInformacoes.tempoProduzido}}</td>\n    <td>{{msg.payload.ordemInformacoes.statusDeOrdem}}</td>\n    <td>{{msg.reason_code}}</td>\n</tr>\n</table>\n\n</body>\n</html>\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":600,"y":460,"wires":[[]]},{"id":"1c19612e.26e60f","type":"change","z":"93413fb0.966e1","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":620,"wires":[["e12d3af3.835b38"]]},{"id":"7eef52ff.a8f36c","type":"link out","z":"93413fb0.966e1","name":"desligaSlide","links":["4d89b132.118ca"],"x":1115,"y":620,"wires":[]},{"id":"4d89b132.118ca","type":"link in","z":"fa212271.2d00f","name":"desligaSlide","links":["7eef52ff.a8f36c"],"x":35,"y":420,"wires":[["f42279b4.2e00e8","65f73755.751278"]]},{"id":"5efdf4b4.4e300c","type":"delay","z":"93413fb0.966e1","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":900,"y":260,"wires":[["ce2ebfb2.55ddb"]]},{"id":"46afad9b.ceb204","type":"inject","z":"fa212271.2d00f","name":"Trigger","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":900,"y":420,"wires":[["289f6e71.09ae82","c64003e7.11dc","9babb1fc.dd234","9e5e4f1a.6a665"]]},{"id":"2b037c66.70e414","type":"dsm","z":"fa212271.2d00f","name":"count time","sm_config":"{\n    \"currentState\": \"stopped\",\n    \"states\": {\n        \"stopped\": {\n            \"off\": \"started\"\n        },\n        \"started\": {\n            \"inc\": \"counting\",\n            \"on\": \"stopped\"\n        },\n        \"counting\": {\n            \"inc\": \"counting\",\n            \"on\": \"stopped\"\n        }\n    },\n    \"data\": {\n        \"prev_time\": null,\n        \"time\": 0,\n        \"seconds\": 0,\n        \"interval\": 1\n    },\n    \"methods\": {\n        \"init\": [\n            \"sm.calc_time = function () {\",\n            \"   var now = Date.now();\",\n            \"   sm.data.time += now - sm.data.prev_time;\",\n            \"   sm.data.prev_time = now;\",\n            \"   sm.data.seconds = Math.round(sm.data.time / 1000);\",\n            \"}\"\n        ],\n        \"off\": [\n            \"if (sm.currentState === 'started') {\",\n            \"   sm.data.prev_time = Date.now();\",\n            \"   node.send(msg);\",\n            \"   resume('inc', msg);\",\n            \"}\",\n            \"output = false;\"\n        ],\n        \"inc\": [\n            \"timeout.interval = setTimeout(function() {\",\n            \"   sm.calc_time();\",\n            \"   msg.data = sm.data;\",\n            \"   msg.payload = sm.data.seconds;\",\n            \"   node.send(msg);\",\n            \"   resume('inc', msg);\",\n            \"}, sm.data.interval*1000);\",\n            \"output = false;\"\n        ],\n        \"on\": [\n            \"clearTimeout(timeout.interval);\",\n            \"sm.calc_time();\",\n            \"msg.payload = sm.data.seconds;\",\n            \"sm.data.time = 0;\",\n            \"sm.data.seconds = 0;\"\n        ],\n        \"reset\": [\n            \"sm.data.time = 0;\",\n            \"sm.data.seconds = 0;\"\n        ],\n        \"status\": {\n            \"fill\": {\n                \"get\": \"sm.currentState === 'counting' ? 'green' : 'grey';\"\n            },\n            \"shape\": \"dot\",\n            \"text\": {\n                \"get\": \"'time '+ sm.data.seconds;\"\n            }\n        }\n    }\n}","x":530,"y":1000,"wires":[["74bdbbab.c2be44"]]},{"id":"74bdbbab.c2be44","type":"function","z":"fa212271.2d00f","name":"Parada setup","func":"if(global.get('ordematual') === null){\n    return;\n}\n\nvar hour = global.get('hour');\nvar data = global.get('data');\nvar ordematual = global.get('ordematual');\nvar ordem = ordematual.dadosDeProducao[data];\nvar time = ordem.timeSetup;\nvar stime = msg.payload;\n\nif(msg.payload === 0){\n    stime = 0;\n}\n\ntime[hour] = time[hour] + stime - (stime - 1);\nif(time[hour] < 0){\n    time[hour] = 0;\n}\n\nordem.timeSetup = time;\n\nglobal.set('ordematual',ordematual);","outputs":1,"noerr":0,"x":740,"y":1000,"wires":[[]]},{"id":"9b7ed189.e4f43","type":"function","z":"fa212271.2d00f","name":"reason_code","func":"var reason_code = global.get(\"reason_code\");\nif (reason_code === 200){\n    msg.topic = 'off'\n    return msg;\n}\nif(reason_code !== 200){\n    msg.topic = 'on';\n    return msg;\n}","outputs":1,"noerr":0,"x":330,"y":1000,"wires":[["2b037c66.70e414"]]},{"id":"1261b393.17359c","type":"dsm","z":"fa212271.2d00f","name":"count time","sm_config":"{\n    \"currentState\": \"stopped\",\n    \"states\": {\n        \"stopped\": {\n            \"off\": \"started\"\n        },\n        \"started\": {\n            \"inc\": \"counting\",\n            \"on\": \"stopped\"\n        },\n        \"counting\": {\n            \"inc\": \"counting\",\n            \"on\": \"stopped\"\n        }\n    },\n    \"data\": {\n        \"prev_time\": null,\n        \"time\": 0,\n        \"seconds\": 0,\n        \"interval\": 1\n    },\n    \"methods\": {\n        \"init\": [\n            \"sm.calc_time = function () {\",\n            \"   var now = Date.now();\",\n            \"   sm.data.time += now - sm.data.prev_time;\",\n            \"   sm.data.prev_time = now;\",\n            \"   sm.data.seconds = Math.round(sm.data.time / 1000);\",\n            \"}\"\n        ],\n        \"off\": [\n            \"if (sm.currentState === 'started') {\",\n            \"   sm.data.prev_time = Date.now();\",\n            \"   node.send(msg);\",\n            \"   resume('inc', msg);\",\n            \"}\",\n            \"output = false;\"\n        ],\n        \"inc\": [\n            \"timeout.interval = setTimeout(function() {\",\n            \"   sm.calc_time();\",\n            \"   msg.data = sm.data;\",\n            \"   msg.payload = sm.data.seconds;\",\n            \"   node.send(msg);\",\n            \"   resume('inc', msg);\",\n            \"}, sm.data.interval*1000);\",\n            \"output = false;\"\n        ],\n        \"on\": [\n            \"clearTimeout(timeout.interval);\",\n            \"sm.calc_time();\",\n            \"msg.payload = sm.data.seconds;\",\n            \"sm.data.time = 0;\",\n            \"sm.data.seconds = 0;\"\n        ],\n        \"reset\": [\n            \"sm.data.time = 0;\",\n            \"sm.data.seconds = 0;\"\n        ],\n        \"status\": {\n            \"fill\": {\n                \"get\": \"sm.currentState === 'counting' ? 'green' : 'grey';\"\n            },\n            \"shape\": \"dot\",\n            \"text\": {\n                \"get\": \"'time '+ sm.data.seconds;\"\n            }\n        }\n    }\n}","x":530,"y":1060,"wires":[["d24b36c7.8a9708"]]},{"id":"d24b36c7.8a9708","type":"function","z":"fa212271.2d00f","name":"Parada manutenção prod","func":"if(global.get('ordematual') === null){\n    return;\n}\n\nvar hour = global.get('hour');\nvar data = global.get('data');\nvar ordematual = global.get('ordematual');\nvar ordem = ordematual.dadosDeProducao[data];\nvar time = ordem.timeManutProd;\nvar stime = msg.payload;\n\nif(msg.payload === 0){\n    stime = 0;\n}\n\ntime[hour] = time[hour] + stime - (stime - 1);\nif(time[hour] < 0){\n    time[hour] = 0;\n}\n\nordem.timeManutProd = time;\n\nglobal.set('ordematual',ordematual);","outputs":1,"noerr":0,"x":770,"y":1060,"wires":[[]]},{"id":"c21a6404.9ee878","type":"function","z":"fa212271.2d00f","name":"reason_code","func":"var reason_code = global.get(\"reason_code\");\nif (reason_code === 300){\n    msg.topic = 'off'\n    return msg;\n}\nif(reason_code !== 300){\n    msg.topic = 'on';\n    return msg;\n}","outputs":1,"noerr":0,"x":330,"y":1060,"wires":[["1261b393.17359c"]]},{"id":"e90980bb.4e52c","type":"dsm","z":"fa212271.2d00f","name":"count time","sm_config":"{\n    \"currentState\": \"stopped\",\n    \"states\": {\n        \"stopped\": {\n            \"off\": \"started\"\n        },\n        \"started\": {\n            \"inc\": \"counting\",\n            \"on\": \"stopped\"\n        },\n        \"counting\": {\n            \"inc\": \"counting\",\n            \"on\": \"stopped\"\n        }\n    },\n    \"data\": {\n        \"prev_time\": null,\n        \"time\": 0,\n        \"seconds\": 0,\n        \"interval\": 1\n    },\n    \"methods\": {\n        \"init\": [\n            \"sm.calc_time = function () {\",\n            \"   var now = Date.now();\",\n            \"   sm.data.time += now - sm.data.prev_time;\",\n            \"   sm.data.prev_time = now;\",\n            \"   sm.data.seconds = Math.round(sm.data.time / 1000);\",\n            \"}\"\n        ],\n        \"off\": [\n            \"if (sm.currentState === 'started') {\",\n            \"   sm.data.prev_time = Date.now();\",\n            \"   node.send(msg);\",\n            \"   resume('inc', msg);\",\n            \"}\",\n            \"output = false;\"\n        ],\n        \"inc\": [\n            \"timeout.interval = setTimeout(function() {\",\n            \"   sm.calc_time();\",\n            \"   msg.data = sm.data;\",\n            \"   msg.payload = sm.data.seconds;\",\n            \"   node.send(msg);\",\n            \"   resume('inc', msg);\",\n            \"}, sm.data.interval*1000);\",\n            \"output = false;\"\n        ],\n        \"on\": [\n            \"clearTimeout(timeout.interval);\",\n            \"sm.calc_time();\",\n            \"msg.payload = sm.data.seconds;\",\n            \"sm.data.time = 0;\",\n            \"sm.data.seconds = 0;\"\n        ],\n        \"reset\": [\n            \"sm.data.time = 0;\",\n            \"sm.data.seconds = 0;\"\n        ],\n        \"status\": {\n            \"fill\": {\n                \"get\": \"sm.currentState === 'counting' ? 'green' : 'grey';\"\n            },\n            \"shape\": \"dot\",\n            \"text\": {\n                \"get\": \"'time '+ sm.data.seconds;\"\n            }\n        }\n    }\n}","x":530,"y":1120,"wires":[["cf51e8a1.d11c68"]]},{"id":"cf51e8a1.d11c68","type":"function","z":"fa212271.2d00f","name":"Parada refeição","func":"if(global.get('ordematual') === null){\n    return;\n}\n\nvar hour = global.get('hour');\nvar data = global.get('data');\nvar ordematual = global.get('ordematual');\nvar ordem = ordematual.dadosDeProducao[data];\nvar time = ordem.timeRefeicao;\nvar stime = msg.payload;\n\nif(msg.payload === 0){\n    stime = 0;\n}\n\ntime[hour] = time[hour] + stime - (stime - 1);\nif(time[hour] < 0){\n    time[hour] = 0;\n}\n\nordem.timeRefeicao = time;\n\nglobal.set('ordematual',ordematual);","outputs":1,"noerr":0,"x":740,"y":1120,"wires":[[]]},{"id":"4c89e46.1d01e1c","type":"function","z":"fa212271.2d00f","name":"reason_code","func":"var reason_code = global.get(\"reason_code\");\nif (reason_code === 260){\n    msg.topic = 'off'\n    return msg;\n}\nif(reason_code !== 260){\n    msg.topic = 'on';\n    return msg;\n}","outputs":1,"noerr":0,"x":330,"y":1120,"wires":[["e90980bb.4e52c"]]},{"id":"19563e22.7e13f2","type":"dsm","z":"fa212271.2d00f","name":"count time","sm_config":"{\n    \"currentState\": \"stopped\",\n    \"states\": {\n        \"stopped\": {\n            \"off\": \"started\"\n        },\n        \"started\": {\n            \"inc\": \"counting\",\n            \"on\": \"stopped\"\n        },\n        \"counting\": {\n            \"inc\": \"counting\",\n            \"on\": \"stopped\"\n        }\n    },\n    \"data\": {\n        \"prev_time\": null,\n        \"time\": 0,\n        \"seconds\": 0,\n        \"interval\": 1\n    },\n    \"methods\": {\n        \"init\": [\n            \"sm.calc_time = function () {\",\n            \"   var now = Date.now();\",\n            \"   sm.data.time += now - sm.data.prev_time;\",\n            \"   sm.data.prev_time = now;\",\n            \"   sm.data.seconds = Math.round(sm.data.time / 1000);\",\n            \"}\"\n        ],\n        \"off\": [\n            \"if (sm.currentState === 'started') {\",\n            \"   sm.data.prev_time = Date.now();\",\n            \"   node.send(msg);\",\n            \"   resume('inc', msg);\",\n            \"}\",\n            \"output = false;\"\n        ],\n        \"inc\": [\n            \"timeout.interval = setTimeout(function() {\",\n            \"   sm.calc_time();\",\n            \"   msg.data = sm.data;\",\n            \"   msg.payload = sm.data.seconds;\",\n            \"   node.send(msg);\",\n            \"   resume('inc', msg);\",\n            \"}, sm.data.interval*1000);\",\n            \"output = false;\"\n        ],\n        \"on\": [\n            \"clearTimeout(timeout.interval);\",\n            \"sm.calc_time();\",\n            \"msg.payload = sm.data.seconds;\",\n            \"sm.data.time = 0;\",\n            \"sm.data.seconds = 0;\"\n        ],\n        \"reset\": [\n            \"sm.data.time = 0;\",\n            \"sm.data.seconds = 0;\"\n        ],\n        \"status\": {\n            \"fill\": {\n                \"get\": \"sm.currentState === 'counting' ? 'green' : 'grey';\"\n            },\n            \"shape\": \"dot\",\n            \"text\": {\n                \"get\": \"'time '+ sm.data.seconds;\"\n            }\n        }\n    }\n}","x":530,"y":1180,"wires":[["c32eca9a.87c208"]]},{"id":"c32eca9a.87c208","type":"function","z":"fa212271.2d00f","name":"Parada manutenção plan","func":"if(global.get('ordematual') === null){\n    return;\n}\n\nvar hour = global.get('hour');\nvar data = global.get('data');\nvar ordematual = global.get('ordematual');\nvar ordem = ordematual.dadosDeProducao[data];\nvar time = ordem.timeManutPlan;\nvar stime = msg.payload;\n\nif(msg.payload === 0){\n    stime = 0;\n}\n\ntime[hour] = time[hour] + stime - (stime - 1);\nif(time[hour] < 0){\n    time[hour] = 0;\n}\n\nordem.timeManutPlan = time;\n\nglobal.set('ordematual',ordematual);","outputs":1,"noerr":0,"x":770,"y":1180,"wires":[[]]},{"id":"f92d2046.b246c","type":"function","z":"fa212271.2d00f","name":"reason_code","func":"var reason_code = global.get(\"reason_code\");\nif (reason_code === 999){\n    msg.topic = 'off'\n    return msg;\n}\nif(reason_code !== 999){\n    msg.topic = 'on';\n    return msg;\n}","outputs":1,"noerr":0,"x":330,"y":1180,"wires":[["19563e22.7e13f2"]]},{"id":"1c49753d.d3321b","type":"inject","z":"fa212271.2d00f","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":530,"y":1240,"wires":[["825d465e.c8f0e8"]]},{"id":"825d465e.c8f0e8","type":"function","z":"fa212271.2d00f","name":"Parada não apontada","func":"if(global.get('ordematual') === null){\n    return;\n}\n\nvar hour = global.get('hour');\nvar data = global.get('data');\nvar ordematual = global.get('ordematual');\nvar ordem = ordematual.dadosDeProducao[data];\nvar process_id = global.get('process_id') || 0;\n\nif(process_id !== 0){\n    var timeNA = ordem.timeNaoApontada;\n    var timeSS = ordem.timeScheduledStop;\n    var timeUS = ordem.timeUnscheduledStop;\n    var timeSM = ordem.timeStopMachine;\n    \n    timeNA[hour] = timeSM[hour] - (timeSS[hour] + timeUS[hour]);\n    ordem.timeNaoApontada = timeNA;\n    global.set('ordematual',ordematual);\n}\n\n","outputs":1,"noerr":0,"x":760,"y":1240,"wires":[[]]},{"id":"e07a0a5d.009898","type":"inject","z":"7cb4d8dd.834de8","name":"","topic":"","payload":"","payloadType":"date","repeat":"5","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":100,"wires":[["9a072c4f.6cd53","6003e297.89e43c"]]},{"id":"ff8ec231.f517a","type":"event","z":"fa212271.2d00f","name":"good production","controlTopic":"control","meanInterval":"1","distribution":"uniform","minInterval":"1","maxInterval":"2","outputTopic":"good","outputPayload":"timestamp","x":670,"y":320,"wires":[["e0b42e3f.6f1da"]]},{"id":"60f30cad.c479e4","type":"event","z":"fa212271.2d00f","name":"bad production","controlTopic":"control","meanInterval":"2","distribution":"uniform","minInterval":"5","maxInterval":"30","outputTopic":"bad","outputPayload":"timestamp","x":660,"y":200,"wires":[["29263d46.bfd782"]]},{"id":"9a072c4f.6cd53","type":"function","z":"7cb4d8dd.834de8","name":"Process_id","func":"var process_id = global.get(\"process_id\") || 0;\nif (process_id !== 0 && process_id !== 900){\n    var id = global.get(\"ordematual_id\") || [];\n    var rev = global.get(\"ordematual_rev\") || [];\n    var ordem = global.get(\"ordematual\") || [];\n    msg = {\n        \"payload\":{\n            \"_id\": id,\n            \"_rev\": rev,\n            \"payload\": ordem\n        }\n    }\n    return msg;\n}","outputs":1,"noerr":0,"x":330,"y":100,"wires":[["97539fec.1be1a"]]},{"id":"97539fec.1be1a","type":"cloudant out","z":"7cb4d8dd.834de8","name":"Salvar ordem","cloudant":"90d07383.5a36","database":"listadeordem","service":"_ext_","payonly":true,"operation":"insert","x":540,"y":100,"wires":[]},{"id":"2cae21c4.ee284e","type":"cloudant in","z":"7cb4d8dd.834de8","name":"Consulta ordens","cloudant":"90d07383.5a36","database":"listadeordem","service":"_ext_","search":"_id_","design":"","index":"","x":730,"y":160,"wires":[["a4b9d670.cfa448"]]},{"id":"a4b9d670.cfa448","type":"change","z":"7cb4d8dd.834de8","name":"","rules":[{"t":"set","p":"ordematual_id","pt":"global","to":"payload._id","tot":"msg"},{"t":"set","p":"ordematual_rev","pt":"global","to":"payload._rev","tot":"msg"},{"t":"set","p":"payload.payload","pt":"msg","to":"ordematual","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":160,"wires":[[]]},{"id":"12900c3.0a1c0f4","type":"function","z":"7cb4d8dd.834de8","name":"Process_id","func":"var process_id = global.get(\"process_id\") || 0;\nif (process_id !== 0 && process_id !== 900){\n    var ordem = global.get(\"ordematual\") || [];\n    msg = {\n        \"payload\":{\n            \"_id\": ordem.ordemInformacoes.ordem\n        }\n    }\n    return msg;\n}","outputs":1,"noerr":0,"x":510,"y":160,"wires":[["2cae21c4.ee284e"]]},{"id":"6003e297.89e43c","type":"delay","z":"7cb4d8dd.834de8","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":320,"y":160,"wires":[["12900c3.0a1c0f4"]]},{"id":"d168f192.ba7cc","type":"comment","z":"7cb4d8dd.834de8","name":"Update DB","info":"Update DB","x":100,"y":40,"wires":[]},{"id":"fab6fc01.2fd13","type":"interval-length","z":"fa212271.2d00f","format":"mills","bytopic":false,"minimum":"","maximum":"","window":"","timeout":false,"msgTimeout":"","minimumunit":"msecs","maximumunit":"msecs","windowunit":"msecs","msgTimeoutUnit":"msecs","reset":true,"startup":false,"msgField":"payload","timestampField":"timestamp","repeatTimeout":false,"name":"Velocidade","x":1290,"y":320,"wires":[["5d4d0e7d.b6975"],[]]},{"id":"5d4d0e7d.b6975","type":"function","z":"fa212271.2d00f","name":"Velocidade","func":"var velocidadeAmort = flow.get(\"velocidadeAmort\") || [0,0,0,0,0,0,0,0,0,0];\nvar process_id = global.get('process_id');\nvar count = global.get('count');\nvar interval = msg.payload;\n\nif(interval <= 800){\n    return;\n}\n\nvar velo = 60000 / interval;\n\nif(process_id !== 150 && process_id !== 100 && process_id !== 900){\n    msg.payload = 0;\n    return msg;\n}\nif(msg.topic === 'trigger' && count === true){\n    return;\n}\nif(msg.topic === 'trigger' && count === false){\n    velo = 0;\n}\n\nvelocidadeAmort[9] = velocidadeAmort[8];\nvelocidadeAmort[8] = velocidadeAmort[7];\nvelocidadeAmort[7] = velocidadeAmort[6];\nvelocidadeAmort[6] = velocidadeAmort[5];\nvelocidadeAmort[5] = velocidadeAmort[4];\nvelocidadeAmort[4] = velocidadeAmort[3];\nvelocidadeAmort[3] = velocidadeAmort[2];\nvelocidadeAmort[2] = velocidadeAmort[1];\nvelocidadeAmort[1] = velocidadeAmort[0];\nvelocidadeAmort[0] = velo;\nflow.set(\"velocidadeAmort\",velocidadeAmort);\nvar velocidade = velocidadeAmort.reduce(function(anterior, atual) {\n  return anterior + atual;\n});\nmsg.payload = parseInt((velocidade/10));\nreturn msg;","outputs":1,"noerr":0,"x":1490,"y":320,"wires":[["5301ce6.9b4553"]]},{"id":"5301ce6.9b4553","type":"change","z":"fa212271.2d00f","name":"","rules":[{"t":"set","p":"velocidade","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1720,"y":320,"wires":[[]]},{"id":"13fe9bc5.a38114","type":"ui_button","z":"fa212271.2d00f","name":"","group":"361751bb.55a20e","order":5,"width":"4","height":"1","passthru":false,"label":"Produção","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"hide\":[\"Produção_OEE\",\"Produção_Disponibilidade\",\"Produção_Performance\",\"Produção_Qualidade\",\"Produção_Perdas\",\"Produção_OEE_Acc\",\"Produção_Pareto\"],\"show\":[\"Produção_Produção\"]}}","payloadType":"json","topic":"","x":540,"y":2200,"wires":[["cd3e6a69.02e528"]]},{"id":"cd3e6a69.02e528","type":"ui_ui_control","z":"fa212271.2d00f","name":"","x":880,"y":2280,"wires":[[]]},{"id":"e2f08278.7d488","type":"ui_button","z":"fa212271.2d00f","name":"","group":"361751bb.55a20e","order":4,"width":"4","height":"1","passthru":false,"label":"Quadro","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"hide\":[\"Produção_Produção\",\"Produção_Disponibilidade\",\"Produção_Performance\",\"Produção_Qualidade\",\"Produção_Perdas\",\"Produção_OEE_Acc\",\"Produção_Pareto\"],\"show\":[\"Produção_OEE\"]}}","payloadType":"json","topic":"","x":540,"y":2160,"wires":[["cd3e6a69.02e528"]]},{"id":"b5cd915b.94eb3","type":"comment","z":"fa212271.2d00f","name":"Controle do Dash","info":"Controle do Dash","x":130,"y":2100,"wires":[]},{"id":"ff21d015.30dcc","type":"ui_button","z":"fa212271.2d00f","name":"","group":"361751bb.55a20e","order":6,"width":"4","height":"1","passthru":false,"label":"Disponibilidade","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"hide\":[\"Produção_Produção\",\"Produção_OEE\",\"Produção_Performance\",\"Produção_Qualidade\",\"Produção_Perdas\",\"Produção_OEE_Acc\",\"Produção_Pareto\"],\"show\":[\"Produção_Disponibilidade\"]}}","payloadType":"json","topic":"","x":560,"y":2240,"wires":[["cd3e6a69.02e528"]]},{"id":"467addd.c8d7b24","type":"ui_button","z":"fa212271.2d00f","name":"","group":"361751bb.55a20e","order":7,"width":"4","height":"1","passthru":false,"label":"Performance","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"hide\":[\"Produção_Produção\",\"Produção_Disponibilidade\",\"Produção_OEE\",\"Produção_Qualidade\",\"Produção_Perdas\",\"Produção_OEE_Acc\",\"Produção_Pareto\"],\"show\":[\"Produção_Performance\"]}}","payloadType":"json","topic":"","x":550,"y":2280,"wires":[["cd3e6a69.02e528"]]},{"id":"d6c37044.21af6","type":"ui_button","z":"fa212271.2d00f","name":"","group":"361751bb.55a20e","order":8,"width":"4","height":"1","passthru":false,"label":"Qualidade","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"hide\":[\"Produção_Produção\",\"Produção_Disponibilidade\",\"Produção_Performance\",\"Produção_OEE\",\"Produção_Perdas\",\"Produção_OEE_Acc\",\"Produção_Pareto\"],\"show\":[\"Produção_Qualidade\"]}}","payloadType":"json","topic":"","x":550,"y":2320,"wires":[["cd3e6a69.02e528"]]},{"id":"c5e16a00.f50bd8","type":"comment","z":"fa212271.2d00f","name":"Gráficos","info":"Gráficos","x":100,"y":2480,"wires":[]},{"id":"5b30b52a.1b3ddc","type":"function","z":"fa212271.2d00f","name":"format data for chart  ","func":"var process_id = global.get('process_id') || 0;\nif(process_id !== 150){\n    return;\n}\n\nvar data = global.get('data');\nvar ordem = global.get('ordematual') || [];\nvar disponibilidade = ordem.dadosDeProducao[data].disponibilidade;\nvar meta = [80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80];\nvar type = 'bar';\nvar labels = ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'];\nvar datasets = [{\n    'type': 'bar',\n    'label': 'Disponibilidade',\n    'data': disponibilidade,\n    'backgroundColor': 'rgba(180, 59, 255, 0.5)',\n    'borderColor': 'rgba(180, 59, 255, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(180, 59, 255, 1)'\n},\n{\n    'fill': false,\n    'type': 'line',\n    'label': 'Meta',\n    'data': meta,\n    'backgroundColor': 'rgba(255, 65, 59, 0.5)',\n    'borderColor': 'rgba(255, 65, 59, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(255, 65, 59, 1)'\n}];\nvar options = {\n    scales: {\n        xAxes: [{ stacked: true }],\n        yAxes: [{ stacked: true }]\n    },\n    title: {\n        display: true,\n        position: 'top',\n        fontSize: 20,\n        text: 'Disponibilidade'\n    }\n}\nvar duration = 0;\n\nmsg = {\n    'type': type,\n    'labels': labels,\n    'datasets': datasets,\n    'options': options,\n    'duration': duration        \n    };\n        \nreturn msg;","outputs":1,"noerr":0,"x":360,"y":2620,"wires":[["8d929c60.bede5"]]},{"id":"e6844fd4.997e4","type":"inject","z":"fa212271.2d00f","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":2620,"wires":[["5b30b52a.1b3ddc"]]},{"id":"8d929c60.bede5","type":"ui_template","z":"fa212271.2d00f","group":"6e9d9f1d.0385b","name":"Disponibilidade","order":6,"width":"18","height":"9","format":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <title>My Stacked Bar Chart</title>\n</head>\n<body>\n    <canvas id=\"chart\"></canvas>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js\"></script>\n\n    <script>\n        (function(scope) {\n        var timer = setInterval(function() { //check that the Morris libs are loaded, if not wait\n            clearInterval(timer);\n            var ctx = document.getElementById('chart');\n                var barChart = new Chart(ctx, {\n                    type: 'bar',\n                    data: {\n                        labels: ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'],\n                        datasets: []\n                    },\n                    options: {\n                        scales: {\n                            xAxes: [{ stacked: true }],\n                            yAxes: [{ stacked: true }]\n                        },\n                        title: {\n                            display: true,\n                            position: 'top',\n                            fontSize: 20,\n                        }\n                    }\n                });\n\n            scope.$watch('msg', function (msg) { //watch for an incoming NR msg\n                if (msg) {\n\n                    var data = msg.datasets;\n                    var options = msg;\n                \n                function addData(chart, payload, config) {\n                    chart.options.title.text = config.options.title.text;\n                    chart.data.datasets = payload;\n                    chart.update({ duration: 0 });\n                }\n                addData(barChart,data,options);\n                };\n            }); //close out the watch \n        }, 100); // close out the setInterval \n        })(scope);\n    </script>\n</body>\n</html>\n","storeOutMessages":false,"fwdInMessages":true,"templateScope":"local","x":600,"y":2620,"wires":[[]]},{"id":"ca64c5df.c58e48","type":"function","z":"fa212271.2d00f","name":"format data for chart  ","func":"var process_id = global.get('process_id') || 0;\nif(process_id !== 150){\n    return;\n}\nvar data = global.get('data');\nvar ordem = global.get('ordematual') || [];\nvar performance = ordem.dadosDeProducao[data].performance;\nvar meta = [80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80];\nvar type = 'bar';\nvar labels = ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'];\nvar datasets = [{\n    'type': 'bar',\n    'label': 'Performance',\n    'data': performance,\n    'backgroundColor': 'rgba(59, 59, 255, 0.5)',\n    'borderColor': 'rgba(59, 59, 255, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(59, 59, 255, 1)'\n},\n{\n    'fill': false,\n    'type': 'line',\n    'label': 'Meta',\n    'data': meta,\n    'backgroundColor': 'rgba(255, 65, 59, 0.5)',\n    'borderColor': 'rgba(255, 65, 59, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(255, 65, 59, 1)'\n}];\nvar options = {\n    scales: {\n        xAxes: [{ stacked: true }],\n        yAxes: [{ stacked: true }]\n    },\n    title: {\n        display: true,\n        position: 'top',\n        fontSize: 20,\n        text: 'Performance'\n    }\n}\nvar duration = 0;\n\nmsg = {\n    'type': type,\n    'labels': labels,\n    'datasets': datasets,\n    'options': options,\n    'duration': duration        \n    };\n        \nreturn msg;","outputs":1,"noerr":0,"x":360,"y":2580,"wires":[["ecb89c25.72fd6"]]},{"id":"3473fdfc.9bb712","type":"inject","z":"fa212271.2d00f","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":2580,"wires":[["ca64c5df.c58e48"]]},{"id":"ecb89c25.72fd6","type":"ui_template","z":"fa212271.2d00f","group":"e3b6e43b.656848","name":"Performance","order":6,"width":"18","height":"9","format":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <title>My Stacked Bar Chart</title>\n</head>\n<body>\n    <canvas id=\"chart\"></canvas>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js\"></script>\n\n    <script>\n        (function(scope) {\n        var timer = setInterval(function() { //check that the Morris libs are loaded, if not wait\n            clearInterval(timer);\n            var ctx = document.getElementById('chart');\n                var barChart = new Chart(ctx, {\n                    type: 'bar',\n                    data: {\n                        labels: ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'],\n                        datasets: []\n                    },\n                    options: {\n                        scales: {\n                            xAxes: [{ stacked: true }],\n                            yAxes: [{ stacked: true }]\n                        },\n                        title: {\n                            display: true,\n                            position: 'top',\n                            fontSize: 20,\n                        }\n                    }\n                });\n\n            scope.$watch('msg', function (msg) { //watch for an incoming NR msg\n                if (msg) {\n\n                    var data = msg.datasets;\n                    var options = msg;\n                \n                function addData(chart, payload, config) {\n                    chart.options.title.text = config.options.title.text;\n                    chart.data.datasets = payload;\n                    chart.update({ duration: 0 });\n                }\n                addData(barChart,data,options);\n                };\n            }); //close out the watch \n        }, 100); // close out the setInterval \n        })(scope);\n    </script>\n</body>\n</html>\n","storeOutMessages":false,"fwdInMessages":true,"templateScope":"local","x":590,"y":2580,"wires":[[]]},{"id":"7c1eb303.2f26bc","type":"function","z":"fa212271.2d00f","name":"format data for chart  ","func":"var process_id = global.get('process_id') || 0;\nif(process_id !== 150){\n    return;\n}\n\nvar data = global.get('data');\nvar ordem = global.get('ordematual') || [];\nvar qualidade = ordem.dadosDeProducao[data].qualidade;\nvar meta = [80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80];\nvar type = 'bar';\nvar labels = ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'];\nvar datasets = [{\n    'type': 'bar',\n    'label': 'Qualidade',\n    'data': qualidade,\n    'backgroundColor': 'rgba(98, 255, 59, 0.5)',\n    'borderColor': 'rgba(98, 255, 59, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(98, 255, 59, 1)'\n},\n{\n    'fill': false,\n    'type': 'line',\n    'label': 'Meta',\n    'data': meta,\n    'backgroundColor': 'rgba(255, 65, 59, 0.5)',\n    'borderColor': 'rgba(255, 65, 59, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(255, 65, 59, 1)'\n}];\nvar options = {\n    scales: {\n        xAxes: [{ stacked: true }],\n        yAxes: [{ stacked: true }]\n    },\n    title: {\n        display: true,\n        position: 'top',\n        fontSize: 20,\n        text: 'Qualidade'\n    }\n}\nvar duration = 0;\n\nmsg = {\n    'type': type,\n    'labels': labels,\n    'datasets': datasets,\n    'options': options,\n    'duration': duration        \n    };\n        \nreturn msg;","outputs":1,"noerr":0,"x":360,"y":2660,"wires":[["fcd92e6a.074fe"]]},{"id":"b5c5ed25.551e9","type":"inject","z":"fa212271.2d00f","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":2660,"wires":[["7c1eb303.2f26bc"]]},{"id":"fcd92e6a.074fe","type":"ui_template","z":"fa212271.2d00f","group":"d1d93dce.5c52e","name":"Qualidade","order":6,"width":"18","height":"9","format":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <title>My Stacked Bar Chart</title>\n</head>\n<body>\n    <canvas id=\"chart\"></canvas>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js\"></script>\n\n    <script>\n        (function(scope) {\n        var timer = setInterval(function() { //check that the Morris libs are loaded, if not wait\n            clearInterval(timer);\n            var ctx = document.getElementById('chart');\n                var barChart = new Chart(ctx, {\n                    type: 'bar',\n                    data: {\n                        labels: ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'],\n                        datasets: []\n                    },\n                    options: {\n                        scales: {\n                            xAxes: [{ stacked: true }],\n                            yAxes: [{ stacked: true }]\n                        },\n                        title: {\n                            display: true,\n                            position: 'top',\n                            fontSize: 20,\n                        }\n                    }\n                });\n\n            scope.$watch('msg', function (msg) { //watch for an incoming NR msg\n                if (msg) {\n\n                    var data = msg.datasets;\n                    var options = msg;\n                \n                function addData(chart, payload, config) {\n                    chart.options.title.text = config.options.title.text;\n                    chart.data.datasets = payload;\n                    chart.update({ duration: 0 });\n                }\n                addData(barChart,data,options);\n                };\n            }); //close out the watch \n        }, 100); // close out the setInterval \n        })(scope);\n    </script>\n</body>\n</html>\n","storeOutMessages":false,"fwdInMessages":true,"templateScope":"local","x":590,"y":2660,"wires":[[]]},{"id":"73d7103e.1d181","type":"function","z":"fa212271.2d00f","name":"format data for chart  ","func":"var process_id = global.get('process_id') || 0;\nif(process_id !== 150){\n    return;\n}\n\nvar data = global.get('data');\nvar ordem = global.get('ordematual') || [];\nvar oee = ordem.dadosDeProducao[data].oee;\nvar meta = [80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80];\nvar type = 'bar';\nvar labels = ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'];\nvar datasets = [{\n    'type': 'bar',\n    'label': 'OEE',\n    'data': oee,\n    'backgroundColor': 'rgba(255, 186, 59, 0.5)',\n    'borderColor': 'rgba(255, 186, 59, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(255, 186, 59, 1)'\n},\n{\n    'fill': false,\n    'type': 'line',\n    'label': 'Meta',\n    'data': meta,\n    'backgroundColor': 'rgba(255, 65, 59, 0.5)',\n    'borderColor': 'rgba(255, 65, 59, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(255, 65, 59, 1)'\n}];\nvar options = {\n    scales: {\n        xAxes: [{ stacked: true }],\n        yAxes: [{ stacked: true }]\n    },\n    title: {\n        display: true,\n        position: 'top',\n        fontSize: 20,\n        text: 'OEE'\n    }\n}\nvar duration = 0;\n\nmsg = {\n    'type': type,\n    'labels': labels,\n    'datasets': datasets,\n    'options': options,\n    'duration': duration        \n    };\n        \nreturn msg;","outputs":1,"noerr":0,"x":360,"y":2700,"wires":[["934a1451.fb8cd8"]]},{"id":"c85a32e5.f7c8e","type":"inject","z":"fa212271.2d00f","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":2700,"wires":[["73d7103e.1d181"]]},{"id":"934a1451.fb8cd8","type":"ui_template","z":"fa212271.2d00f","group":"de5fc37d.9535f","name":"OEE","order":6,"width":"18","height":"9","format":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <title>My Stacked Bar Chart</title>\n</head>\n<body>\n    <canvas id=\"chart\"></canvas>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js\"></script>\n\n    <script>\n        (function(scope) {\n        var timer = setInterval(function() { //check that the Morris libs are loaded, if not wait\n            clearInterval(timer);\n            var ctx = document.getElementById('chart');\n                var barChart = new Chart(ctx, {\n                    type: 'bar',\n                    data: {\n                        labels: ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'],\n                        datasets: []\n                    },\n                    options: {\n                        scales: {\n                            xAxes: [{ stacked: true }],\n                            yAxes: [{ stacked: true }]\n                        },\n                        title: {\n                            display: true,\n                            position: 'top',\n                            fontSize: 20,\n                        }\n                    }\n                });\n\n            scope.$watch('msg', function (msg) { //watch for an incoming NR msg\n                if (msg) {\n\n                    var data = msg.datasets;\n                    var options = msg;\n                \n                function addData(chart, payload, config) {\n                    chart.options.title.text = config.options.title.text;\n                    chart.data.datasets = payload;\n                    chart.update({ duration: 0 });\n                }\n                addData(barChart,data,options);\n                };\n            }); //close out the watch \n        }, 100); // close out the setInterval \n        })(scope);\n    </script>\n</body>\n</html>\n","storeOutMessages":false,"fwdInMessages":true,"templateScope":"local","x":570,"y":2700,"wires":[[]]},{"id":"1491702a.98895","type":"ui_button","z":"fa212271.2d00f","name":"","group":"361751bb.55a20e","order":10,"width":"4","height":"1","passthru":false,"label":"Perdas","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"hide\":[\"Produção_Produção\",\"Produção_Disponibilidade\",\"Produção_Performance\",\"Produção_Qualidade\",\"Produção_OEE\",\"Produção_OEE_Acc\",\"Produção_Pareto\"],\"show\":[\"Produção_Perdas\"]}}","payloadType":"json","topic":"","x":540,"y":2360,"wires":[["cd3e6a69.02e528"]]},{"id":"e7facce2.52e38","type":"function","z":"fa212271.2d00f","name":"format data for chart  ","func":"var process_id = global.get('process_id') || 0;\nif(process_id !== 150){\n    return;\n}\nvar data = global.get('data');\nvar ordem = global.get('ordematual') || [];\nvar goodProduction = ordem.dadosDeProducao[data].goodProduction;\nvar badProduction = ordem.dadosDeProducao[data].badProduction;\n\nvar type = 'bar';\nvar labels = ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'];\nvar datasets = [{\n    'type': 'bar',\n    'label': 'Peças boas',\n    'data': goodProduction,\n    'backgroundColor': 'rgba(60, 130, 0, 0.5)',\n    'borderColor': 'rgba(60, 130, 0, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(60, 130, 0, 1)'\n},\n{\n    'type': 'bar',\n    'label': 'Peças ruins',\n    'data': badProduction,\n    'backgroundColor': 'rgba(255, 65, 59, 0.5)',\n    'borderColor': 'rgba(255, 65, 59, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(255, 65, 59, 1)'\n}];\nvar options = {\n        scales: {\n            xAxes: [{ stacked: true }],\n            yAxes: [{ stacked: true }]\n        },\n        title: {\n            display: true,\n            position: 'top',\n            fontSize: 20,\n            text: 'Produção'\n        }\n}\nvar duration = 0;\n\nmsg = {\n    'type': type,\n    'labels': labels,\n    'datasets': datasets,\n    'options': options,\n    'duration': duration        \n    };\n\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":2540,"wires":[["74e44c24.3edea4"]]},{"id":"82c75307.8a9e7","type":"inject","z":"fa212271.2d00f","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":2540,"wires":[["e7facce2.52e38"]]},{"id":"aff39338.12aa4","type":"change","z":"75378547.fac50c","name":"","rules":[{"t":"set","p":"action","pt":"msg","to":"restore","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":589.5,"y":53,"wires":[[]]},{"id":"7e59d012.5605e","type":"json","z":"75378547.fac50c","name":"","x":175.5,"y":85,"wires":[["aff39338.12aa4"]]},{"id":"2fb84bfc.f507d4","type":"catch","z":"75378547.fac50c","name":"","scope":["7e59d012.5605e"],"x":183.5,"y":117,"wires":[["5b947015.8ff19"]]},{"id":"5b947015.8ff19","type":"change","z":"75378547.fac50c","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":354.5,"y":116,"wires":[["aff39338.12aa4"]]},{"id":"d6c96f3.73c199","type":"inject","z":"75378547.fac50c","name":"Trigger restore","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":618.5,"y":169,"wires":[[]]},{"id":"74e44c24.3edea4","type":"ui_template","z":"fa212271.2d00f","group":"f8a4e06.64dd62","name":"Produção","order":6,"width":"18","height":"9","format":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <title>My Stacked Bar Chart</title>\n</head>\n<body>\n    <canvas id=\"chart\"></canvas>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js\"></script>\n\n    <script>\n        (function(scope) {\n        var timer = setInterval(function() { //check that the Morris libs are loaded, if not wait\n            clearInterval(timer);\n            var ctx = document.getElementById('chart');\n                var barChart = new Chart(ctx, {\n                    type: 'bar',\n                    data: {\n                        labels: ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'],\n                        datasets: []\n                    },\n                    options: {\n                        scales: {\n                            xAxes: [{ stacked: true }],\n                            yAxes: [{ stacked: true }]\n                        },\n                        title: {\n                            display: true,\n                            position: 'top',\n                            fontSize: 20,\n                        }\n                    }\n                });\n\n            scope.$watch('msg', function (msg) { //watch for an incoming NR msg\n                if (msg) {\n\n                    var data = msg.datasets;\n                    var options = msg;\n                \n                function addData(chart, payload, config) {\n                    chart.options.title.text = config.options.title.text;\n                    chart.data.datasets = payload;\n                    chart.update({ duration: 0 });\n                }\n                addData(barChart,data,options);\n                };\n            }); //close out the watch \n        }, 100); // close out the setInterval \n        })(scope);\n    </script>\n</body>\n</html>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":580,"y":2540,"wires":[[]],"info":"<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"utf-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\r\n    <title>My Stacked Bar Chart</title>\r\n</head>\r\n<body>\r\n    <canvas id=\"chart\"></canvas>\r\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js\"></script>\r\n\r\n    <script>\r\n        (function(scope) {\r\n        var timer = setInterval(function() { //check that the Morris libs are loaded, if not wait\r\n            clearInterval(timer);\r\n            var ctx = document.getElementById('chart');\r\n                    var myChart = new Chart(ctx, {\r\n                        type: 'bar',\r\n                        data: {\r\n                            labels: [],\r\n                            datasets: [{\r\n                                data: []\r\n                            }]\r\n                        },\r\n                        options: {}\r\n                    });\r\n\r\n            scope.$watch('msg', function (msg) { //watch for an incoming NR msg\r\n                if (msg) {\r\n                    var data = msg;\r\n\r\n                    function addData(chart, data) {\r\n                        chart.type = data.type;\r\n                        chart.data.labels = data.labels;\r\n                        chart.data.datasets = [{\r\n                            type: data.datasets[0].type,\r\n                            label: data.datasets[0].label,\r\n                            data: data.datasets[0].data,\r\n                            backgroundColor: data.datasets[0].backgroundColor,\r\n                            borderColor: data.datasets[0].borderColor,\r\n                            borderWidth: data.datasets[0].borderWidth,\r\n                            hoverBackgroundColor: data.datasets[0].hoverBackgroundColor\r\n                        },\r\n                        {\r\n                            type: data.datasets[1].type,\r\n                            label: data.datasets[1].label,\r\n                            data: data.datasets[1].data,\r\n                            backgroundColor: data.datasets[1].backgroundColor,\r\n                            borderColor: data.datasets[1].borderColor,\r\n                            borderWidth: data.datasets[1].borderWidth,\r\n                            hoverBackgroundColor: data.datasets[1].hoverBackgroundColor\r\n                        }];    \r\n                        }\r\n                        chart.options = data.options;\r\n                        chart.update({ duration: data.duration });\r\n                    }\r\n                    addData(myChart,data);\r\n                    msg.payload = myChart;\r\n                    return msg;\r\n                };\r\n            }); //close out the watch \r\n        }, 100); // close out the setInterval \r\n        })(scope);\r\n    </script>\r\n</body>\r\n</html>\r\n"},{"id":"4791c2cb.29ca4c","type":"ui_button","z":"fa212271.2d00f","name":"","group":"361751bb.55a20e","order":9,"width":"4","height":"1","passthru":false,"label":"OEE","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"hide\":[\"Produção_Produção\",\"Produção_Disponibilidade\",\"Produção_Performance\",\"Produção_Qualidade\",\"Produção_Perdas\",\"Produção_OEE\",\"Produção_Pareto\"],\"show\":[\"Produção_OEE_Acc\"]}}","payloadType":"json","topic":"","x":530,"y":2400,"wires":[["cd3e6a69.02e528"]]},{"id":"c15dd586.24ca58","type":"function","z":"fa212271.2d00f","name":"format data for chart  ","func":"var process_id = global.get('process_id') || 0;\nif(process_id !== 150){\n    return;\n}\n\nvar data = global.get('data');\nvar ordem = global.get('ordematual') || [];\nvar timeNaoApontada = ordem.dadosDeProducao[data].timeNaoApontada;\nvar timeScheduledStop = ordem.dadosDeProducao[data].timeScheduledStop;\nvar timeUnscheduledStop = ordem.dadosDeProducao[data].timeUnscheduledStop;\nvar timeSetup = ordem.dadosDeProducao[data].timeSetup;\nvar timeManutProd = ordem.dadosDeProducao[data].timeManutProd;\nvar timeRefeicao = ordem.dadosDeProducao[data].timeRefeicao;\nvar timeManutPlan = ordem.dadosDeProducao[data].timeManutPlan;\n\nvar totaltimeNaoApontada = timeNaoApontada.reduce(function(anterior, atual) {\n    return anterior + atual;\n});\n\nvar totaltimeScheduledStop = timeScheduledStop.reduce(function(anterior, atual) {\n    return anterior + atual;\n});\n\nvar totaltimeUnscheduledStop = timeUnscheduledStop.reduce(function(anterior, atual) {\n    return anterior + atual;\n});\n\nvar totaltimeSetup = timeSetup.reduce(function(anterior, atual) {\n    return anterior + atual;\n});\n\nvar totaltimeManutProd = timeManutProd.reduce(function(anterior, atual) {\n    return anterior + atual;\n});\n\nvar totaltimeRefeicao = timeRefeicao.reduce(function(anterior, atual) {\n    return anterior + atual;\n});\n\nvar totaltimeManutPlan = timeManutPlan.reduce(function(anterior, atual) {\n    return anterior + atual;\n});\n\nvar doughnut1 = [totaltimeNaoApontada+totaltimeUnscheduledStop,totaltimeScheduledStop,0,0,0,0,0];\nvar doughnut2 = [0,0,totaltimeNaoApontada,totaltimeSetup,totaltimeManutProd,totaltimeRefeicao,totaltimeManutPlan];\n\nvar type = 'doughnut';\nvar labels = ['Parada não planejada','Parada planejada','Parada não apontada','Setup','Ajuste / Regulagem','Refeição','Manutenção Planejada'];\nvar datasets = [{\n    'type': 'doughnut',\n    'label': 'Paradas',\n    'data': doughnut1,\n    'backgroundColor': ['rgba(255, 59, 59, 0.5)','rgba(0, 163, 50, 0.5)','rgba(255, 167, 66, 0.5)','rgba(125, 54, 0, 0.5)','rgba(255, 204, 0, 0.5)','rgba(38, 42, 255, 0.5)','rgba(179, 255, 0, 0.5)'],\n    'borderColor': ['rgba(255, 59, 59, 1)','rgba(0, 163, 50, 1)','rgba(255, 167, 66, 1)','rgba(125, 54, 0, 1)','rgba(255, 204, 0, 1)','rgba(38, 42, 255, 1)','rgba(179, 255, 0, 1)'],\n    'borderWidth': 1,\n    'hoverBackgroundColor': ['rgba(255, 59, 59, 1)','rgba(0, 163, 50, 1)','rgba(255, 167, 66, 1)','rgba(125, 54, 0, 1)','rgba(255, 204, 0, 1)','rgba(38, 42, 255, 1)','rgba(179, 255, 0, 1)']\n},{\n    'type': 'doughnut',\n    'label': 'Paradas',\n    'data': doughnut2,\n    'backgroundColor': ['rgba(255, 59, 59, 0.5)','rgba(0, 163, 50, 0.5)','rgba(255, 167, 66, 0.5)','rgba(125, 54, 0, 0.5)','rgba(255, 204, 0, 0.5)','rgba(38, 42, 255, 0.5)','rgba(179, 255, 0, 0.5)'],\n    'borderColor': ['rgba(255, 59, 59, 1)','rgba(0, 163, 50, 1)','rgba(255, 167, 66, 1)','rgba(125, 54, 0, 1)','rgba(255, 204, 0, 1)','rgba(38, 42, 255, 1)','rgba(179, 255, 0, 1)'],\n    'borderWidth': 1,\n    'hoverBackgroundColor': ['rgba(255, 59, 59, 1)','rgba(0, 163, 50, 1)','rgba(255, 167, 66, 1)','rgba(125, 54, 0, 1)','rgba(255, 204, 0, 1)','rgba(38, 42, 255, 1)','rgba(179, 255, 0, 1)']\n}\n];\nvar options = {\n    scales: {\n        xAxes: [{ stacked: true }],\n        yAxes: [{ stacked: true }]\n    },\n    title: {\n        display: true,\n        position: 'top',\n        fontSize: 20,\n        text: 'Perdas'\n    }\n}\nvar duration = 0;\n\nmsg = {\n    'type': type,\n    'labels': labels,\n    'datasets': datasets,\n    'options': options,\n    'duration': duration        \n    };\n        \nreturn msg;","outputs":1,"noerr":0,"x":360,"y":2740,"wires":[["6f6b7fe6.bad82"]]},{"id":"5d23c59d.d65edc","type":"inject","z":"fa212271.2d00f","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":2740,"wires":[["c15dd586.24ca58"]]},{"id":"6f6b7fe6.bad82","type":"ui_template","z":"fa212271.2d00f","group":"ed31f2b1.1e3b4","name":"Perdas","order":6,"width":"18","height":"9","format":"    <!DOCTYPE html>\n    <html lang=\"en\">\n    <head>\n        <meta charset=\"utf-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n        <title>My Stacked Bar Chart</title>\n    </head>\n    <body>\n        <canvas id=\"chart\"></canvas>\n        <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js\"></script>\n\n        <script>\n            (function(scope) {\n            var timer = setInterval(function() { //check that the Morris libs are loaded, if not wait\n                clearInterval(timer);\n                var ctx = document.getElementById('chart');\n                    var barChart = new Chart(ctx, {\n                        type: 'doughnut',\n                        data: {\n                            labels: ['Parada não planejada','Parada planejada','Parada não apontada','Setup','Ajuste / Regulagem','Refeição','Manutenção Planejada'],\n                            datasets: []\n                        },\n                        options: {\n                            scales: {},\n                            title: {\n                                display: true,\n                                position: 'top',\n                                fontSize: 20,\n                            }\n                        }\n                    });\n\n                scope.$watch('msg', function (msg) { //watch for an incoming NR msg\n                    if (msg) {\n\n                        var data = msg.datasets;\n                        var options = msg;\n                    \n                    function addData(chart, payload, config) {\n                        chart.options.title.text = config.options.title.text;\n                        chart.data.datasets = payload;\n                        chart.update({ duration: 0 });\n                    }\n                    addData(barChart,data,options);\n                    };\n                }); //close out the watch \n            }, 100); // close out the setInterval \n            })(scope);\n        </script>\n    </body>\n    </html>\n","storeOutMessages":false,"fwdInMessages":true,"templateScope":"local","x":580,"y":2740,"wires":[[]]},{"id":"f2828ab0.4494c8","type":"inject","z":"fa212271.2d00f","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":530,"y":1280,"wires":[["55c19d7a.ffbb84"]]},{"id":"55c19d7a.ffbb84","type":"function","z":"fa212271.2d00f","name":"Tempo de carga","func":"if(global.get('ordematual') === null){\n    return;\n}\n\nvar hour = global.get('hour');\nvar data = global.get('data');\nvar ordematual = global.get('ordematual');\nvar ordem = ordematual.dadosDeProducao[data];\nvar process_id = global.get('process_id') || 0;\n\nif(process_id !== 0){\n    var timeTT = ordem.timeTotal;\n    var timeTC = ordem.timeCarga;\n    var timeSS = ordem.timeScheduledStop;\n    \n    timeTC[hour] = timeTT[hour] - timeSS[hour];\n    ordem.timeCarga = timeTC;\n    global.set('ordematual',ordematual);\n}\n\n","outputs":1,"noerr":0,"x":741,"y":1280,"wires":[[]]},{"id":"926b0e89.d6838","type":"function","z":"fa212271.2d00f","name":"get machine status","func":"var ordem = global.get(\"ordematual\");\nvar process_id = global.get(\"process_id\");\nvar reason_code = global.get(\"reason_code\");\n\nif(process_id === 0 && reason_code !== 0){\n    global.set('reason_code',0);\n    msg = {\n        'topic': 'off'\n    };\n    msg1 = {\n        'topic': 'on'\n    }\n    return [msg,msg1];\n}\n\nif(reason_code === 0){\n    msg = {\n        'topic': 'off'\n    };\n    msg1 = {\n        'topic': 'off'\n    }\n    return [msg,msg1];\n}","outputs":2,"noerr":0,"x":390,"y":720,"wires":[["6dfecb95.e008f4"],["4b25d8c4.fe9a78"]]},{"id":"bf6c7cf.3c8d18","type":"inject","z":"fa212271.2d00f","name":"trigger","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":720,"wires":[["926b0e89.d6838"]]},{"id":"554c36a.a19aec8","type":"ui_ui_control","z":"b5ab8ba.7eb7578","name":"","x":580,"y":300,"wires":[[]]},{"id":"eb18bfe6.0555","type":"change","z":"b5ab8ba.7eb7578","name":"Organiza os grupos","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"group\":{\"hide\":[\"Receitas_Alterar_SKU\",\"Receitas_Deletar_SKU\",\"Produção_Produção\",\"Produção_Disponibilidade\",\"Produção_Performance\",\"Produção_Qualidade\",\"Produção_Perdas\",\"Produção_OEE_Acc\",\"Produção_Pareto\",\"Ordem_Data\",\"Ordem_Consultar_ordem\",\"Ordem_Produção\",\"Ordem_Disponibilidade\",\"Ordem_Performance\",\"Ordem_Qualidade\",\"Ordem_Perdas\",\"Ordem_OEE_Acc\",\"Ordem_Pareto\"],\"show\":[\"Receitas_Criar_SKU\",\"Produção_OEE\",\"Ordem_Abrir_ordem\"]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":370,"y":300,"wires":[["554c36a.a19aec8"]]},{"id":"6c309f03.c1827","type":"moment","z":"93413fb0.966e1","name":"Data","topic":"","input":"","inputType":"date","inTz":"America/Sao_Paulo","adjAmount":"3","adjType":"hours","adjDir":"subtract","format":"DD/MM/YYYY - HH:mm:ss (Z)","locale":"en_US","output":"data","outputType":"msg","outTz":"Etc/UTC","x":670,"y":300,"wires":[["3977d785.3e6bf8"]]},{"id":"3977d785.3e6bf8","type":"change","z":"93413fb0.966e1","name":"Data Inicial","rules":[{"t":"set","p":"ordematual.ordemInformacoes.dataInicial","pt":"global","to":"data","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":300,"wires":[[]]},{"id":"d0356c2.354c39","type":"moment","z":"93413fb0.966e1","name":"Data","topic":"","input":"","inputType":"date","inTz":"America/Sao_Paulo","adjAmount":"3","adjType":"hours","adjDir":"subtract","format":"DD/MM/YYYY - HH:mm:ss (Z)","locale":"en_US","output":"data","outputType":"msg","outTz":"Etc/UTC","x":730,"y":580,"wires":[["d3e0da79.727798"]]},{"id":"d3e0da79.727798","type":"change","z":"93413fb0.966e1","name":"","rules":[{"t":"set","p":"ordematual.ordemInformacoes.dataFinal","pt":"global","to":"data","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1030,"y":580,"wires":[[]]},{"id":"2988622c.3b9a2e","type":"moment","z":"7e8bd831.628288","name":"Data","topic":"","input":"","inputType":"date","inTz":"America/Sao_Paulo","adjAmount":"3","adjType":"hours","adjDir":"subtract","format":"DD/MM/YYYY - HH:mm:ss (Z)","locale":"en_US","output":"data","outputType":"msg","outTz":"Etc/UTC","x":670,"y":1060,"wires":[["eb787344.237f9"]]},{"id":"eb787344.237f9","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"ordematual.payload.ordemInformacoes.dataReprogramada","pt":"flow","to":"data","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1030,"y":1060,"wires":[[]]},{"id":"8597a5e.a549458","type":"delay","z":"7e8bd831.628288","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":690,"y":1100,"wires":[["b2a11816.f19048"]]},{"id":"36cecc96.5ffea4","type":"comment","z":"7e8bd831.628288","name":"Gráficos","info":"Gráficos","x":180,"y":1260,"wires":[]},{"id":"aad336ea.9b8a98","type":"inject","z":"7e8bd831.628288","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":1340,"wires":[["f1e43a35.011088"]]},{"id":"f1e43a35.011088","type":"function","z":"7e8bd831.628288","name":"Ordem atual","func":"var ordem = flow.get('ordematual');\nif(ordem === null){\n    msg.enabled = false;\n    msg1 = {\n        'payload': 'ok'\n    }\n    return [msg,msg1];\n}\nmsg.enabled = true;\nreturn [msg,null];","outputs":2,"noerr":0,"x":390,"y":1340,"wires":[["bd6d7d5a.2e321","604363a3.39049c","e8a4b344.43b39","ff1fa89b.a04b88","138ee137.bf5c4f","61bf3d07.744194","2c97cfdf.70af6"],["24d878be.9e84f8"]]},{"id":"bd6d7d5a.2e321","type":"ui_button","z":"7e8bd831.628288","name":"","group":"3915cecb.4b6d32","order":5,"width":"4","height":"1","passthru":false,"label":"Produção","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"hide\":[\"Ordem_OEE\",\"Ordem_Disponibilidade\",\"Ordem_Performance\",\"Ordem_Qualidade\",\"Ordem_Perdas\",\"Ordem_OEE_Acc\",\"Ordem_Pareto\"],\"show\":[\"Ordem_Produção\",\"Ordem_Data\"]}}","payloadType":"json","topic":"","x":580,"y":1340,"wires":[["70c8d6d0.f9d578"]]},{"id":"70c8d6d0.f9d578","type":"ui_ui_control","z":"7e8bd831.628288","name":"","x":920,"y":1420,"wires":[[]]},{"id":"604363a3.39049c","type":"ui_button","z":"7e8bd831.628288","name":"","group":"3915cecb.4b6d32","order":6,"width":"4","height":"1","passthru":false,"label":"Disponibilidade","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"hide\":[\"Ordem_Produção\",\"Ordem_OEE\",\"Ordem_Performance\",\"Ordem_Qualidade\",\"Ordem_Perdas\",\"Ordem_OEE_Acc\",\"Ordem_Pareto\"],\"show\":[\"Ordem_Disponibilidade\",\"Ordem_Data\"]}}","payloadType":"json","topic":"","x":600,"y":1380,"wires":[["70c8d6d0.f9d578"]]},{"id":"e8a4b344.43b39","type":"ui_button","z":"7e8bd831.628288","name":"","group":"3915cecb.4b6d32","order":7,"width":"4","height":"1","passthru":false,"label":"Performance","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"hide\":[\"Ordem_Produção\",\"Ordem_Disponibilidade\",\"Ordem_OEE\",\"Ordem_Qualidade\",\"Ordem_Perdas\",\"Ordem_OEE_Acc\",\"Ordem_Pareto\"],\"show\":[\"Ordem_Performance\",\"Ordem_Data\"]}}","payloadType":"json","topic":"","x":590,"y":1420,"wires":[["70c8d6d0.f9d578"]]},{"id":"138ee137.bf5c4f","type":"ui_button","z":"7e8bd831.628288","name":"","group":"3915cecb.4b6d32","order":8,"width":"4","height":"1","passthru":false,"label":"Qualidade","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"hide\":[\"Ordem_Produção\",\"Ordem_Disponibilidade\",\"Ordem_Performance\",\"Ordem_OEE\",\"Ordem_Perdas\",\"Ordem_OEE_Acc\",\"Ordem_Pareto\"],\"show\":[\"Ordem_Qualidade\",\"Ordem_Data\"]}}","payloadType":"json","topic":"","x":590,"y":1460,"wires":[["70c8d6d0.f9d578"]]},{"id":"d22f5ecf.c73fd","type":"function","z":"7e8bd831.628288","name":"format data for chart  ","func":"var index = 0;\nvar lista = [];\n\nfor(index in flow.get('ordematual').payload.dadosDeProducao){\n    lista.push(flow.get('ordematual').payload.dadosDeProducao.data)\n}\n\nif(lista.length <= 0){\n    msg.payload = \"\";\n    return msg;\n}\n\n\nvar data = flow.get('data');\nvar ordem = flow.get('ordematual').payload;\n\nvar disponibilidade = ordem.dadosDeProducao[data].disponibilidade;\nvar meta = [80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80];\nvar type = 'bar';\nvar labels = ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'];\nvar datasets = [{\n    'type': 'bar',\n    'label': 'Disponibilidade',\n    'data': disponibilidade,\n    'backgroundColor': 'rgba(180, 59, 255, 0.5)',\n    'borderColor': 'rgba(180, 59, 255, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(180, 59, 255, 1)'\n},\n{\n    'fill': false,\n    'type': 'line',\n    'label': 'Meta',\n    'data': meta,\n    'backgroundColor': 'rgba(255, 65, 59, 0.5)',\n    'borderColor': 'rgba(255, 65, 59, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(255, 65, 59, 1)'\n}];\nvar options = {\n    scales: {\n        xAxes: [{ stacked: true }],\n        yAxes: [{ stacked: true }]\n    },\n    title: {\n        display: true,\n        position: 'top',\n        fontSize: 20,\n        text: 'Disponibilidade'\n    }\n}\nvar duration = 0;\n\nmsg = {\n    'type': type,\n    'labels': labels,\n    'datasets': datasets,\n    'options': options,\n    'duration': duration        \n    };\n        \nreturn msg;","outputs":1,"noerr":0,"x":660,"y":1860,"wires":[["3ac1f664.a482aa"]]},{"id":"3ac1f664.a482aa","type":"ui_template","z":"7e8bd831.628288","group":"7e36fb82.8439e4","name":"Disponibilidade","order":6,"width":"18","height":"9","format":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <title>My Stacked Bar Chart</title>\n</head>\n<body>\n    <canvas id=\"chart\"></canvas>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js\"></script>\n\n    <script>\n        (function(scope) {\n        var timer = setInterval(function() { //check that the Morris libs are loaded, if not wait\n            clearInterval(timer);\n            var ctx = document.getElementById('chart');\n                var barChart = new Chart(ctx, {\n                    type: 'bar',\n                    data: {\n                        labels: ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'],\n                        datasets: []\n                    },\n                    options: {\n                        scales: {\n                            xAxes: [{ stacked: true }],\n                            yAxes: [{ stacked: true }]\n                        },\n                        title: {\n                            display: true,\n                            position: 'top',\n                            fontSize: 20,\n                        }\n                    }\n                });\n\n            scope.$watch('msg', function (msg) { //watch for an incoming NR msg\n                if (msg) {\n\n                    var data = msg.datasets;\n                    var options = msg;\n                \n                function addData(chart, payload, config) {\n                    chart.options.title.text = config.options.title.text;\n                    chart.data.datasets = payload;\n                    chart.update({ duration: 0 });\n                }\n                addData(barChart,data,options);\n                };\n            }); //close out the watch \n        }, 100); // close out the setInterval \n        })(scope);\n    </script>\n</body>\n</html>\n","storeOutMessages":false,"fwdInMessages":true,"templateScope":"local","x":900,"y":1860,"wires":[[]]},{"id":"ad5a589d.884638","type":"function","z":"7e8bd831.628288","name":"format data for chart  ","func":"var index = 0;\nvar lista = [];\n\nfor(index in flow.get('ordematual').payload.dadosDeProducao){\n    lista.push(flow.get('ordematual').payload.dadosDeProducao.data)\n}\n\nif(lista.length <= 0){\n    msg.payload = \"\";\n    return msg;\n}\n\n\nvar data = flow.get('data');\nvar ordem = flow.get('ordematual').payload;\n\nvar performance = ordem.dadosDeProducao[data].performance;\nvar meta = [80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80];\nvar type = 'bar';\nvar labels = ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'];\nvar datasets = [{\n    'type': 'bar',\n    'label': 'Performance',\n    'data': performance,\n    'backgroundColor': 'rgba(59, 59, 255, 0.5)',\n    'borderColor': 'rgba(59, 59, 255, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(59, 59, 255, 1)'\n},\n{\n    'fill': false,\n    'type': 'line',\n    'label': 'Meta',\n    'data': meta,\n    'backgroundColor': 'rgba(255, 65, 59, 0.5)',\n    'borderColor': 'rgba(255, 65, 59, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(255, 65, 59, 1)'\n}];\nvar options = {\n    scales: {\n        xAxes: [{ stacked: true }],\n        yAxes: [{ stacked: true }]\n    },\n    title: {\n        display: true,\n        position: 'top',\n        fontSize: 20,\n        text: 'Performance'\n    }\n}\nvar duration = 0;\n\nmsg = {\n    'type': type,\n    'labels': labels,\n    'datasets': datasets,\n    'options': options,\n    'duration': duration        \n    };\n        \nreturn msg;","outputs":1,"noerr":0,"x":660,"y":1820,"wires":[["e30f7bb7.15bae8"]]},{"id":"e30f7bb7.15bae8","type":"ui_template","z":"7e8bd831.628288","group":"20e514ad.116bcc","name":"Performance","order":6,"width":"18","height":"9","format":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <title>My Stacked Bar Chart</title>\n</head>\n<body>\n    <canvas id=\"chart\"></canvas>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js\"></script>\n\n    <script>\n        (function(scope) {\n        var timer = setInterval(function() { //check that the Morris libs are loaded, if not wait\n            clearInterval(timer);\n            var ctx = document.getElementById('chart');\n                var barChart = new Chart(ctx, {\n                    type: 'bar',\n                    data: {\n                        labels: ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'],\n                        datasets: []\n                    },\n                    options: {\n                        scales: {\n                            xAxes: [{ stacked: true }],\n                            yAxes: [{ stacked: true }]\n                        },\n                        title: {\n                            display: true,\n                            position: 'top',\n                            fontSize: 20,\n                        }\n                    }\n                });\n\n            scope.$watch('msg', function (msg) { //watch for an incoming NR msg\n                if (msg) {\n\n                    var data = msg.datasets;\n                    var options = msg;\n                \n                function addData(chart, payload, config) {\n                    chart.options.title.text = config.options.title.text;\n                    chart.data.datasets = payload;\n                    chart.update({ duration: 0 });\n                }\n                addData(barChart,data,options);\n                };\n            }); //close out the watch \n        }, 100); // close out the setInterval \n        })(scope);\n    </script>\n</body>\n</html>\n","storeOutMessages":false,"fwdInMessages":true,"templateScope":"local","x":890,"y":1820,"wires":[[]]},{"id":"9ca789d5.667f08","type":"function","z":"7e8bd831.628288","name":"format data for chart  ","func":"var index = 0;\nvar lista = [];\n\nfor(index in flow.get('ordematual').payload.dadosDeProducao){\n    lista.push(flow.get('ordematual').payload.dadosDeProducao.data)\n}\n\nif(lista.length <= 0){\n    msg.payload = \"\";\n    return msg;\n}\n\nvar data = flow.get('data');\nvar ordem = flow.get('ordematual').payload;\n\nvar qualidade = ordem.dadosDeProducao[data].qualidade;\nvar meta = [80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80];\nvar type = 'bar';\nvar labels = ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'];\nvar datasets = [{\n    'type': 'bar',\n    'label': 'Qualidade',\n    'data': qualidade,\n    'backgroundColor': 'rgba(98, 255, 59, 0.5)',\n    'borderColor': 'rgba(98, 255, 59, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(98, 255, 59, 1)'\n},\n{\n    'fill': false,\n    'type': 'line',\n    'label': 'Meta',\n    'data': meta,\n    'backgroundColor': 'rgba(255, 65, 59, 0.5)',\n    'borderColor': 'rgba(255, 65, 59, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(255, 65, 59, 1)'\n}];\nvar options = {\n    scales: {\n        xAxes: [{ stacked: true }],\n        yAxes: [{ stacked: true }]\n    },\n    title: {\n        display: true,\n        position: 'top',\n        fontSize: 20,\n        text: 'Qualidade'\n    }\n}\nvar duration = 0;\n\nmsg = {\n    'type': type,\n    'labels': labels,\n    'datasets': datasets,\n    'options': options,\n    'duration': duration        \n    };\n        \nreturn msg;","outputs":1,"noerr":0,"x":660,"y":1900,"wires":[["b88e6e4f.61ff5"]]},{"id":"b88e6e4f.61ff5","type":"ui_template","z":"7e8bd831.628288","group":"7d65e4f9.12b05c","name":"Qualidade","order":6,"width":"18","height":"9","format":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <title>My Stacked Bar Chart</title>\n</head>\n<body>\n    <canvas id=\"chart\"></canvas>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js\"></script>\n\n    <script>\n        (function(scope) {\n        var timer = setInterval(function() { //check that the Morris libs are loaded, if not wait\n            clearInterval(timer);\n            var ctx = document.getElementById('chart');\n                var barChart = new Chart(ctx, {\n                    type: 'bar',\n                    data: {\n                        labels: ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'],\n                        datasets: []\n                    },\n                    options: {\n                        scales: {\n                            xAxes: [{ stacked: true }],\n                            yAxes: [{ stacked: true }]\n                        },\n                        title: {\n                            display: true,\n                            position: 'top',\n                            fontSize: 20,\n                        }\n                    }\n                });\n\n            scope.$watch('msg', function (msg) { //watch for an incoming NR msg\n                if (msg) {\n\n                    var data = msg.datasets;\n                    var options = msg;\n                \n                function addData(chart, payload, config) {\n                    chart.options.title.text = config.options.title.text;\n                    chart.data.datasets = payload;\n                    chart.update({ duration: 0 });\n                }\n                addData(barChart,data,options);\n                };\n            }); //close out the watch \n        }, 100); // close out the setInterval \n        })(scope);\n    </script>\n</body>\n</html>\n","storeOutMessages":false,"fwdInMessages":true,"templateScope":"local","x":890,"y":1900,"wires":[[]]},{"id":"95ee765d.f36828","type":"function","z":"7e8bd831.628288","name":"format data for chart  ","func":"var index = 0;\nvar lista = [];\n\nfor(index in flow.get('ordematual').payload.dadosDeProducao){\n    lista.push(flow.get('ordematual').payload.dadosDeProducao.data)\n}\n\nif(lista.length <= 0){\n    msg.payload = \"\";\n    return msg;\n}\n\nvar data = flow.get('data');\nvar ordem = flow.get('ordematual').payload;\n\nvar oee = ordem.dadosDeProducao[data].oee;\nvar meta = [80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80,80];\nvar type = 'bar';\nvar labels = ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'];\nvar datasets = [{\n    'type': 'bar',\n    'label': 'OEE',\n    'data': oee,\n    'backgroundColor': 'rgba(255, 186, 59, 0.5)',\n    'borderColor': 'rgba(255, 186, 59, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(255, 186, 59, 1)'\n},\n{\n    'fill': false,\n    'type': 'line',\n    'label': 'Meta',\n    'data': meta,\n    'backgroundColor': 'rgba(255, 65, 59, 0.5)',\n    'borderColor': 'rgba(255, 65, 59, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(255, 65, 59, 1)'\n}];\nvar options = {\n    scales: {\n        xAxes: [{ stacked: true }],\n        yAxes: [{ stacked: true }]\n    },\n    title: {\n        display: true,\n        position: 'top',\n        fontSize: 20,\n        text: 'OEE'\n    }\n}\nvar duration = 0;\n\nmsg = {\n    'type': type,\n    'labels': labels,\n    'datasets': datasets,\n    'options': options,\n    'duration': duration        \n    };\n        \nreturn msg;","outputs":1,"noerr":0,"x":660,"y":1940,"wires":[["9d22c84e.dfbb58"]]},{"id":"9d22c84e.dfbb58","type":"ui_template","z":"7e8bd831.628288","group":"955a3b7a.3b7f88","name":"OEE","order":6,"width":"18","height":"9","format":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <title>My Stacked Bar Chart</title>\n</head>\n<body>\n    <canvas id=\"chart\"></canvas>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js\"></script>\n\n    <script>\n        (function(scope) {\n        var timer = setInterval(function() { //check that the Morris libs are loaded, if not wait\n            clearInterval(timer);\n            var ctx = document.getElementById('chart');\n                var barChart = new Chart(ctx, {\n                    type: 'bar',\n                    data: {\n                        labels: ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'],\n                        datasets: []\n                    },\n                    options: {\n                        scales: {\n                            xAxes: [{ stacked: true }],\n                            yAxes: [{ stacked: true }]\n                        },\n                        title: {\n                            display: true,\n                            position: 'top',\n                            fontSize: 20,\n                        }\n                    }\n                });\n\n            scope.$watch('msg', function (msg) { //watch for an incoming NR msg\n                if (msg) {\n\n                    var data = msg.datasets;\n                    var options = msg;\n                \n                function addData(chart, payload, config) {\n                    chart.options.title.text = config.options.title.text;\n                    chart.data.datasets = payload;\n                    chart.update({ duration: 0 });\n                }\n                addData(barChart,data,options);\n                };\n            }); //close out the watch \n        }, 100); // close out the setInterval \n        })(scope);\n    </script>\n</body>\n</html>\n","storeOutMessages":false,"fwdInMessages":true,"templateScope":"local","x":870,"y":1940,"wires":[[]]},{"id":"ff1fa89b.a04b88","type":"ui_button","z":"7e8bd831.628288","name":"","group":"3915cecb.4b6d32","order":10,"width":"4","height":"1","passthru":false,"label":"Perdas","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"hide\":[\"Ordem_Produção\",\"Ordem_Disponibilidade\",\"Ordem_Performance\",\"Ordem_Qualidade\",\"Ordem_OEE\",\"Ordem_OEE_Acc\",\"Ordem_Pareto\"],\"show\":[\"Ordem_Perdas\",\"Ordem_Data\"]}}","payloadType":"json","topic":"","x":580,"y":1500,"wires":[["70c8d6d0.f9d578"]]},{"id":"c629c348.62fbb","type":"function","z":"7e8bd831.628288","name":"format data for chart  ","func":"var index = 0;\nvar lista = [];\n\nfor(index in flow.get('ordematual').payload.dadosDeProducao){\n    lista.push(flow.get('ordematual').payload.dadosDeProducao.data)\n}\n\nif(lista.length <= 0){\n    msg.payload = \"\";\n    return msg;\n}\n\nvar data = flow.get('data');\nvar ordem = flow.get('ordematual').payload;\n\nvar goodProduction = ordem.dadosDeProducao[data].goodProduction;\nvar badProduction = ordem.dadosDeProducao[data].badProduction;\n\nvar type = 'bar';\nvar labels = ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'];\nvar datasets = [{\n    'type': 'bar',\n    'label': 'Peças boas',\n    'data': goodProduction,\n    'backgroundColor': 'rgba(60, 130, 0, 0.5)',\n    'borderColor': 'rgba(60, 130, 0, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(60, 130, 0, 1)'\n},\n{\n    'type': 'bar',\n    'label': 'Peças ruins',\n    'data': badProduction,\n    'backgroundColor': 'rgba(255, 65, 59, 0.5)',\n    'borderColor': 'rgba(255, 65, 59, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(255, 65, 59, 1)'\n}];\nvar options = {\n        scales: {\n            xAxes: [{ stacked: true }],\n            yAxes: [{ stacked: true }]\n        },\n        title: {\n            display: true,\n            position: 'top',\n            fontSize: 20,\n            text: 'Produção'\n        }\n}\nvar duration = 0;\n\nmsg = {\n    'type': type,\n    'labels': labels,\n    'datasets': datasets,\n    'options': options,\n    'duration': duration        \n    };\n\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":1780,"wires":[["e281ba4a.1956d8"]]},{"id":"e281ba4a.1956d8","type":"ui_template","z":"7e8bd831.628288","group":"37736700.5f0f4a","name":"Produção","order":1,"width":"18","height":"9","format":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <title>My Stacked Bar Chart</title>\n</head>\n<body>\n    <canvas id=\"chart\"></canvas>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js\"></script>\n\n    <script>\n        (function(scope) {\n        var timer = setInterval(function() { //check that the Morris libs are loaded, if not wait\n            clearInterval(timer);\n            var ctx = document.getElementById('chart');\n                var barChart = new Chart(ctx, {\n                    type: 'bar',\n                    data: {\n                        labels: ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'],\n                        datasets: []\n                    },\n                    options: {\n                        scales: {\n                            xAxes: [{ stacked: true }],\n                            yAxes: [{ stacked: true }]\n                        },\n                        title: {\n                            display: true,\n                            position: 'top',\n                            fontSize: 20,\n                        }\n                    }\n                });\n\n            scope.$watch('msg', function (msg) { //watch for an incoming NR msg\n                if (msg) {\n\n                    var data = msg.datasets;\n                    var options = msg;\n                \n                function addData(chart, payload, config) {\n                    chart.options.title.text = config.options.title.text;\n                    chart.data.datasets = payload;\n                    chart.update({ duration: 0 });\n                }\n                addData(barChart,data,options);\n                };\n            }); //close out the watch \n        }, 100); // close out the setInterval \n        })(scope);\n    </script>\n</body>\n</html>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":880,"y":1780,"wires":[[]],"info":"<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"utf-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\r\n    <title>My Stacked Bar Chart</title>\r\n</head>\r\n<body>\r\n    <canvas id=\"chart\"></canvas>\r\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js\"></script>\r\n\r\n    <script>\r\n        (function(scope) {\r\n        var timer = setInterval(function() { //check that the Morris libs are loaded, if not wait\r\n            clearInterval(timer);\r\n            var ctx = document.getElementById('chart');\r\n                    var myChart = new Chart(ctx, {\r\n                        type: 'bar',\r\n                        data: {\r\n                            labels: [],\r\n                            datasets: [{\r\n                                data: []\r\n                            }]\r\n                        },\r\n                        options: {}\r\n                    });\r\n\r\n            scope.$watch('msg', function (msg) { //watch for an incoming NR msg\r\n                if (msg) {\r\n                    var data = msg;\r\n\r\n                    function addData(chart, data) {\r\n                        chart.type = data.type;\r\n                        chart.data.labels = data.labels;\r\n                        chart.data.datasets = [{\r\n                            type: data.datasets[0].type,\r\n                            label: data.datasets[0].label,\r\n                            data: data.datasets[0].data,\r\n                            backgroundColor: data.datasets[0].backgroundColor,\r\n                            borderColor: data.datasets[0].borderColor,\r\n                            borderWidth: data.datasets[0].borderWidth,\r\n                            hoverBackgroundColor: data.datasets[0].hoverBackgroundColor\r\n                        },\r\n                        {\r\n                            type: data.datasets[1].type,\r\n                            label: data.datasets[1].label,\r\n                            data: data.datasets[1].data,\r\n                            backgroundColor: data.datasets[1].backgroundColor,\r\n                            borderColor: data.datasets[1].borderColor,\r\n                            borderWidth: data.datasets[1].borderWidth,\r\n                            hoverBackgroundColor: data.datasets[1].hoverBackgroundColor\r\n                        }];    \r\n                        }\r\n                        chart.options = data.options;\r\n                        chart.update({ duration: data.duration });\r\n                    }\r\n                    addData(myChart,data);\r\n                    msg.payload = myChart;\r\n                    return msg;\r\n                };\r\n            }); //close out the watch \r\n        }, 100); // close out the setInterval \r\n        })(scope);\r\n    </script>\r\n</body>\r\n</html>\r\n"},{"id":"61bf3d07.744194","type":"ui_button","z":"7e8bd831.628288","name":"","group":"3915cecb.4b6d32","order":9,"width":"4","height":"1","passthru":false,"label":"OEE","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"hide\":[\"Ordem_Produção\",\"Ordem_Disponibilidade\",\"Ordem_Performance\",\"Ordem_Qualidade\",\"Ordem_Perdas\",\"Ordem_OEE\",\"Ordem_Pareto\"],\"show\":[\"Ordem_OEE_Acc\",\"Ordem_Data\"]}}","payloadType":"json","topic":"","x":570,"y":1540,"wires":[["70c8d6d0.f9d578"]]},{"id":"2252bf43.b6a05","type":"function","z":"7e8bd831.628288","name":"format data for chart  ","func":"var index = 0;\nvar lista = [];\n\nfor(index in flow.get('ordematual').payload.dadosDeProducao){\n    lista.push(flow.get('ordematual').payload.dadosDeProducao.data)\n}\n\nif(lista.length <= 0){\n    msg.payload = \"\";\n    return msg;\n}\n\nvar data = flow.get('data');\nvar ordem = flow.get('ordematual').payload || [];\n\nvar timeNaoApontada = ordem.dadosDeProducao[data].timeNaoApontada;\nvar timeScheduledStop = ordem.dadosDeProducao[data].timeScheduledStop;\nvar timeUnscheduledStop = ordem.dadosDeProducao[data].timeUnscheduledStop;\nvar timeSetup = ordem.dadosDeProducao[data].timeSetup;\nvar timeManutProd = ordem.dadosDeProducao[data].timeManutProd;\nvar timeRefeicao = ordem.dadosDeProducao[data].timeRefeicao;\nvar timeManutPlan = ordem.dadosDeProducao[data].timeManutPlan;\n\nvar totaltimeNaoApontada = timeNaoApontada.reduce(function(anterior, atual) {\n    return anterior + atual;\n});\n\nvar totaltimeScheduledStop = timeScheduledStop.reduce(function(anterior, atual) {\n    return anterior + atual;\n});\n\nvar totaltimeUnscheduledStop = timeUnscheduledStop.reduce(function(anterior, atual) {\n    return anterior + atual;\n});\n\nvar totaltimeSetup = timeSetup.reduce(function(anterior, atual) {\n    return anterior + atual;\n});\n\nvar totaltimeManutProd = timeManutProd.reduce(function(anterior, atual) {\n    return anterior + atual;\n});\n\nvar totaltimeRefeicao = timeRefeicao.reduce(function(anterior, atual) {\n    return anterior + atual;\n});\n\nvar totaltimeManutPlan = timeManutPlan.reduce(function(anterior, atual) {\n    return anterior + atual;\n});\n\nvar doughnut1 = [totaltimeNaoApontada+totaltimeUnscheduledStop,totaltimeScheduledStop,0,0,0,0,0];\nvar doughnut2 = [0,0,totaltimeNaoApontada,totaltimeSetup,totaltimeManutProd,totaltimeRefeicao,totaltimeManutPlan];\n\nvar type = 'doughnut';\nvar labels = ['Parada não planejada','Parada planejada','Parada não apontada','Setup','Ajuste / Regulagem','Refeição','Manutenção Planejada'];\nvar datasets = [{\n    'type': 'doughnut',\n    'label': 'Paradas',\n    'data': doughnut1,\n    'backgroundColor': ['rgba(255, 59, 59, 0.5)','rgba(0, 163, 50, 0.5)','rgba(255, 167, 66, 0.5)','rgba(125, 54, 0, 0.5)','rgba(255, 204, 0, 0.5)','rgba(38, 42, 255, 0.5)','rgba(179, 255, 0, 0.5)'],\n    'borderColor': ['rgba(255, 59, 59, 1)','rgba(0, 163, 50, 1)','rgba(255, 167, 66, 1)','rgba(125, 54, 0, 1)','rgba(255, 204, 0, 1)','rgba(38, 42, 255, 1)','rgba(179, 255, 0, 1)'],\n    'borderWidth': 1,\n    'hoverBackgroundColor': ['rgba(255, 59, 59, 1)','rgba(0, 163, 50, 1)','rgba(255, 167, 66, 1)','rgba(125, 54, 0, 1)','rgba(255, 204, 0, 1)','rgba(38, 42, 255, 1)','rgba(179, 255, 0, 1)']\n},{\n    'type': 'doughnut',\n    'label': 'Paradas',\n    'data': doughnut2,\n    'backgroundColor': ['rgba(255, 59, 59, 0.5)','rgba(0, 163, 50, 0.5)','rgba(255, 167, 66, 0.5)','rgba(125, 54, 0, 0.5)','rgba(255, 204, 0, 0.5)','rgba(38, 42, 255, 0.5)','rgba(179, 255, 0, 0.5)'],\n    'borderColor': ['rgba(255, 59, 59, 1)','rgba(0, 163, 50, 1)','rgba(255, 167, 66, 1)','rgba(125, 54, 0, 1)','rgba(255, 204, 0, 1)','rgba(38, 42, 255, 1)','rgba(179, 255, 0, 1)'],\n    'borderWidth': 1,\n    'hoverBackgroundColor': ['rgba(255, 59, 59, 1)','rgba(0, 163, 50, 1)','rgba(255, 167, 66, 1)','rgba(125, 54, 0, 1)','rgba(255, 204, 0, 1)','rgba(38, 42, 255, 1)','rgba(179, 255, 0, 1)']\n}\n];\nvar options = {\n    scales: {\n        xAxes: [{ stacked: true }],\n        yAxes: [{ stacked: true }]\n    },\n    title: {\n        display: true,\n        position: 'top',\n        fontSize: 20,\n        text: 'Perdas'\n    }\n}\nvar duration = 0;\n\nmsg = {\n    'type': type,\n    'labels': labels,\n    'datasets': datasets,\n    'options': options,\n    'duration': duration        \n    };\n        \nreturn msg;","outputs":1,"noerr":0,"x":660,"y":1980,"wires":[["c2da8e63.d3fce"]]},{"id":"c2da8e63.d3fce","type":"ui_template","z":"7e8bd831.628288","group":"b7adbefb.bd68e","name":"Perdas","order":6,"width":"18","height":"9","format":"    <!DOCTYPE html>\n    <html lang=\"en\">\n    <head>\n        <meta charset=\"utf-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n        <title>My Stacked Bar Chart</title>\n    </head>\n    <body>\n        <canvas id=\"chart\"></canvas>\n        <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js\"></script>\n\n        <script>\n            (function(scope) {\n            var timer = setInterval(function() { //check that the Morris libs are loaded, if not wait\n                clearInterval(timer);\n                var ctx = document.getElementById('chart');\n                    var barChart = new Chart(ctx, {\n                        type: 'doughnut',\n                        data: {\n                            labels: ['Parada não planejada','Parada planejada','Parada não apontada','Setup','Ajuste / Regulagem','Refeição','Manutenção Planejada'],\n                            datasets: []\n                        },\n                        options: {\n                            scales: {},\n                            title: {\n                                display: true,\n                                position: 'top',\n                                fontSize: 20,\n                            }\n                        }\n                    });\n\n                scope.$watch('msg', function (msg) { //watch for an incoming NR msg\n                    if (msg) {\n\n                        var data = msg.datasets;\n                        var options = msg;\n                    \n                    function addData(chart, payload, config) {\n                        chart.options.title.text = config.options.title.text;\n                        chart.data.datasets = payload;\n                        chart.update({ duration: 0 });\n                    }\n                    addData(barChart,data,options);\n                    };\n                }); //close out the watch \n            }, 100); // close out the setInterval \n            })(scope);\n        </script>\n    </body>\n    </html>\n","storeOutMessages":false,"fwdInMessages":true,"templateScope":"local","x":880,"y":1980,"wires":[[]]},{"id":"cd101816.605ff8","type":"inject","z":"fa212271.2d00f","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":2160,"wires":[["ffd274ab.2b5378"]]},{"id":"ffd274ab.2b5378","type":"function","z":"fa212271.2d00f","name":"Ordem atual","func":"var process_id = global.get('process_id');\nif(process_id === 0){\n    msg1 = {\n        'payload': 'ok'\n    }\n    msg.enabled = false;\n    return [msg,msg1];\n}\nmsg.enabled = true;\nreturn [msg,null];","outputs":2,"noerr":0,"x":330,"y":2160,"wires":[["13fe9bc5.a38114","ff21d015.30dcc","467addd.c8d7b24","d6c37044.21af6","4791c2cb.29ca4c","1491702a.98895","7df11f79.045e5"],["e02593fb.f536c"]]},{"id":"e02593fb.f536c","type":"change","z":"fa212271.2d00f","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"group\":{\"hide\":[\"Produção_Produção\",\"Produção_Disponibilidade\",\"Produção_Performance\",\"Produção_Qualidade\",\"Produção_Perdas\",\"Produção_OEE_Acc\"],\"show\":[\"Produção_OEE\"]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":2440,"wires":[["cd3e6a69.02e528"]]},{"id":"24d878be.9e84f8","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"group\":{\"hide\":[\"Ordem_OEE\",\"Ordem_Disponibilidade\",\"Ordem_Performance\",\"Ordem_Qualidade\",\"Ordem_Perdas\",\"Ordem_OEE_Acc\",\"Ordem_Produção\",\"Ordem_Datas\"],\"show\":[]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":1300,"wires":[["70c8d6d0.f9d578"]]},{"id":"e12d3af3.835b38","type":"delay","z":"93413fb0.966e1","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":980,"y":620,"wires":[["7eef52ff.a8f36c"]]},{"id":"ff60269c.853a58","type":"delay","z":"b5ab8ba.7eb7578","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":580,"y":260,"wires":[["7764f8a7.461158"]]},{"id":"7764f8a7.461158","type":"change","z":"b5ab8ba.7eb7578","name":"Reset reason_code","rules":[{"t":"set","p":"reason_code","pt":"global","to":"null","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":260,"wires":[[]]},{"id":"c89c5d22.a7511","type":"moment","z":"49ecca28.ef9cc4","name":"ID","topic":"","input":"","inputType":"date","inTz":"America/Sao_Paulo","adjAmount":0,"adjType":"days","adjDir":"add","format":"DDMMYYYYHHmmss","locale":"pt_BR","output":"_id","outputType":"msg","outTz":"America/Sao_Paulo","x":330,"y":300,"wires":[["6a74e635.460d18"]]},{"id":"773e9fe6.c429c","type":"change","z":"b5ab8ba.7eb7578","name":"Limpa payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":100,"wires":[["a851c077.1f03c","19d9e336.65f3ad"]]},{"id":"a851c077.1f03c","type":"cloudant in","z":"b5ab8ba.7eb7578","name":"Consulta SKU","cloudant":"90d07383.5a36","database":"listadesku","service":"_ext_","search":"_all_","design":"","index":"","x":570,"y":100,"wires":[["edfbeff8.1d38b"]]},{"id":"5738c4c7.ebdf6c","type":"cloudant in","z":"b5ab8ba.7eb7578","name":"Consulta ordens","cloudant":"90d07383.5a36","database":"listadeordem","service":"_ext_","search":"_all_","design":"","index":"","x":760,"y":180,"wires":[["755bd4a6.c10ccc"]]},{"id":"edfbeff8.1d38b","type":"function","z":"b5ab8ba.7eb7578","name":"Monta lista de SKU","func":"var lista = msg.payload\nvar index = msg.payload.length\nmsg.id = []\nfor (index in lista){\n    msg.id.push(lista[index]._id)\n}\nmsg.sku = []\nfor (index in lista){\n    msg.sku.push(lista[index].payload.sku)\n}\nmsg.skuativos = []\nfor (index in lista){\n    if(lista[index].payload.estado === true){\n        msg.skuativos.push(lista[index].payload.sku)\n    }\n}\nmsg.idativos = []\nfor (index in lista){\n    if(lista[index].payload.estado === true){\n        msg.idativos.push(lista[index]._id)\n    }\n}\nvar msg1 = {\n    \"options\": msg.skuativos\n};\nmsg.options = msg.sku;\nglobal.set(\"listaId\",msg.id)\nglobal.set(\"listaSku\",msg.sku)\nglobal.set(\"listaIdAtivos\",msg.idativos)\nglobal.set(\"listaSkuAtivos\",msg.skuativos)\nreturn [msg,msg1];\n","outputs":2,"noerr":0,"x":790,"y":100,"wires":[["b5aab5b3.5a63e8"],["d18ddaf6.46dbb8"]]},{"id":"755bd4a6.c10ccc","type":"function","z":"b5ab8ba.7eb7578","name":"Monta lista de Ordens","func":"var lista = msg.payload\nvar index = msg.payload.length\nvar listaOrdens = [];\nvar listaOrdensAtivas = [];\nfor (index in lista){\n    listaOrdens.push(lista[index].payload.ordemInformacoes.ordem)\n}\nfor (index in lista){\n    if(lista[index].payload.ordemInformacoes.statusDeOrdem !== \"Encerrada\"){\n        listaOrdensAtivas.push(lista[index].payload.ordemInformacoes.ordem)\n    }\n}\n\nmsg.options = global.get(\"listaOrdens\");\nvar msg1 = {\n    \"options\": listaOrdensAtivas\n}\n\nglobal.set(\"listaOrdensAtivas\", listaOrdensAtivas);\nglobal.set(\"listaOrdens\",listaOrdens);\nreturn [msg,msg1];","outputs":2,"noerr":0,"x":1000,"y":180,"wires":[["38a10355.b3037c"],["a8f522b4.5ea2f"]]},{"id":"125ab19a.807c3e","type":"inject","z":"7e8bd831.628288","name":"Inicialização","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"0.1","x":210,"y":80,"wires":[["4bc2a066.41d2a"]]},{"id":"4bc2a066.41d2a","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"ordematual","pt":"flow","to":"null","tot":"json"},{"t":"set","p":"data","pt":"flow","to":"null","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":80,"wires":[[]]},{"id":"b5aab5b3.5a63e8","type":"link out","z":"b5ab8ba.7eb7578","name":"listaSKU","links":["7ac2100b.dba3f","7b525622.a8f5e8"],"x":955,"y":80,"wires":[]},{"id":"a8f522b4.5ea2f","type":"link out","z":"b5ab8ba.7eb7578","name":"listaOrdem","links":["ca73faf6.381a88"],"x":1175,"y":200,"wires":[]},{"id":"38a10355.b3037c","type":"link out","z":"b5ab8ba.7eb7578","name":"listaOrdemAtiva","links":["92fadd66.5f0f6"],"x":1175,"y":160,"wires":[]},{"id":"d18ddaf6.46dbb8","type":"link out","z":"b5ab8ba.7eb7578","name":"listaSKUAtivos","links":["96644b4d.413588"],"x":955,"y":120,"wires":[]},{"id":"19d9e336.65f3ad","type":"delay","z":"b5ab8ba.7eb7578","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":560,"y":180,"wires":[["5738c4c7.ebdf6c"]]},{"id":"e781b5f1.08e028","type":"function","z":"49ecca28.ef9cc4","name":"Escreve lista","func":"var lista = global.get(\"listaSkuAtivos\") || [];\nvar listaatual = flow.get('listaSkuAtualAtivos') || [];\nif (lista.length != listaatual.length){\n    flow.set('listaSkuAtualAtivos',lista);\n    return msg;\n}","outputs":1,"noerr":0,"x":950,"y":140,"wires":[["cdfa33fd.57339"]]},{"id":"cdfa33fd.57339","type":"link out","z":"49ecca28.ef9cc4","name":"optionsDropbox","links":["96644b4d.413588"],"x":1095,"y":140,"wires":[]},{"id":"86a09992.7747b8","type":"function","z":"7e8bd831.628288","name":"Escreve lista","func":"var lista = global.get(\"listaOrdens\") || [];\nvar listaatual = flow.get('listaOrdens') || [];\nif (lista.length != listaatual.length){\n    flow.set('listaOrdens',lista)\n    return msg\n}","outputs":1,"noerr":0,"x":1030,"y":200,"wires":[["73263f8d.b4b79"]]},{"id":"8dfdb7d1.254ee8","type":"comment","z":"7e8bd831.628288","name":"Remonta lista de ordens","info":"Inicialização e refresh","x":230,"y":140,"wires":[]},{"id":"38483c66.f1e714","type":"link in","z":"7e8bd831.628288","name":"refreshOrdem","links":["6328c35b.0fc7ec","dc6836f5.498de8","df3970f4.19add","c8c4456e.3c58a8","d48a68e0.042fd8"],"x":135,"y":220,"wires":[["2bd948c2.4303b8"]]},{"id":"73263f8d.b4b79","type":"link out","z":"7e8bd831.628288","name":"refreshTriggerOrdem","links":["92fadd66.5f0f6"],"x":1175,"y":200,"wires":[]},{"id":"2bd948c2.4303b8","type":"change","z":"7e8bd831.628288","name":"Limpa payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":220,"wires":[["5d47fc0c.140664"]]},{"id":"5d47fc0c.140664","type":"cloudant in","z":"7e8bd831.628288","name":"Consulta ordens","cloudant":"90d07383.5a36","database":"listadeordem","service":"_ext_","search":"_all_","design":"","index":"","x":540,"y":220,"wires":[["e7f4dd22.ecb08"]]},{"id":"e7f4dd22.ecb08","type":"function","z":"7e8bd831.628288","name":"Monta lista de Ordens","func":"var lista = msg.payload\nvar index = msg.payload.length\nvar listaOrdens = [];\nvar listaOrdensAtivas = [];\nfor (index in lista){\n    listaOrdens.push(lista[index].payload.ordemInformacoes.ordem)\n}\nfor (index in lista){\n    if(lista[index].payload.ordemInformacoes.statusDeOrdem !== \"Encerrada\"){\n        listaOrdensAtivas.push(lista[index].payload.ordemInformacoes.ordem)\n    }\n}\n\nmsg.options = global.get(\"listaOrdens\");\nvar msg1 = {\n    \"options\": listaOrdensAtivas\n}\n\nglobal.set(\"listaOrdensAtivas\", listaOrdensAtivas);\nglobal.set(\"listaOrdens\",listaOrdens);\nreturn [msg,msg1];","outputs":2,"noerr":0,"x":800,"y":220,"wires":[["73263f8d.b4b79"],["f4796586.3bd7d8"]]},{"id":"42588015.af41c","type":"function","z":"7e8bd831.628288","name":"Escreve lista","func":"var lista = global.get(\"listaOrdensAtivas\") || [];\nvar listaatual = flow.get('listaOrdensAtivas') || [];\nif (lista.length != listaatual.length || msg.topic === 999){\n    flow.set('listaOrdensAtivas',lista)\n    return msg\n}","outputs":1,"noerr":0,"x":1030,"y":240,"wires":[["f4796586.3bd7d8"]]},{"id":"f4796586.3bd7d8","type":"link out","z":"7e8bd831.628288","name":"refreshTriggerOrdem","links":["ca73faf6.381a88"],"x":1175,"y":240,"wires":[]},{"id":"8190caec.f4e198","type":"ui_button","z":"93413fb0.966e1","name":"","group":"361751bb.55a20e","order":3,"width":"4","height":"1","passthru":false,"label":"Linha 1","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":120,"y":100,"wires":[["c8c4456e.3c58a8"]]},{"id":"e795fa58.9a85f8","type":"moment","z":"93413fb0.966e1","name":"Data","topic":"","input":"","inputType":"date","inTz":"America/Sao_Paulo","adjAmount":"3","adjType":"hours","adjDir":"subtract","format":"YYYYMMDD","locale":"en_US","output":"data","outputType":"msg","outTz":"Etc/UTC","x":670,"y":340,"wires":[["aed27b17.cf3898"]]},{"id":"aed27b17.cf3898","type":"function","z":"93413fb0.966e1","name":"Process_id","func":"var ordem = global.get(\"ordematual\");\nvar data = msg.data;\ndata = parseInt(data);\nif(ordem.dadosDeProducao[data] !== null){\n    return;\n}\nordem.dadosDeProducao[data] =\n{\n    \"data\": data,\n    \"goodProduction\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n    \"badProduction\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n    \"totalProduction\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n    \"metaProducao\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n    \"timeNaoApontada\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n    \"timeScheduledStop\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n    \"timeUnscheduledStop\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n    \"timeSetup\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n    \"timeManutProd\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n    \"timeRefeicao\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n    \"timeManutPlan\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n    \"timeStopMachine\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n    \"timeTotal\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n    \"timeCarga\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n    \"timeProduzido\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n    \"qualidade\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n    \"performance\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n    \"disponibilidade\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n    \"oee\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]\n}\nglobal.set(\"ordematual\",ordem);\nmsg.payload = ordem.dadosDeProducao;\nreturn msg;","outputs":1,"noerr":0,"x":850,"y":340,"wires":[[]]},{"id":"ca646806.34e8f8","type":"change","z":"93413fb0.966e1","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"true","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":180,"wires":[["324061be.38949e"]]},{"id":"759b29d.b24a9d8","type":"change","z":"93413fb0.966e1","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"false","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":220,"wires":[["324061be.38949e"]]},{"id":"5dde2766.f56eb8","type":"delay","z":"93413fb0.966e1","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":740,"y":700,"wires":[["e12edcbb.e271"]]},{"id":"24811cd5.2ebcd4","type":"inject","z":"fa212271.2d00f","name":"exec","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":140,"wires":[["316eaa94.02fb36"]]},{"id":"316eaa94.02fb36","type":"moment","z":"fa212271.2d00f","name":"data","topic":"","input":"","inputType":"date","inTz":"America/Sao_Paulo","adjAmount":"3","adjType":"hours","adjDir":"subtract","format":"YYYYMMDD","locale":"en_US","output":"data","outputType":"global","outTz":"Etc/UTC","x":270,"y":140,"wires":[["d38946b2.f16678"]]},{"id":"d38946b2.f16678","type":"function","z":"fa212271.2d00f","name":"set global context","func":"var data = global.get(\"data\");\ndata = parseInt(data);\nvar process_id = global.get(\"process_id\") || 0;\nif(process_id !== 0){\n    var ordem = global.get(\"ordematual\");\n    lista = [];\n    var index = 0;\n    for(index in ordem.dadosDeProducao){\n        lista.push(parseInt(ordem.dadosDeProducao[index].data));\n    }\n    if(lista.indexOf(data) === -1){\n        var newData = [];\n        newData = {\n            \"data\": data,\n            \"goodProduction\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n            \"badProduction\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n            \"totalProduction\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n            \"metaProducao\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n            \"timeNaoApontada\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n            \"timeScheduledStop\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n            \"timeUnscheduledStop\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n            \"timeSetup\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n            \"timeManutProd\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n            \"timeRefeicao\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n            \"timeManutPlan\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n            \"timeStopMachine\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n            \"timeTotal\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n            \"timeCarga\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n            \"timeProduzido\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n            \"qualidade\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n            \"performance\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n            \"disponibilidade\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\n            \"oee\": [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]\n        }\n        msg.payload = 'passei';\n        ordem.dadosDeProducao[data] = newData;\n        global.set('ordematual',ordem);    \n        return msg;\n    }\n        \n}","outputs":1,"noerr":0,"x":470,"y":140,"wires":[[]]},{"id":"f5d7dcfa.ac4e4","type":"inject","z":"7e8bd831.628288","name":"","topic":"","payload":"","payloadType":"date","repeat":"0.1","crontab":"","once":false,"onceDelay":0.1,"x":650,"y":80,"wires":[["f8615b9.7fe0da8"]]},{"id":"f8615b9.7fe0da8","type":"function","z":"7e8bd831.628288","name":"reason_code","func":"var process_id = global.get('process_id');\nif(process_id === 0){\n    global.set('reason_code',null);\n}","outputs":1,"noerr":0,"x":860,"y":80,"wires":[[]]},{"id":"c8c4456e.3c58a8","type":"link out","z":"93413fb0.966e1","name":"refresh","links":["38483c66.f1e714"],"x":255,"y":100,"wires":[]},{"id":"2220bd8c.bdc722","type":"ui_button","z":"7e8bd831.628288","name":"","group":"7a012799.9bd2c8","order":1,"width":"2","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"skip_previous","payload":"prev","payloadType":"str","topic":"","x":790,"y":1680,"wires":[["ddcab84a.9fcd98"]]},{"id":"b346c637.2a8c78","type":"ui_button","z":"7e8bd831.628288","name":"","group":"7a012799.9bd2c8","order":5,"width":"2","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"skip_next","payload":"next","payloadType":"str","topic":"","x":790,"y":1720,"wires":[["ddcab84a.9fcd98"]]},{"id":"d02c2dc7.43b8b","type":"ui_text","z":"7e8bd831.628288","group":"7a012799.9bd2c8","order":3,"width":"2","height":"1","name":"","label":"Data:","format":"{{msg.payload}}","layout":"col-center","x":790,"y":1640,"wires":[]},{"id":"ddcab84a.9fcd98","type":"function","z":"7e8bd831.628288","name":"Dados","func":"var index = flow.get('index');\nvar dados = flow.get('dados');\nvar data = flow.get('data');\n\nif(index === null){\n    flow.set('index',0);\n}\nif(msg.payload === 'next'){\n    if(index > dados.length-1){\n        return;\n    }\n    index = index + 1;\n    flow.set('index',index);\n}\nif(msg.payload === 'prev'){\n    if(index < 0){\n        return;\n    }\n    index = index - 1;\n    flow.set('index',index);\n}\n\nmsg.payload = data;\nreturn msg;","outputs":1,"noerr":0,"x":970,"y":1700,"wires":[[]]},{"id":"ad070868.c86d88","type":"function","z":"7e8bd831.628288","name":"Ordem","func":"var index = 0;\nvar lista = [];\n\nfor(index in flow.get('ordematual').payload.dadosDeProducao){\n    lista.push(flow.get('ordematual').payload.dadosDeProducao.data)\n}\n\nif(lista.length <= 0){\n    return;\n}\n\nvar index = flow.get('index');\nvar ordem = flow.get('ordematual').payload;\n\nvar dados = ordem.dadosDeProducao;\nvar i = 0;\nvar lista = [];\nfor (i in dados){\n    lista.push(dados[i].data)\n}\n\nflow.set('data',lista[index]);\nflow.set('dados', lista);\nflow.set('comp', lista.length);\n\nvar msg1 = {};\nif(flow.get('ordematual') === null){\n    msg.enabled = false;\n    msg1.enabled = false;\n    flow.set('index',0);\n    return [msg,msg1];\n}\nif(lista.length === 1){\n    msg.enabled = false;\n    msg1.enabled = false;\n    flow.set('index',0);\n    return [msg,msg1];\n}\nif(index > 0 && index < lista.length-1){\n    msg.enabled = true;\n    msg1.enabled = true;\n    return [msg,msg1];\n}\nif(index === 0 && index <= lista.length-1){\n    msg.enabled = false;\n    msg1.enabled = true;\n    return [msg,msg1];\n}\nif(index >= 0 && index >= lista.length-1){\n    msg.enabled = true;\n    msg1.enabled = false;\n    return [msg,msg1];\n}\n","outputs":2,"noerr":0,"x":610,"y":1700,"wires":[["2220bd8c.bdc722"],["b346c637.2a8c78"]]},{"id":"56d91893.8f58f8","type":"ui_button","z":"7e8bd831.628288","name":"Limpar","group":"bd160cb1.3394e","order":5,"width":"4","height":"1","passthru":false,"label":"Cancelar","tooltip":"","color":"","bgcolor":"","icon":"cancel","payload":"null","payloadType":"json","topic":"","x":170,"y":980,"wires":[["fc10fa75.e15ac8","12be908d.0cfedf"]]},{"id":"fc10fa75.e15ac8","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"ordematual","pt":"flow","to":"null","tot":"json"},{"t":"set","p":"index","pt":"flow","to":"0","tot":"num"},{"t":"set","p":"data","pt":"flow","to":"null","tot":"json"},{"t":"set","p":"encerrarOrdem","pt":"flow","to":"null","tot":"json"},{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":980,"wires":[["d48a68e0.042fd8"]]},{"id":"1fff002e.8d555","type":"function","z":"7e8bd831.628288","name":"Data","func":"var index = 0;\nvar lista = [];\n\nfor(index in flow.get('ordematual').payload.dadosDeProducao){\n    lista.push(flow.get('ordematual').payload.dadosDeProducao.data)\n}\n\nif(lista.length <= 0){\n    msg.payload = \"\";\n    return msg;\n}\n\nif(flow.get('data') === null){\n    msg.payload = \"\";\n    return msg;\n}\nvar data = flow.get('data');\nmsg.payload = data;\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":1640,"wires":[["d02c2dc7.43b8b"]]},{"id":"d48a68e0.042fd8","type":"link out","z":"7e8bd831.628288","name":"limpaOrdem","links":["38483c66.f1e714"],"x":515,"y":980,"wires":[]},{"id":"6d099079.f6711","type":"inject","z":"fa212271.2d00f","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":2780,"wires":[["1d554652.29728a"]]},{"id":"1d554652.29728a","type":"function","z":"fa212271.2d00f","name":"format data for chart  ","func":"var process_id = global.get('process_id') || 0;\nif(process_id !== 150){\n    return;\n}\n\nvar ordem = global.get('ordematual');\nvar lista = [];\nvar comp = 0;\nvar index = 0;\nvar indexx = index+1;\nvar total = 0;\n\nfor(comp in ordem.dadosDeProducao){\n    lista.push(ordem.dadosDeProducao[comp].data);\n}\n\nvar tam = lista.length\n\nwhile(indexx <= tam){\n    var ref = lista[index];\n    var valor = ordem.dadosDeProducao[ref].timeTotal.reduce(function(anterior, atual) {\n        return anterior + atual;\n    });\n    total = total + valor;\n    index ++\n    indexx ++\n}\n\nvar tempoTotal = total;\n\nvar comp = 0;\nvar index = 0;\nvar indexx = index+1;\nvar total = 0;\n\nwhile(indexx <= tam){\n    var ref = lista[index];\n    var valor = ordem.dadosDeProducao[ref].timeCarga.reduce(function(anterior, atual) {\n        return anterior + atual;\n    });\n    total = total + valor;\n    index ++\n    indexx ++\n}\n\nvar tempoCarga = total;\n\nvar comp = 0;\nvar index = 0;\nvar indexx = index+1;\nvar total = 0;\n\nwhile(indexx <= tam){\n    var ref = lista[index];\n    var valor = ordem.dadosDeProducao[ref].timeScheduledStop.reduce(function(anterior, atual) {\n        return anterior + atual;\n    });\n    total = total + valor;\n    index ++\n    indexx ++\n}\n\nvar tempoPlan = total;\n\nvar comp = 0;\nvar index = 0;\nvar indexx = index+1;\nvar total = 0;\n\nwhile(indexx <= tam){\n    var ref = lista[index];\n    var valor = ordem.dadosDeProducao[ref].timeNaoApontada.reduce(function(anterior, atual) {\n        return anterior + atual;\n    });\n    total = total + valor;\n    index ++\n    indexx ++\n}\n\nvar tempoNApt = total;\n\nvar comp = 0;\nvar index = 0;\nvar indexx = index+1;\nvar total = 0;\n\nwhile(indexx <= tam){\n    var ref = lista[index];\n    var valor = ordem.dadosDeProducao[ref].timeUnscheduledStop.reduce(function(anterior, atual) {\n        return anterior + atual;\n    });\n    total = total + valor;\n    index ++\n    indexx ++\n}\n\nvar tempoNPlan = total;\n\nvar comp = 0;\nvar index = 0;\nvar indexx = index+1;\nvar total = 0;\n\nvar tempoUnPlan = tempoNApt + tempoNPlan;\n\nvar tempoTeorico = tempoCarga - tempoUnPlan;\n\nwhile(indexx <= tam){\n    var ref = lista[index];\n    var valor = ordem.dadosDeProducao[ref].totalProduction.reduce(function(anterior, atual) {\n        return anterior + atual;\n    });\n    total = total + valor;\n    index ++\n    indexx ++\n}\n\nvar prodTotal = total;\n\nvar comp = 0;\nvar index = 0;\nvar indexx = index+1;\nvar total = 0;\n\nwhile(indexx <= tam){\n    var ref = lista[index];\n    var valor = ordem.dadosDeProducao[ref].metaProducao.reduce(function(anterior, atual) {\n        return anterior + atual;\n    });\n    total = total + valor;\n    index ++\n    indexx ++\n}\n\nvar metaTotal = total;\n\nvar comp = 0;\nvar index = 0;\nvar indexx = index+1;\nvar total = 0;\n\nvar tempoPerformance = parseInt(((metaTotal - prodTotal)*ordem.skuInformacoes.ciclo));\nif(tempoPerformance < 0){\n    tempoPerformance = 0;\n}\n\nvar tempoReal = tempoTeorico - tempoPerformance;\n\nwhile(indexx <= tam){\n    var ref = lista[index];\n    var valor = ordem.dadosDeProducao[ref].badProduction.reduce(function(anterior, atual) {\n        return anterior + atual;\n    });\n    total = total + valor;\n    index ++\n    indexx ++\n}\n\nvar prodRuim = total;\n\nvar comp = 0;\nvar index = 0;\nvar indexx = index+1;\nvar total = 0;\n\nvar tempoQualidade = parseInt(prodRuim * ordem.skuInformacoes.ciclo);\n\nvar tempoFinal = tempoReal - tempoQualidade;\n\ntempoTotal = [tempoTotal,0,0,0,0];\ntempoCarga = [0,tempoCarga,0,0,0];\ntempoPlan = [0,tempoPlan,0,0,0];\ntempoTeorico = [0,0,tempoTeorico,0,0];\ntempoUnPlan = [0,0,tempoUnPlan,0,0];\ntempoReal = [0,0,0,tempoReal,0];\ntempoPerformance = [0,0,0,tempoPerformance,0];\ntempoFinal = [0,0,0,0,tempoFinal];\ntempoQualidade = [0,0,0,0,tempoQualidade]\n\nvar type = 'horizontalBar';\nvar labels = ['Tempo total','Tempo de carga','Disponibilidade','Perfomance','Qualidade'];\nvar datasets = [{\n    'type': 'horizontalBar',\n    'label': 'Tempo total',\n    'data': tempoTotal,\n    'backgroundColor': 'rgba(7, 89, 0, 0.5)',\n    'borderColor': 'rgba(7, 89, 0, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(7, 89, 0, 1)'\n},\n{\n    'type': 'horizontalBar',\n    'label': 'Tempo programado para produzir',\n    'data': tempoCarga,\n    'backgroundColor': 'rgba(11, 130, 1, 0.5)',\n    'borderColor': 'rgba(11, 130, 1, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(11, 130, 1, 1)'\n},\n{\n    'type': 'horizontalBar',\n    'label': 'Perda planejada',\n    'data': tempoPlan,\n    'backgroundColor': 'rgba(0, 48, 179, 0.5)',\n    'borderColor': 'rgba(0, 48, 179, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(0, 48, 179, 1)'\n},\n{\n    'type': 'horizontalBar',\n    'label': 'Tempo produzindo',\n    'data': tempoTeorico,\n    'backgroundColor': 'rgba(14, 163, 2, 0.5)',\n    'borderColor': 'rgba(14, 163, 2, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(14, 163, 2, 1)'\n},\n{\n    'type': 'horizontalBar',\n    'label': 'Perda não planejada',\n    'data': tempoUnPlan,\n    'backgroundColor': 'rgba(222, 0, 0, 0.5)',\n    'borderColor': 'rgba(222, 0, 0, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(222, 0, 0, 1)'\n},\n{\n    'type': 'horizontalBar',\n    'label': 'Tempo real',\n    'data': tempoReal,\n    'backgroundColor': 'rgba(14, 186, 0, 0.5)',\n    'borderColor': 'rgba(14, 186, 0, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(14, 186, 0, 1)'\n},\n{\n    'type': 'horizontalBar',\n    'label': 'Perda de performance',\n    'data': tempoPerformance,\n    'backgroundColor': 'rgba(242, 0, 0, 0.5)',\n    'borderColor': 'rgba(242, 0, 0, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(242, 0, 0, 1)'\n},\n{\n    'type': 'horizontalBar',\n    'label': 'Tempo final',\n    'data': tempoFinal,\n    'backgroundColor': 'rgba(17, 227, 0, 0.5)',\n    'borderColor': 'rgba(17, 227, 0, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(17, 227, 0, 1)'\n},\n{\n    'type': 'horizontalBar',\n    'label': 'Perda de qualidade',\n    'data': tempoQualidade,\n    'backgroundColor': 'rgba(255, 0, 0, 0.5)',\n    'borderColor': 'rgba(255, 0, 0, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(255, 0, 0, 1)'\n}];\nvar options = {\n        scales: {\n            xAxes: [{ stacked: true }],\n            yAxes: [{ stacked: true }]\n        },\n        title: {\n            display: true,\n            position: 'top',\n            fontSize: 20,\n            text: 'Diagrama de tempos'\n        }\n}\nvar duration = 0;\n\nmsg = {\n    'type': type,\n    'labels': labels,\n    'datasets': datasets,\n    'options': options,\n    'duration': duration        \n    };\n\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":2780,"wires":[["69515832.b21b08"]]},{"id":"69515832.b21b08","type":"ui_template","z":"fa212271.2d00f","group":"4dc7323.a1177cc","name":"Tempos","order":6,"width":"18","height":"9","format":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <title>My Stacked Bar Chart</title>\n</head>\n<body>\n    <canvas id=\"chart\"></canvas>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js\"></script>\n\n    <script>\n        (function(scope) {\n        var timer = setInterval(function() { //check that the Morris libs are loaded, if not wait\n            clearInterval(timer);\n            var ctx = document.getElementById('chart');\n                var barChart = new Chart(ctx, {\n                    type: 'horizontalBar',\n                    data: {\n                        labels: ['Tempo total','Tempo de carga','Disponibilidade','Perfomance','Qualidade'],\n                        datasets: []\n                    },\n                    options: {\n                        scales: {\n                            xAxes: [{ stacked: true }],\n                            yAxes: [{ stacked: true }]\n                        },\n                        title: {\n                            display: true,\n                            position: 'top',\n                            fontSize: 20,\n                        }\n                    }\n                });\n\n            scope.$watch('msg', function (msg) { //watch for an incoming NR msg\n                if (msg) {\n\n                    var data = msg.datasets;\n                    var options = msg;\n                \n                function addData(chart, payload, config) {\n                    chart.options.title.text = config.options.title.text;\n                    chart.data.datasets = payload;\n                    chart.update({ duration: 0 });\n                }\n                addData(barChart,data,options);\n                };\n            }); //close out the watch \n        }, 100); // close out the setInterval \n        })(scope);\n    </script>\n</body>\n</html>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":580,"y":2780,"wires":[[]],"info":"<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"utf-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\r\n    <title>My Stacked Bar Chart</title>\r\n</head>\r\n<body>\r\n    <canvas id=\"chart\"></canvas>\r\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js\"></script>\r\n\r\n    <script>\r\n        (function(scope) {\r\n        var timer = setInterval(function() { //check that the Morris libs are loaded, if not wait\r\n            clearInterval(timer);\r\n            var ctx = document.getElementById('chart');\r\n                    var myChart = new Chart(ctx, {\r\n                        type: 'bar',\r\n                        data: {\r\n                            labels: [],\r\n                            datasets: [{\r\n                                data: []\r\n                            }]\r\n                        },\r\n                        options: {}\r\n                    });\r\n\r\n            scope.$watch('msg', function (msg) { //watch for an incoming NR msg\r\n                if (msg) {\r\n                    var data = msg;\r\n\r\n                    function addData(chart, data) {\r\n                        chart.type = data.type;\r\n                        chart.data.labels = data.labels;\r\n                        chart.data.datasets = [{\r\n                            type: data.datasets[0].type,\r\n                            label: data.datasets[0].label,\r\n                            data: data.datasets[0].data,\r\n                            backgroundColor: data.datasets[0].backgroundColor,\r\n                            borderColor: data.datasets[0].borderColor,\r\n                            borderWidth: data.datasets[0].borderWidth,\r\n                            hoverBackgroundColor: data.datasets[0].hoverBackgroundColor\r\n                        },\r\n                        {\r\n                            type: data.datasets[1].type,\r\n                            label: data.datasets[1].label,\r\n                            data: data.datasets[1].data,\r\n                            backgroundColor: data.datasets[1].backgroundColor,\r\n                            borderColor: data.datasets[1].borderColor,\r\n                            borderWidth: data.datasets[1].borderWidth,\r\n                            hoverBackgroundColor: data.datasets[1].hoverBackgroundColor\r\n                        }];    \r\n                        }\r\n                        chart.options = data.options;\r\n                        chart.update({ duration: data.duration });\r\n                    }\r\n                    addData(myChart,data);\r\n                    msg.payload = myChart;\r\n                    return msg;\r\n                };\r\n            }); //close out the watch \r\n        }, 100); // close out the setInterval \r\n        })(scope);\r\n    </script>\r\n</body>\r\n</html>\r\n"},{"id":"7df11f79.045e5","type":"ui_button","z":"fa212271.2d00f","name":"","group":"361751bb.55a20e","order":11,"width":"4","height":"1","passthru":false,"label":"Tempos","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"hide\":[\"Produção_Produção\",\"Produção_Disponibilidade\",\"Produção_Performance\",\"Produção_Qualidade\",\"Produção_Perdas\",\"Produção_OEE_Acc\",\"Produção_OEE\"],\"show\":[\"Produção_Pareto\"]}}","payloadType":"json","topic":"","x":540,"y":2120,"wires":[["cd3e6a69.02e528"]]},{"id":"758e0bcc.9040c4","type":"inject","z":"7e8bd831.628288","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":1860,"wires":[["bc37ffdc.baac"]]},{"id":"e0ec6583.3cee28","type":"function","z":"7e8bd831.628288","name":"format data for chart  ","func":"var index = 0;\nvar lista = [];\n\nfor(index in flow.get('ordematual').payload.dadosDeProducao){\n    lista.push(flow.get('ordematual').payload.dadosDeProducao.data)\n}\n\nif(lista.length <= 0){\n    msg.payload = \"\";\n    return msg;\n}\n\nvar ordem = flow.get('ordematual').payload;\n\nvar lista = [];\nvar comp = 0;\nvar index = 0;\nvar indexx = index+1;\nvar total = 0;\n\nfor(comp in ordem.dadosDeProducao){\n    lista.push(ordem.dadosDeProducao[comp].data);\n}\n\nvar tam = lista.length\n\nwhile(indexx <= tam){\n    var ref = lista[index];\n    var valor = ordem.dadosDeProducao[ref].timeTotal.reduce(function(anterior, atual) {\n        return anterior + atual;\n    });\n    total = total + valor;\n    index ++\n    indexx ++\n}\n\nvar tempoTotal = total;\n\nvar comp = 0;\nvar index = 0;\nvar indexx = index+1;\nvar total = 0;\n\nwhile(indexx <= tam){\n    var ref = lista[index];\n    var valor = ordem.dadosDeProducao[ref].timeCarga.reduce(function(anterior, atual) {\n        return anterior + atual;\n    });\n    total = total + valor;\n    index ++\n    indexx ++\n}\n\nvar tempoCarga = total;\n\nvar comp = 0;\nvar index = 0;\nvar indexx = index+1;\nvar total = 0;\n\nwhile(indexx <= tam){\n    var ref = lista[index];\n    var valor = ordem.dadosDeProducao[ref].timeScheduledStop.reduce(function(anterior, atual) {\n        return anterior + atual;\n    });\n    total = total + valor;\n    index ++\n    indexx ++\n}\n\nvar tempoPlan = total;\n\nvar comp = 0;\nvar index = 0;\nvar indexx = index+1;\nvar total = 0;\n\nwhile(indexx <= tam){\n    var ref = lista[index];\n    var valor = ordem.dadosDeProducao[ref].timeNaoApontada.reduce(function(anterior, atual) {\n        return anterior + atual;\n    });\n    total = total + valor;\n    index ++\n    indexx ++\n}\n\nvar tempoNApt = total;\n\nvar comp = 0;\nvar index = 0;\nvar indexx = index+1;\nvar total = 0;\n\nwhile(indexx <= tam){\n    var ref = lista[index];\n    var valor = ordem.dadosDeProducao[ref].timeUnscheduledStop.reduce(function(anterior, atual) {\n        return anterior + atual;\n    });\n    total = total + valor;\n    index ++\n    indexx ++\n}\n\nvar tempoNPlan = total;\n\nvar comp = 0;\nvar index = 0;\nvar indexx = index+1;\nvar total = 0;\n\nvar tempoUnPlan = tempoNApt + tempoNPlan;\n\nvar tempoTeorico = tempoCarga - tempoUnPlan;\n\nwhile(indexx <= tam){\n    var ref = lista[index];\n    var valor = ordem.dadosDeProducao[ref].totalProduction.reduce(function(anterior, atual) {\n        return anterior + atual;\n    });\n    total = total + valor;\n    index ++\n    indexx ++\n}\n\nvar prodTotal = total;\n\nvar comp = 0;\nvar index = 0;\nvar indexx = index+1;\nvar total = 0;\n\nwhile(indexx <= tam){\n    var ref = lista[index];\n    var valor = ordem.dadosDeProducao[ref].metaProducao.reduce(function(anterior, atual) {\n        return anterior + atual;\n    });\n    total = total + valor;\n    index ++\n    indexx ++\n}\n\nvar metaTotal = total;\n\nvar comp = 0;\nvar index = 0;\nvar indexx = index+1;\nvar total = 0;\n\nvar tempoPerformance = parseInt(((metaTotal - prodTotal)*ordem.skuInformacoes.ciclo));\nif(tempoPerformance < 0){\n    tempoPerformance = 0;\n}\n\nvar tempoReal = tempoTeorico - tempoPerformance;\n\nwhile(indexx <= tam){\n    var ref = lista[index];\n    var valor = ordem.dadosDeProducao[ref].badProduction.reduce(function(anterior, atual) {\n        return anterior + atual;\n    });\n    total = total + valor;\n    index ++\n    indexx ++\n}\n\nvar prodRuim = total;\n\nvar comp = 0;\nvar index = 0;\nvar indexx = index+1;\nvar total = 0;\n\nvar tempoQualidade = parseInt(prodRuim * ordem.skuInformacoes.ciclo);\n\nvar tempoFinal = tempoReal - tempoQualidade;\n\ntempoTotal = [tempoTotal,0,0,0,0];\ntempoCarga = [0,tempoCarga,0,0,0];\ntempoPlan = [0,tempoPlan,0,0,0];\ntempoTeorico = [0,0,tempoTeorico,0,0];\ntempoUnPlan = [0,0,tempoUnPlan,0,0];\ntempoReal = [0,0,0,tempoReal,0];\ntempoPerformance = [0,0,0,tempoPerformance,0];\ntempoFinal = [0,0,0,0,tempoFinal];\ntempoQualidade = [0,0,0,0,tempoQualidade]\n\nvar type = 'horizontalBar';\nvar labels = ['Tempo total','Tempo de carga','Disponibilidade','Perfomance','Qualidade'];\nvar datasets = [{\n    'type': 'horizontalBar',\n    'label': 'Tempo total',\n    'data': tempoTotal,\n    'backgroundColor': 'rgba(7, 89, 0, 0.5)',\n    'borderColor': 'rgba(7, 89, 0, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(7, 89, 0, 1)'\n},\n{\n    'type': 'horizontalBar',\n    'label': 'Tempo programado para produzir',\n    'data': tempoCarga,\n    'backgroundColor': 'rgba(11, 130, 1, 0.5)',\n    'borderColor': 'rgba(11, 130, 1, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(11, 130, 1, 1)'\n},\n{\n    'type': 'horizontalBar',\n    'label': 'Perda planejada',\n    'data': tempoPlan,\n    'backgroundColor': 'rgba(0, 48, 179, 0.5)',\n    'borderColor': 'rgba(0, 48, 179, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(0, 48, 179, 1)'\n},\n{\n    'type': 'horizontalBar',\n    'label': 'Tempo produzindo',\n    'data': tempoTeorico,\n    'backgroundColor': 'rgba(14, 163, 2, 0.5)',\n    'borderColor': 'rgba(14, 163, 2, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(14, 163, 2, 1)'\n},\n{\n    'type': 'horizontalBar',\n    'label': 'Perda não planejada',\n    'data': tempoUnPlan,\n    'backgroundColor': 'rgba(222, 0, 0, 0.5)',\n    'borderColor': 'rgba(222, 0, 0, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(222, 0, 0, 1)'\n},\n{\n    'type': 'horizontalBar',\n    'label': 'Tempo real',\n    'data': tempoReal,\n    'backgroundColor': 'rgba(14, 186, 0, 0.5)',\n    'borderColor': 'rgba(14, 186, 0, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(14, 186, 0, 1)'\n},\n{\n    'type': 'horizontalBar',\n    'label': 'Perda de performance',\n    'data': tempoPerformance,\n    'backgroundColor': 'rgba(242, 0, 0, 0.5)',\n    'borderColor': 'rgba(242, 0, 0, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(242, 0, 0, 1)'\n},\n{\n    'type': 'horizontalBar',\n    'label': 'Tempo final',\n    'data': tempoFinal,\n    'backgroundColor': 'rgba(17, 227, 0, 0.5)',\n    'borderColor': 'rgba(17, 227, 0, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(17, 227, 0, 1)'\n},\n{\n    'type': 'horizontalBar',\n    'label': 'Perda de qualidade',\n    'data': tempoQualidade,\n    'backgroundColor': 'rgba(255, 0, 0, 0.5)',\n    'borderColor': 'rgba(255, 0, 0, 1)',\n    'borderWidth': 1,\n    'hoverBackgroundColor': 'rgba(255, 0, 0, 1)'\n}];\nvar options = {\n        scales: {\n            xAxes: [{ stacked: true }],\n            yAxes: [{ stacked: true }]\n        },\n        title: {\n            display: true,\n            position: 'top',\n            fontSize: 20,\n            text: 'Diagrama de tempos'\n        }\n}\nvar duration = 0;\n\nmsg = {\n    'type': type,\n    'labels': labels,\n    'datasets': datasets,\n    'options': options,\n    'duration': duration        \n    };\n\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":2020,"wires":[["7b1d93dd.84509c"]]},{"id":"7b1d93dd.84509c","type":"ui_template","z":"7e8bd831.628288","group":"56ed9179.96185","name":"Tempos","order":6,"width":"18","height":"9","format":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n    <title>My Stacked Bar Chart</title>\n</head>\n<body>\n    <canvas id=\"chart\"></canvas>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js\"></script>\n\n    <script>\n        (function(scope) {\n        var timer = setInterval(function() { //check that the Morris libs are loaded, if not wait\n            clearInterval(timer);\n            var ctx = document.getElementById('chart');\n                var barChart = new Chart(ctx, {\n                    type: 'horizontalBar',\n                    data: {\n                        labels: ['Tempo total','Tempo de carga','Disponibilidade','Perfomance','Qualidade'],\n                        datasets: []\n                    },\n                    options: {\n                        scales: {\n                            xAxes: [{ stacked: true }],\n                            yAxes: [{ stacked: true }]\n                        },\n                        title: {\n                            display: true,\n                            position: 'top',\n                            fontSize: 20,\n                        }\n                    }\n                });\n\n            scope.$watch('msg', function (msg) { //watch for an incoming NR msg\n                if (msg) {\n\n                    var data = msg.datasets;\n                    var options = msg;\n                \n                function addData(chart, payload, config) {\n                    chart.options.title.text = config.options.title.text;\n                    chart.data.datasets = payload;\n                    chart.update({ duration: 0 });\n                }\n                addData(barChart,data,options);\n                };\n            }); //close out the watch \n        }, 100); // close out the setInterval \n        })(scope);\n    </script>\n</body>\n</html>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":880,"y":2020,"wires":[[]],"info":"<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"utf-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\r\n    <title>My Stacked Bar Chart</title>\r\n</head>\r\n<body>\r\n    <canvas id=\"chart\"></canvas>\r\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js\"></script>\r\n\r\n    <script>\r\n        (function(scope) {\r\n        var timer = setInterval(function() { //check that the Morris libs are loaded, if not wait\r\n            clearInterval(timer);\r\n            var ctx = document.getElementById('chart');\r\n                    var myChart = new Chart(ctx, {\r\n                        type: 'bar',\r\n                        data: {\r\n                            labels: [],\r\n                            datasets: [{\r\n                                data: []\r\n                            }]\r\n                        },\r\n                        options: {}\r\n                    });\r\n\r\n            scope.$watch('msg', function (msg) { //watch for an incoming NR msg\r\n                if (msg) {\r\n                    var data = msg;\r\n\r\n                    function addData(chart, data) {\r\n                        chart.type = data.type;\r\n                        chart.data.labels = data.labels;\r\n                        chart.data.datasets = [{\r\n                            type: data.datasets[0].type,\r\n                            label: data.datasets[0].label,\r\n                            data: data.datasets[0].data,\r\n                            backgroundColor: data.datasets[0].backgroundColor,\r\n                            borderColor: data.datasets[0].borderColor,\r\n                            borderWidth: data.datasets[0].borderWidth,\r\n                            hoverBackgroundColor: data.datasets[0].hoverBackgroundColor\r\n                        },\r\n                        {\r\n                            type: data.datasets[1].type,\r\n                            label: data.datasets[1].label,\r\n                            data: data.datasets[1].data,\r\n                            backgroundColor: data.datasets[1].backgroundColor,\r\n                            borderColor: data.datasets[1].borderColor,\r\n                            borderWidth: data.datasets[1].borderWidth,\r\n                            hoverBackgroundColor: data.datasets[1].hoverBackgroundColor\r\n                        }];    \r\n                        }\r\n                        chart.options = data.options;\r\n                        chart.update({ duration: data.duration });\r\n                    }\r\n                    addData(myChart,data);\r\n                    msg.payload = myChart;\r\n                    return msg;\r\n                };\r\n            }); //close out the watch \r\n        }, 100); // close out the setInterval \r\n        })(scope);\r\n    </script>\r\n</body>\r\n</html>\r\n"},{"id":"4ca82f17.dfc83","type":"inject","z":"b5ab8ba.7eb7578","name":"Inicialização","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"0.5","x":370,"y":180,"wires":[["19d9e336.65f3ad"]]},{"id":"2c97cfdf.70af6","type":"ui_button","z":"7e8bd831.628288","name":"","group":"3915cecb.4b6d32","order":11,"width":"4","height":"1","passthru":false,"label":"Tempos","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"hide\":[\"Ordem_Produção\",\"Ordem_Disponibilidade\",\"Ordem_Performance\",\"Ordem_Qualidade\",\"Ordem_Perdas\",\"Ordem_OEE\",\"Ordem_Data\"],\"show\":[\"Ordem_Pareto\"]}}","payloadType":"json","topic":"","x":580,"y":1580,"wires":[["70c8d6d0.f9d578"]]},{"id":"bc37ffdc.baac","type":"function","z":"7e8bd831.628288","name":"Filtro","func":"var ordem = flow.get('ordematual');\n\nif (ordem === null || ordem.payload === null){\n    return;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":1860,"wires":[["1fff002e.8d555","ad070868.c86d88","c629c348.62fbb","ad5a589d.884638","d22f5ecf.c73fd","9ca789d5.667f08","95ee765d.f36828","2252bf43.b6a05","e0ec6583.3cee28"]]},{"id":"935314d3.b3eb48","type":"inject","z":"7e8bd831.628288","name":"","topic":"","payload":"","payloadType":"date","repeat":"0.1","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":920,"wires":[["f5352f2f.d20d6"]]},{"id":"f5352f2f.d20d6","type":"function","z":"7e8bd831.628288","name":"Filtro","func":"var ordem = flow.get('ordematual');\n\nif (ordem === null || ordem.payload === null){\n    msg.enabled = true;\n    return msg;\n}\n\nmsg.enabled = false;\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":920,"wires":[["12be908d.0cfedf"]]},{"id":"85db4ef5.95932","type":"inject","z":"fa212271.2d00f","name":"","topic":"","payload":"{\"_id\":\"06102019163151\",\"_rev\":\"5-da7ac2e57be59431405cd1b999a1e4b3\",\"payload\":{\"skuInformacoes\":{\"sku\":\"TODODIA RF HID DES CORP NOZ PEC 400ML PM\",\"ciclo\":1.333,\"velocidadePadrao\":80,\"tempoDeProducao\":\"04:10:03\",\"tempoDeProducaoSec\":15003.750937734434,\"quantidadePrevista\":20000},\"ordemInformacoes\":{\"ordem\":\"06102019163151\",\"produzido\":20680,\"tempoProduzido\":\"05:00:48\",\"tempoProduzidoSec\":18048,\"statusDeOrdem\":\"Encerrada\",\"dataInicial\":\"28/09/2019 - 04:49:54 (+03:00)\",\"dataFinal\":\"28/09/2019 - 09:50:42 (+03:00)\",\"oeeAcc\":89.17},\"dadosDeProducao\":{\"20191006\":{\"data\":20191006,\"goodProduction\":[0,0,0,0,808,2928,3700,3722,4946,2846,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"badProduction\":[0,0,0,0,16,252,146,566,66,684,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"totalProduction\":[0,0,0,0,824,3180,3846,4288,5012,3530,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"metaProducao\":[0,0,0,0,808,3153.33,3699.99,4025.32,4799.99,3342.66,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"timeNaoApontada\":[0,0,0,0,0,512,109,380,0,376,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"timeScheduledStop\":[0,0,0,0,0,723,716,201,0,159,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"timeUnscheduledStop\":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"timeSetup\":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"timeManutProd\":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"timeRefeicao\":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"timeManutPlan\":[0,0,0,0,0,723,716,201,0,159,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"timeStopMachine\":[0,0,0,0,0,1235,825,581,0,535,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"timeTotal\":[0,0,0,0,606,3600,3600,3600,3600,3042,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"timeCarga\":[0,0,0,0,606,2877,2884,3399,3600,2883,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"timeProduzido\":[0,0,0,0,606,2365,2775,3019,3600,2507,0,0,0,0,0,0,0,0,6,0,0,0,0,0],\"qualidade\":[0,0,0,0,98.06,92.08,96.2,86.8,98.68,80.62,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"performance\":[0,0,0,0,101.98,100.85,103.95,106.53,104.42,105.6,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"disponibilidade\":[0,0,0,0,100,82.2,96.22,88.82,100,86.96,0,0,0,0,0,0,0,0,0,0,0,0,0,0],\"oee\":[0,0,0,0,100,76.33,96.22,82.13,103.04,74.04,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}}}}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":2900,"wires":[["b408e3f1.70bb6"]]},{"id":"b408e3f1.70bb6","type":"cloudant out","z":"fa212271.2d00f","name":"Salvar ordem","cloudant":"90d07383.5a36","database":"listadeordem","service":"_ext_","payonly":true,"operation":"insert","x":340,"y":2880,"wires":[]}]