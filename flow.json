[{"id":"b5ab8ba.7eb7578","type":"tab","label":"Inicialização","disabled":true,"info":""},{"id":"49ecca28.ef9cc4","type":"tab","label":"SKU","disabled":false,"info":""},{"id":"7e8bd831.628288","type":"tab","label":"Ordem","disabled":false,"info":""},{"id":"deb5e2ac.bf7d9","type":"ui_tab","z":"","name":"Receitas","icon":"receipt","order":1,"disabled":false,"hidden":false},{"id":"62eb2591.81fb2c","type":"ui_group","z":"","name":"Criar SKU","tab":"deb5e2ac.bf7d9","order":2,"disp":true,"width":"18","collapse":false},{"id":"90d07383.5a36","type":"cloudant","z":"","host":"8c46d960-1fe3-4931-a83e-2c1842052ecb-bluemix.cloudant.com","name":"BD Cloudant"},{"id":"1fcaf060.6cd5f","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"Lucida Sans Typewriter,Lucida Console,Monaco,monospace","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"IIoT","default":"#4B7930","baseColor":"#4a755e","baseFont":"Lucida Sans Typewriter,Lucida Console,Monaco,monospace","reset":false},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":true},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":true},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":true},"group-textColor":{"value":"#1bbfff","edited":true},"group-borderColor":{"value":"#ffffff","edited":true},"group-backgroundColor":{"value":"#ffffff","edited":true},"widget-textColor":{"value":"#111111","edited":true},"widget-backgroundColor":{"value":"#0094ce","edited":true},"widget-borderColor":{"value":"#ffffff","edited":true},"base-font":{"value":"Lucida Sans Typewriter,Lucida Console,Monaco,monospace"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"485819ea.514d78","type":"ui_group","z":"","name":"Alterar SKU","tab":"deb5e2ac.bf7d9","order":3,"disp":true,"width":"18","collapse":false},{"id":"8179319f.da615","type":"ui_group","z":"","name":"Abrir ordem","tab":"a26260b5.0c7c5","order":3,"disp":true,"width":"25","collapse":true},{"id":"a26260b5.0c7c5","type":"ui_tab","z":"","name":"Ordem","icon":"class","order":2,"disabled":false,"hidden":false},{"id":"bd160cb1.3394e","type":"ui_group","z":"","name":"Encerrar ordem","tab":"a26260b5.0c7c5","order":2,"disp":true,"width":"25","collapse":false},{"id":"141a5297.cc40fd","type":"ui_group","z":"","name":"Selecionar SKU","tab":"deb5e2ac.bf7d9","order":1,"disp":false,"width":"6","collapse":false},{"id":"ac03d5c3.0df428","type":"ui_spacer","name":"spacer","group":"141a5297.cc40fd","order":1,"width":"1","height":"5"},{"id":"4bb83922.d144c8","type":"ui_spacer","name":"spacer","group":"141a5297.cc40fd","order":2,"width":"5","height":1},{"id":"b2d9c17f.f4c43","type":"ui_spacer","name":"spacer","group":"141a5297.cc40fd","order":8,"width":"5","height":1},{"id":"75f697ce.0b2378","type":"ui_group","z":"","name":"Deletar SKU","tab":"deb5e2ac.bf7d9","disp":true,"width":"18","collapse":false},{"id":"89d6e588.8cf598","type":"ui_spacer","name":"spacer","group":"485819ea.514d78","order":5,"width":"21","height":1},{"id":"3915cecb.4b6d32","type":"ui_group","z":"","name":"Selecionar Ordem","tab":"a26260b5.0c7c5","order":1,"disp":false,"width":"12","collapse":false},{"id":"b25ef2bb.d769d","type":"ui_spacer","name":"spacer","group":"3915cecb.4b6d32","order":1,"width":1,"height":"7"},{"id":"92e29cb6.6be8","type":"ui_spacer","name":"spacer","group":"3915cecb.4b6d32","order":2,"width":"10","height":1},{"id":"d45671e9.ffc8c","type":"ui_spacer","name":"spacer","group":"3915cecb.4b6d32","order":4,"width":"10","height":1},{"id":"4c47a616.9a8898","type":"ui_spacer","name":"spacer","group":"3915cecb.4b6d32","order":6,"width":"10","height":1},{"id":"b5754700.e65ef8","type":"ui_tab","z":"","name":"test","icon":"dashboard","order":1},{"id":"2cfb9136.b0c45e","type":"ui_form","z":"49ecca28.ef9cc4","name":"","label":"","group":"62eb2591.81fb2c","order":1,"width":0,"height":0,"options":[{"label":"Nome do SKU","value":"sku","type":"text","required":true},{"label":"Velocidade padrão (pçs/min)","value":"velocidade","type":"number","required":true},{"label":"Ativo","value":"estado","type":"switch","required":true}],"formValue":{"sku":"","velocidade":"","estado":false},"payload":"","submit":"Salvar","cancel":"Limpar","topic":"","x":170,"y":240,"wires":[["6a74e635.460d18"]]},{"id":"497f304e.70cbb","type":"cloudant out","z":"49ecca28.ef9cc4","name":"Salvar SKU","cloudant":"90d07383.5a36","database":"listadesku","service":"_ext_","payonly":false,"operation":"insert","x":810,"y":240,"wires":[]},{"id":"881811d5.21d58","type":"function","z":"49ecca28.ef9cc4","name":"Cria ciclo e _id","func":"msg.payload.ciclo = parseInt((msg.payload.velocidade / 60)*1000)/1000;\nmsg._id = msg.payload.sku;\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":240,"wires":[["497f304e.70cbb","fbb09446.228258"]]},{"id":"6a74e635.460d18","type":"moment","z":"49ecca28.ef9cc4","name":"Data","topic":"","input":"","inputType":"date","inTz":"America/Sao_Paulo","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD/MM/YYYY - HH:mm:ss","locale":"pt_BR","output":"payload.data","outputType":"msg","outTz":"America/Sao_Paulo","x":410,"y":240,"wires":[["881811d5.21d58"]]},{"id":"317c7761.2c0f48","type":"cloudant in","z":"49ecca28.ef9cc4","name":"Consulta SKU","cloudant":"90d07383.5a36","database":"listadesku","service":"_ext_","search":"_all_","design":"","index":"","x":700,"y":360,"wires":[["87e49dd3.21737","14d3f64b.fbc96a"]]},{"id":"42fcae2e.9930b","type":"delay","z":"49ecca28.ef9cc4","name":"Tempo","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":510,"y":360,"wires":[["317c7761.2c0f48"]]},{"id":"6b904b6d.f387c4","type":"comment","z":"49ecca28.ef9cc4","name":"Criar um novo SKU","info":"Criar um novo SKU","x":210,"y":180,"wires":[]},{"id":"ba141daa.5a9db","type":"comment","z":"49ecca28.ef9cc4","name":"Após criar e deletar atualiza lista de SKU","info":"Após criar e deletar atualiza lista de SKU","x":280,"y":300,"wires":[]},{"id":"fbb09446.228258","type":"link out","z":"49ecca28.ef9cc4","name":"triggerCriarSKU","links":["c331df92.6d041"],"x":755,"y":280,"wires":[]},{"id":"c331df92.6d041","type":"link in","z":"49ecca28.ef9cc4","name":"atulizaListaSKU","links":["4488759a.248fac","fbb09446.228258","29cfb9d0.da24c6","ba4c8593.161098"],"x":135,"y":360,"wires":[["b1040f1b.863f5"]]},{"id":"24b0d504.80da4a","type":"comment","z":"49ecca28.ef9cc4","name":"Seleciona um SKU para deletar","info":"Seleciona um SKU para deletar","x":250,"y":560,"wires":[]},{"id":"2ffc2fbf.07eb4","type":"ui_dropdown","z":"49ecca28.ef9cc4","name":"Droplist deletar SKU","label":"Selecione um SKU para apagar","tooltip":"","place":"Selecione um SKU","group":"75f697ce.0b2378","order":1,"width":0,"height":0,"passthru":false,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":300,"y":620,"wires":[["54e0f6c8.389fc8"]]},{"id":"a7b8fbce.99ddf8","type":"ui_button","z":"49ecca28.ef9cc4","name":"Limpar","group":"75f697ce.0b2378","order":2,"width":"4","height":"1","passthru":false,"label":"Cancelar","tooltip":"","color":"","bgcolor":"","icon":"cancel","payload":"null","payloadType":"json","topic":"","x":180,"y":760,"wires":[["bdfecda2.8ea9e"]]},{"id":"d643e6ff.de82f8","type":"comment","z":"49ecca28.ef9cc4","name":"Limpa a lista de SKU para deletar","info":"Limpa a lista de SKU para deletar","x":250,"y":700,"wires":[]},{"id":"bdfecda2.8ea9e","type":"link out","z":"49ecca28.ef9cc4","name":"limpaLista","links":["ccccb9d6.f9c638","f979583b.ed2f08"],"x":305,"y":760,"wires":[]},{"id":"ccccb9d6.f9c638","type":"link in","z":"49ecca28.ef9cc4","name":"limpaListaSKU","links":["394d67a3.ae8a48","4488759a.248fac","bdfecda2.8ea9e","926f15c2.c35308"],"x":135,"y":620,"wires":[["2ffc2fbf.07eb4"]]},{"id":"54e0f6c8.389fc8","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"deletarSKU","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":620,"wires":[[]]},{"id":"f979583b.ed2f08","type":"link in","z":"49ecca28.ef9cc4","name":"limpaContentSKU","links":["bdfecda2.8ea9e","4488759a.248fac","926f15c2.c35308"],"x":395,"y":660,"wires":[["54e0f6c8.389fc8"]]},{"id":"3e18e5c8.d79eba","type":"comment","z":"49ecca28.ef9cc4","name":"Deleta SKU selecionado","info":"Deleta SKU selecionado","x":230,"y":820,"wires":[]},{"id":"46aabcc5.006ed4","type":"ui_button","z":"49ecca28.ef9cc4","name":"Apagar","group":"75f697ce.0b2378","order":3,"width":"4","height":"1","passthru":false,"label":"Apagar","tooltip":"","color":"","bgcolor":"","icon":"delete","payload":"null","payloadType":"json","topic":"","x":180,"y":880,"wires":[["af3b5319.53d54","4488759a.248fac"]]},{"id":"af3b5319.53d54","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"deletarSKU","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":880,"wires":[["66d99031.ea83c"]]},{"id":"66d99031.ea83c","type":"cloudant in","z":"49ecca28.ef9cc4","name":"Consulta SKU","cloudant":"90d07383.5a36","database":"listadesku","service":"_ext_","search":"_id_","design":"","index":"","x":600,"y":880,"wires":[["ab2ae5e7.aff1c8"]]},{"id":"ab2ae5e7.aff1c8","type":"cloudant out","z":"49ecca28.ef9cc4","name":"Deletar SKU","cloudant":"90d07383.5a36","database":"listadesku","service":"_ext_","payonly":false,"operation":"delete","x":810,"y":880,"wires":[]},{"id":"4488759a.248fac","type":"link out","z":"49ecca28.ef9cc4","name":"apagaSKU","links":["c331df92.6d041","ccccb9d6.f9c638","f979583b.ed2f08"],"x":315,"y":920,"wires":[]},{"id":"b1040f1b.863f5","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":360,"wires":[["42fcae2e.9930b"]]},{"id":"787cd8de.f4ca58","type":"catch","z":"49ecca28.ef9cc4","name":"Catch SKU repetido","scope":["497f304e.70cbb","c4e16a49.5c8098"],"uncaught":false,"x":210,"y":1480,"wires":[["5e51494a.f5fef8"]]},{"id":"b6bec578.3db568","type":"comment","z":"49ecca28.ef9cc4","name":"Try catch para erros do BD","info":"Try catch para erros do BD","x":230,"y":1420,"wires":[]},{"id":"5e51494a.f5fef8","type":"function","z":"49ecca28.ef9cc4","name":"Reposta","func":"if(msg.error.message === 'Failed to insert document: couch returned 409'){\n    msg.payload = [];\n    msg.payload = 'Este SKU já existe';\n    return msg\n}\n","outputs":1,"noerr":0,"x":420,"y":1480,"wires":[["5edfb9c9.fb5298"]]},{"id":"5edfb9c9.fb5298","type":"ui_toast","z":"49ecca28.ef9cc4","position":"dialog","displayTime":"3","highlight":"","outputs":1,"ok":"Ok","cancel":"","topic":"","name":"Alerta","x":590,"y":1480,"wires":[[]]},{"id":"4af72fce.bb7a9","type":"comment","z":"49ecca28.ef9cc4","name":"Alterar SKU","info":"Alterar SKU","x":190,"y":980,"wires":[]},{"id":"adf16cf6.ad84e","type":"ui_dropdown","z":"49ecca28.ef9cc4","name":"Droplist alterar SKU","label":"Selecione um SKU para alterar","tooltip":"","place":"Selecione um SKU","group":"485819ea.514d78","order":1,"width":0,"height":0,"passthru":false,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":320,"y":1040,"wires":[["94d1bfa9.e87e2"]]},{"id":"da097889.5d5e98","type":"comment","z":"49ecca28.ef9cc4","name":"Atualiza lista de SKU","info":"Atualiza lista de SKU","x":220,"y":420,"wires":[]},{"id":"d38269bb.212ab8","type":"inject","z":"49ecca28.ef9cc4","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":480,"wires":[["3bbc91d2.95a70e"]]},{"id":"3bbc91d2.95a70e","type":"function","z":"49ecca28.ef9cc4","name":"Escreve lista","func":"var lista = global.get(\"listasku\") || [];\nvar listaatual = flow.get('listaskuatual') || [];\nif (lista.length != listaatual.length || msg.payload === 'init' || msg.estado === 'init'){\n    flow.set('listaskuatual',lista)\n    msg.options = lista\n    return msg\n}","outputs":1,"noerr":0,"x":390,"y":480,"wires":[["394d67a3.ae8a48"]]},{"id":"394d67a3.ae8a48","type":"link out","z":"49ecca28.ef9cc4","name":"listaSKUAtualizada","links":["36006f00.5b3c62","ccccb9d6.f9c638"],"x":535,"y":480,"wires":[]},{"id":"36006f00.5b3c62","type":"link in","z":"49ecca28.ef9cc4","name":"dropAtualizaSKU","links":["394d67a3.ae8a48","a49488a8.c5c838"],"x":135,"y":1040,"wires":[["adf16cf6.ad84e"]]},{"id":"94d1bfa9.e87e2","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"alterarSKU","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":1040,"wires":[["90adfa82.aa99f8"]]},{"id":"90adfa82.aa99f8","type":"cloudant in","z":"49ecca28.ef9cc4","name":"Consulta SKU","cloudant":"90d07383.5a36","database":"listadesku","service":"_ext_","search":"_id_","design":"","index":"","x":800,"y":1040,"wires":[["68aa8376.6df53c"]]},{"id":"68aa8376.6df53c","type":"function","z":"49ecca28.ef9cc4","name":"Split","func":"var msg1 = { payload: msg.payload.payload.sku,\n             enabled: true};\nvar msg2 = { payload: msg.payload.payload.velocidade,\n             enabled: true};\nvar msg3 = { payload: msg.payload.payload.estado,\n             enabled: true};\nvar msg4 = { payload: msg.payload.payload.data};\n\nreturn [msg1,msg2,msg3,msg4];","outputs":4,"noerr":0,"x":990,"y":1040,"wires":[["84b98fa9.131ab"],["6749a804.460438"],["47993d78.1201c4"],["b8e873f2.f798c"]]},{"id":"84b98fa9.131ab","type":"ui_text_input","z":"49ecca28.ef9cc4","name":"Nome do SKU","label":"Nome do SKU","tooltip":"","group":"485819ea.514d78","order":2,"width":0,"height":0,"passthru":true,"mode":"text","delay":"0","topic":"","x":1200,"y":1000,"wires":[["897db7f2.526ee8"]]},{"id":"6749a804.460438","type":"ui_text_input","z":"49ecca28.ef9cc4","name":"Velocidade do SKU","label":"Velocidade do SKU (pç/min)","tooltip":"","group":"485819ea.514d78","order":3,"width":0,"height":0,"passthru":true,"mode":"number","delay":"0","topic":"","x":1210,"y":1040,"wires":[["7e8cff8f.2c71"]]},{"id":"897db7f2.526ee8","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"novoNomeSKU","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1450,"y":1000,"wires":[[]]},{"id":"7e8cff8f.2c71","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"novaVelocidadeSKU","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1480,"y":1040,"wires":[[]]},{"id":"6d2794d8.22c80c","type":"ui_button","z":"49ecca28.ef9cc4","name":"Limpar","group":"485819ea.514d78","order":6,"width":"4","height":"1","passthru":false,"label":"Cancelar","tooltip":"","color":"","bgcolor":"","icon":"cancel","payload":" null","payloadType":"num","topic":"","x":190,"y":1360,"wires":[["8c18bcdb.aae78","fcbe5bf.5d322a8"]]},{"id":"bd9f864d.3678f8","type":"comment","z":"49ecca28.ef9cc4","name":"Inicialização","info":"Inicialização","x":190,"y":40,"wires":[]},{"id":"5bcb1fd5.791eb","type":"inject","z":"49ecca28.ef9cc4","name":"Inicialização","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":190,"y":100,"wires":[["b20f1e91.509b1","4d5f434a.8352bc"]]},{"id":"baa4226.298fee","type":"comment","z":"49ecca28.ef9cc4","name":"Limpa a lista de SKU para alterar","info":"Limpa a lista de SKU para alterar","x":250,"y":1300,"wires":[]},{"id":"b8f57356.c9313","type":"link out","z":"49ecca28.ef9cc4","name":"limpaAlterarSKU","links":["41f89d1b.fc9234"],"x":535,"y":1340,"wires":[]},{"id":"41f89d1b.fc9234","type":"link in","z":"49ecca28.ef9cc4","name":"limpaAlterarSKU","links":["b8f57356.c9313","2a04df1.48afb2","cb5a4e6a.9ae44"],"x":895,"y":1100,"wires":[["bc73fb8.ff59208"]]},{"id":"2a04df1.48afb2","type":"link out","z":"49ecca28.ef9cc4","name":"bloqueiaAlterarSKU","links":["41f89d1b.fc9234"],"x":575,"y":100,"wires":[]},{"id":"b20f1e91.509b1","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"  ","tot":"str"},{"t":"set","p":"enabled","pt":"msg","to":"false","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":100,"wires":[["2a04df1.48afb2"]]},{"id":"4d5f434a.8352bc","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"init","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":140,"wires":[["29cfb9d0.da24c6"]]},{"id":"29cfb9d0.da24c6","type":"link out","z":"49ecca28.ef9cc4","name":"inicializaListas","links":["496b4092.dc502","c331df92.6d041","e81cdc1a.1d7e8"],"x":555,"y":140,"wires":[]},{"id":"496b4092.dc502","type":"link in","z":"49ecca28.ef9cc4","name":"inicializaListas","links":["29cfb9d0.da24c6","52feb5a2.51737c"],"x":95,"y":520,"wires":[["647f3ea4.05869"]]},{"id":"ad4f101d.33aaf","type":"ui_button","z":"49ecca28.ef9cc4","name":"Alterar","group":"485819ea.514d78","order":7,"width":"4","height":"1","passthru":false,"label":"Alterar","tooltip":"","color":"","bgcolor":"","icon":"autorenew","payload":"null","payloadType":"num","topic":"","x":170,"y":1100,"wires":[["e0a5e8e4.a23498","797899a0.d17868","8cf3223b.fe6df"]]},{"id":"cb5a4e6a.9ae44","type":"link out","z":"49ecca28.ef9cc4","name":"apagarCamposAlterar","links":["48b966f1.0b0a58","41f89d1b.fc9234"],"x":515,"y":1180,"wires":[]},{"id":"e0a5e8e4.a23498","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"alterarSKU","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":1100,"wires":[["bf85037.ecf66"]]},{"id":"bf85037.ecf66","type":"cloudant in","z":"49ecca28.ef9cc4","name":"Consulta SKU","cloudant":"90d07383.5a36","database":"listadesku","service":"_ext_","search":"_id_","design":"","index":"","x":580,"y":1100,"wires":[["99c51a01.0a6158"]]},{"id":"99c51a01.0a6158","type":"cloudant out","z":"49ecca28.ef9cc4","name":"Deletar SKU","cloudant":"90d07383.5a36","database":"listadesku","service":"_ext_","payonly":false,"operation":"delete","x":790,"y":1100,"wires":[]},{"id":"48b966f1.0b0a58","type":"link in","z":"49ecca28.ef9cc4","name":"alterarSKU","links":["cb5a4e6a.9ae44"],"x":135,"y":1240,"wires":[["efd0cd29.71a93"]]},{"id":"c4e16a49.5c8098","type":"cloudant out","z":"49ecca28.ef9cc4","name":"Salvar SKU","cloudant":"90d07383.5a36","database":"listadesku","service":"_ext_","payonly":false,"operation":"insert","x":1010,"y":1220,"wires":[]},{"id":"4061ff31.9db4b","type":"function","z":"49ecca28.ef9cc4","name":"Altera SKU","func":"var velocidade = flow.get('novaVelocidadeSKU');\nvar sku = flow.get('novoNomeSKU');\nvar estado = flow.get('novaEstadoSKU');\nvar ciclo = parseInt((velocidade / 60)*1000)/1000;\nvar data = msg.payload.data;\nvar dataAnterior = flow.get('dataAntiga');\nvar msg1 = {\n    \"payload\": \"init\"\n}\nmsg = {\n    \"payload\": {\n        \"sku\": sku,\n        \"velocidade\": velocidade,\n        \"estado\": estado,\n        \"ciclo\": ciclo,\n        \"data\": data,\n        \"ultimaData\": dataAnterior\n    },\n    \"_id\": sku\n}\n\nreturn [msg,msg1];","outputs":2,"noerr":0,"x":650,"y":1240,"wires":[["82469f17.56c0f"],["bc150cef.8638f"]]},{"id":"fef618f4.eea998","type":"moment","z":"49ecca28.ef9cc4","name":"Data","topic":"","input":"","inputType":"date","inTz":"America/Sao_Paulo","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD/MM/YYYY - HH:mm:ss","locale":"pt_BR","output":"payload.data","outputType":"msg","outTz":"America/Sao_Paulo","x":470,"y":1240,"wires":[["4061ff31.9db4b"]]},{"id":"a49488a8.c5c838","type":"link out","z":"49ecca28.ef9cc4","name":"nullAlterarSKU","links":["36006f00.5b3c62"],"x":535,"y":1380,"wires":[]},{"id":"8c18bcdb.aae78","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"null","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":1380,"wires":[["a49488a8.c5c838"]]},{"id":"efd0cd29.71a93","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"_event","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":1240,"wires":[["fef618f4.eea998"]]},{"id":"ba4c8593.161098","type":"link out","z":"49ecca28.ef9cc4","name":"triggerAlterarSKU","links":["c331df92.6d041"],"x":935,"y":1260,"wires":[]},{"id":"647f3ea4.05869","type":"delay","z":"49ecca28.ef9cc4","name":"Tempo","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":210,"y":520,"wires":[["3bbc91d2.95a70e"]]},{"id":"52feb5a2.51737c","type":"link out","z":"49ecca28.ef9cc4","name":"estadoListaSKU","links":["496b4092.dc502","e81cdc1a.1d7e8"],"x":1055,"y":360,"wires":[]},{"id":"bc73fb8.ff59208","type":"delay","z":"49ecca28.ef9cc4","name":"Tempo","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":990,"y":1100,"wires":[["6749a804.460438","84b98fa9.131ab","a80126e0.1af3b8"]]},{"id":"82469f17.56c0f","type":"delay","z":"49ecca28.ef9cc4","name":"Tempo","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":830,"y":1220,"wires":[["c4e16a49.5c8098"]]},{"id":"bc150cef.8638f","type":"delay","z":"49ecca28.ef9cc4","name":"Tempo","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":830,"y":1260,"wires":[["ba4c8593.161098"]]},{"id":"76e4d5ec.a4612c","type":"ui_toast","z":"49ecca28.ef9cc4","position":"dialog","displayTime":"3","highlight":"","outputs":1,"ok":"OK","cancel":"","topic":"","name":"Alerta","x":550,"y":1140,"wires":[[]]},{"id":"797899a0.d17868","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Alterando as informações. Por favor aguarde!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":1140,"wires":[["76e4d5ec.a4612c"]]},{"id":"fcbe5bf.5d322a8","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"false","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":380,"y":1340,"wires":[["b8f57356.c9313"]]},{"id":"8cf3223b.fe6df","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"false","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":1180,"wires":[["cb5a4e6a.9ae44"]]},{"id":"47993d78.1201c4","type":"ui_switch","z":"49ecca28.ef9cc4","name":"Estado","label":"Ativo","tooltip":"","group":"485819ea.514d78","order":4,"width":"2","height":"1","passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":1180,"y":1080,"wires":[["1dec6bbc.3e0324"]]},{"id":"1dec6bbc.3e0324","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"novaEstadoSKU","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1410,"y":1080,"wires":[[]]},{"id":"87e49dd3.21737","type":"function","z":"49ecca28.ef9cc4","name":"Exec push ativos","func":"var lista = msg.payload\nvar index = msg.payload.length\nmsg.payload = []\nfor (index in lista){\n    if(lista[index].payload.estado === true){\n        msg.payload.push(lista[index].payload.sku)\n    }\n}\nglobal.set(\"listaskuativos\",msg.payload)\nmsg.estado = 'init';\nreturn msg;","outputs":1,"noerr":0,"x":930,"y":400,"wires":[[]]},{"id":"a80126e0.1af3b8","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":1140,"wires":[["47993d78.1201c4"]]},{"id":"b8e873f2.f798c","type":"change","z":"49ecca28.ef9cc4","name":"","rules":[{"t":"set","p":"dataAntiga","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1230,"y":1140,"wires":[[]]},{"id":"ba5efce6.b81ba","type":"comment","z":"7e8bd831.628288","name":"Exibe lista de SKU para ordem","info":"Exibe lista de SKU para ordem","x":250,"y":180,"wires":[]},{"id":"ce8575f7.96d438","type":"comment","z":"7e8bd831.628288","name":"Inicialização","info":"Inicialização","x":190,"y":40,"wires":[]},{"id":"bca7442a.98e138","type":"inject","z":"7e8bd831.628288","name":"Inicialização","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":190,"y":100,"wires":[["eea022e8.131e9"]]},{"id":"dbab1203.1ed05","type":"inject","z":"7e8bd831.628288","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":240,"wires":[["f0597d3f.007b2"]]},{"id":"f0597d3f.007b2","type":"function","z":"7e8bd831.628288","name":"Escreve lista","func":"var lista = global.get(\"listaskuativos\") || [];\nvar listaatual = flow.get('listaskuatual') || [];\nif (lista.length != listaatual.length || msg.payload === 'init' || msg.estado === 'init'){\n    flow.set('listaskuatual',lista)\n    msg.options = lista\n    return msg\n}","outputs":1,"noerr":0,"x":390,"y":240,"wires":[["7b4b202b.95805"]]},{"id":"7dd9c90f.0e5f68","type":"comment","z":"7e8bd831.628288","name":"Seleciona um SKU para deletar","info":"Seleciona um SKU para deletar","x":250,"y":340,"wires":[]},{"id":"c5c73cff.5e96d","type":"ui_dropdown","z":"7e8bd831.628288","name":"Droplist SKU ativo","label":"Selecione um SKU ativo","tooltip":"","place":"Selecione um SKU ativo","group":"8179319f.da615","order":1,"width":0,"height":0,"passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":290,"y":400,"wires":[["ab044e26.8acb8","3b8a49bb.da4406"]]},{"id":"ab044e26.8acb8","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"SKUAtivoOrdem","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":400,"wires":[["fdfcb4c1.5f7908"]]},{"id":"7b4b202b.95805","type":"link out","z":"7e8bd831.628288","name":"listaSKUAtivo","links":["184c78b7.88dee7"],"x":535,"y":240,"wires":[]},{"id":"eea022e8.131e9","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"init","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":100,"wires":[["2e604ed0.6b5042"]]},{"id":"2e604ed0.6b5042","type":"link out","z":"7e8bd831.628288","name":"inicializaListas","links":["2643bdc5.c5b1c2","2c2649e1.e6e856","5c833b86.93fa04"],"x":555,"y":100,"wires":[]},{"id":"2643bdc5.c5b1c2","type":"link in","z":"7e8bd831.628288","name":"forçaAtualizaçãoLista","links":["2e604ed0.6b5042"],"x":235,"y":280,"wires":[["f0597d3f.007b2"]]},{"id":"6fc56fb9.c8eea","type":"comment","z":"7e8bd831.628288","name":"Calcula tempo previsto para conclusão","info":"Calcula tempo previsto para conclusão","x":270,"y":500,"wires":[]},{"id":"fdfcb4c1.5f7908","type":"cloudant in","z":"7e8bd831.628288","name":"Consulta SKU","cloudant":"90d07383.5a36","database":"listadesku","service":"_ext_","search":"_id_","design":"","index":"","x":800,"y":400,"wires":[["cdd8771c.da3e48"]]},{"id":"cdd8771c.da3e48","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"cicloSKUOrdem","pt":"flow","to":"payload.payload.ciclo","tot":"msg"},{"t":"set","p":"velocidadeSKUOrdem","pt":"flow","to":"payload.payload.velocidade","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":400,"wires":[[]]},{"id":"f1ff0ad.0f45df8","type":"ui_text_input","z":"7e8bd831.628288","name":"Produção prevista","label":"Quantidade de produção prevista","tooltip":"","group":"8179319f.da615","order":3,"width":0,"height":0,"passthru":true,"mode":"number","delay":"0","topic":"","x":490,"y":560,"wires":[["ce9ee40.6b9fd2"]]},{"id":"238b242e.6a572c","type":"function","z":"7e8bd831.628288","name":"Cacula tempo","func":"var producao = msg.payload;\nvar ciclo = flow.get('cicloSKUOrdem') || 0;\nvar segundos = producao / ciclo;\n\nfunction format(numero){\n    if (numero <= 9){\n\t    numero = \"0\"+numero;\n    }\n    return numero;\n    }\n\nvar fhora = format(Math.round(segundos/3600));\nvar fmin = format(Math.floor((segundos%3600)/60));\nvar fseg = format((segundos%3600)%60);\n    \nvar tempo = fhora+\":\"+fmin+\":\"+fseg;\n\nif(tempo === 0){\n    return msg;\n}\nif(tempo !== 0){\n    msg.payload = tempo;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1000,"y":560,"wires":[["fd6ec161.c831d"]]},{"id":"fd6ec161.c831d","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"tempoPrevistoOrdem","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1260,"y":560,"wires":[["e4aef086.a6e4b"]]},{"id":"e4aef086.a6e4b","type":"ui_text","z":"7e8bd831.628288","group":"8179319f.da615","order":4,"width":0,"height":0,"name":"Tempo previsto","label":"Tempo previsto:","format":"{{msg.payload}}","layout":"row-left","x":1520,"y":560,"wires":[]},{"id":"184c78b7.88dee7","type":"link in","z":"7e8bd831.628288","name":"dropSKUAtivo","links":["7a9ed299.6087ec","7b4b202b.95805","92d37ef0.fc181"],"x":115,"y":400,"wires":[["c5c73cff.5e96d"]]},{"id":"e99ec9c.178a838","type":"link in","z":"7e8bd831.628288","name":"producaoPrevista","links":["7a9ed299.6087ec","92d37ef0.fc181"],"x":115,"y":560,"wires":[["53244fab.e1964"]]},{"id":"3b8a49bb.da4406","type":"moment","z":"7e8bd831.628288","name":"Gera ordem","topic":"","input":"","inputType":"date","inTz":"America/Sao_Paulo","adjAmount":0,"adjType":"days","adjDir":"add","format":"ssmmHHDDMMYYYY","locale":"pt_BR","output":"ordem","outputType":"flow","outTz":"America/Sao_Paulo","x":510,"y":440,"wires":[["ff3fa06d.fdfe9"]]},{"id":"9a5c5c08.b9a82","type":"ui_button","z":"7e8bd831.628288","name":"Criar ordem","group":"8179319f.da615","order":5,"width":"4","height":"1","passthru":false,"label":"Criar ordem","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":190,"y":700,"wires":[["e87c5611.b0f018"]]},{"id":"8c13710d.43ec9","type":"ui_text","z":"7e8bd831.628288","group":"8179319f.da615","order":2,"width":0,"height":0,"name":"Ordem","label":"Ordem:","format":"{{msg.payload}}","layout":"row-left","x":910,"y":440,"wires":[]},{"id":"e0ad195a.500e88","type":"comment","z":"7e8bd831.628288","name":"Grava ordem","info":"Grava ordem","x":190,"y":640,"wires":[]},{"id":"ff3fa06d.fdfe9","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"ordem","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":440,"wires":[["8c13710d.43ec9"]]},{"id":"a40570cb.e17e1","type":"function","z":"7e8bd831.628288","name":"Grava ordem","func":"var sku = flow.get('SKUAtivoOrdem');\nvar ciclo = flow.get('cicloSKUOrdem');\nvar velocidade = flow.get('velocidadeSKUOrdem');\nvar tempo = flow.get('tempoPrevistoOrdem');\nvar ordem = flow.get('ordem');\nvar producao = flow.get('producaoPrevista');\nvar data = msg.payload;\nmsg.payload = []\nif(producao > 0 && sku !== null){\n    msg = {\n    \"payload\":{\n        \"sku\": sku,\n        \"ciclo\": ciclo,\n        \"velocidade\": velocidade,\n        \"tempo\": tempo,\n        \"ordem\": ordem,\n        \"data\": data\n    },\n    \"_id\": ordem\n    }\n    return [msg,null];\n}\nif(producao <= 0){\n    var msg1 = {\"payload\": \"Informe a quantidade de produção prevista!\"}\n    return [null,msg1];\n}\nif(sku === null){\n    var msg1 = {\"payload\": \"Informe um SKU!\"}\n    return [null,msg1];\n}","outputs":2,"noerr":0,"x":550,"y":700,"wires":[["fe234d71.21618","15ada1ae.db350e"],["12fdabd7.3601e4"]]},{"id":"e87c5611.b0f018","type":"moment","z":"7e8bd831.628288","name":"Data","topic":"","input":"","inputType":"date","inTz":"America/Sao_Paulo","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD/MM/YYYY - HH:mm:ss","locale":"pt_BR","output":"payload","outputType":"msg","outTz":"America/Sao_Paulo","x":370,"y":700,"wires":[["a40570cb.e17e1"]]},{"id":"ce9ee40.6b9fd2","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"producaoPrevista","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":750,"y":560,"wires":[["238b242e.6a572c"]]},{"id":"12fdabd7.3601e4","type":"ui_toast","z":"7e8bd831.628288","position":"dialog","displayTime":"3","highlight":"","outputs":1,"ok":"OK","cancel":"","topic":"","name":"Alerta","x":730,"y":720,"wires":[[]]},{"id":"fe234d71.21618","type":"cloudant out","z":"7e8bd831.628288","name":"Salvar ordem","cloudant":"90d07383.5a36","database":"listadeordem","service":"_ext_","payonly":false,"operation":"insert","x":750,"y":680,"wires":[]},{"id":"5b397e65.e8d75","type":"ui_button","z":"7e8bd831.628288","name":"Limpar","group":"8179319f.da615","order":6,"width":"4","height":"1","passthru":false,"label":"Cancelar","tooltip":"","color":"","bgcolor":"","icon":"cancel","payload":"null","payloadType":"json","topic":"","x":180,"y":840,"wires":[["7a9ed299.6087ec"]]},{"id":"42315ece.4720a","type":"comment","z":"7e8bd831.628288","name":"Limpa criar ordem","info":"Limpa criar ordem","x":210,"y":780,"wires":[]},{"id":"7a9ed299.6087ec","type":"link out","z":"7e8bd831.628288","name":"limpaOrdem","links":["e99ec9c.178a838","7c14c4af.ce7abc","184c78b7.88dee7","5ab6ce1.5d7703"],"x":295,"y":840,"wires":[]},{"id":"7c14c4af.ce7abc","type":"link in","z":"7e8bd831.628288","name":"limpaOrdem","links":["7a9ed299.6087ec","92d37ef0.fc181"],"x":575,"y":480,"wires":[["75d00bc5.22b674"]]},{"id":"5ab6ce1.5d7703","type":"link in","z":"7e8bd831.628288","name":"limpaTempoPrevisto","links":["7a9ed299.6087ec","92d37ef0.fc181"],"x":1155,"y":600,"wires":[["288ae837.0ba8c8"]]},{"id":"288ae837.0ba8c8","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"00:00:00","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1300,"y":600,"wires":[["e4aef086.a6e4b"]]},{"id":"75d00bc5.22b674","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":720,"y":480,"wires":[["8c13710d.43ec9"]]},{"id":"53244fab.e1964","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":260,"y":560,"wires":[["f1ff0ad.0f45df8"]]},{"id":"15ada1ae.db350e","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"null","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":960,"y":700,"wires":[["92d37ef0.fc181","bee1bacb.881958"]]},{"id":"92d37ef0.fc181","type":"link out","z":"7e8bd831.628288","name":"limpaAposSalvar","links":["7c14c4af.ce7abc","5ab6ce1.5d7703","e99ec9c.178a838","5c833b86.93fa04","184c78b7.88dee7"],"x":1095,"y":680,"wires":[]},{"id":"bee1bacb.881958","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Ordem salva com sucesso!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1220,"y":700,"wires":[["4edd4f31.21cf"]]},{"id":"4edd4f31.21cf","type":"ui_toast","z":"7e8bd831.628288","position":"dialog","displayTime":"3","highlight":"","outputs":1,"ok":"OK","cancel":"","topic":"","name":"Alerta","x":1410,"y":700,"wires":[[]]},{"id":"df8c4a2.4fa57b8","type":"comment","z":"7e8bd831.628288","name":"Exibe lista de ordens","info":"Exibe lista de ordens","x":220,"y":900,"wires":[]},{"id":"ed897ac6.0a5518","type":"inject","z":"7e8bd831.628288","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":960,"wires":[["aee7989d.7dc658"]]},{"id":"aee7989d.7dc658","type":"function","z":"7e8bd831.628288","name":"Escreve lista","func":"var lista = global.get(\"listaordens\") || [];\nvar listaatual = flow.get('listaordens') || [];\nif (lista.length != listaatual.length || msg.payload === 'init' || msg.estado === 'init'){\n    flow.set('listaordens',lista)\n    msg.options = lista\n    return msg\n}","outputs":1,"noerr":0,"x":410,"y":960,"wires":[["72483862.dbaf08"]]},{"id":"72483862.dbaf08","type":"link out","z":"7e8bd831.628288","name":"listaOrdens","links":["92fadd66.5f0f6"],"x":555,"y":960,"wires":[]},{"id":"2c2649e1.e6e856","type":"link in","z":"7e8bd831.628288","name":"forçaAtualizaçãoLista","links":["2e604ed0.6b5042","4b1936f1.5af368"],"x":135,"y":1000,"wires":[["59b686bd.189088"]]},{"id":"690ba59e.6d714c","type":"cloudant in","z":"7e8bd831.628288","name":"Consulta ordens","cloudant":"90d07383.5a36","database":"listadeordem","service":"_ext_","search":"_all_","design":"","index":"","x":680,"y":1120,"wires":[["11e7f3c4.f34d0c","16b86065.b9f48"]]},{"id":"3a9d8a63.7b4fa6","type":"delay","z":"7e8bd831.628288","name":"Tempo","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":490,"y":1120,"wires":[["690ba59e.6d714c"]]},{"id":"c1c23124.e6ac","type":"comment","z":"7e8bd831.628288","name":"Após criar e encerrar atualiza lista ordens","info":"Após criar e encerrar atualiza lista ordens","x":280,"y":1060,"wires":[]},{"id":"5c833b86.93fa04","type":"link in","z":"7e8bd831.628288","name":"atulizaListaSKU","links":["2e604ed0.6b5042","92d37ef0.fc181"],"x":135,"y":1120,"wires":[["6fc912a0.419dfc"]]},{"id":"6fc912a0.419dfc","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":1120,"wires":[["3a9d8a63.7b4fa6"]]},{"id":"4b1936f1.5af368","type":"link out","z":"7e8bd831.628288","name":"estadoListaSKU","links":["2c2649e1.e6e856"],"x":1035,"y":1120,"wires":[]},{"id":"14d3f64b.fbc96a","type":"function","z":"49ecca28.ef9cc4","name":"Exec push","func":"var lista = msg.payload\nvar index = msg.payload.length\nmsg.payload = []\nfor (index in lista){\n    msg.payload.push(lista[index].payload.sku)\n}\nglobal.set(\"listasku\",msg.payload)\nmsg.estado = 'init';\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":360,"wires":[["52feb5a2.51737c"]]},{"id":"11e7f3c4.f34d0c","type":"function","z":"7e8bd831.628288","name":"Exec push","func":"var lista = msg.payload\nvar index = msg.payload.length\nmsg.payload = []\nfor (index in lista){\n    msg.payload.push(lista[index].payload.ordem)\n}\nglobal.set(\"listaordens\",msg.payload)\nmsg.estado = 'init';\nreturn msg;","outputs":1,"noerr":0,"x":890,"y":1120,"wires":[["4b1936f1.5af368"]]},{"id":"16b86065.b9f48","type":"function","z":"7e8bd831.628288","name":"Exec push ativos","func":"var lista = msg.payload\nvar index = msg.payload.length\nmsg.payload = []\nfor (index in lista){\n    if(lista[index].payload.estado === true){\n        msg.payload.push(lista[index].payload.sku)\n    }\n}\nglobal.set(\"listaskuativos\",msg.payload)\nmsg.estado = 'init';\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":1160,"wires":[[]]},{"id":"e4691c0a.dbb2a","type":"comment","z":"7e8bd831.628288","name":"Seleciona um SKU para deletar","info":"Seleciona um SKU para deletar","x":250,"y":1220,"wires":[]},{"id":"12be908d.0cfedf","type":"ui_dropdown","z":"7e8bd831.628288","name":"Droplist encerrar ordem","label":"Selecione uma ordem para encerrar","tooltip":"","place":"Selecione uma ordem","group":"bd160cb1.3394e","order":1,"width":0,"height":0,"passthru":false,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":310,"y":1280,"wires":[["95d68cc6.6d1fc"]]},{"id":"95d68cc6.6d1fc","type":"change","z":"7e8bd831.628288","name":"","rules":[{"t":"set","p":"encerrarOrdem","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":1280,"wires":[["2f99cdaf.2b9b42"]]},{"id":"92fadd66.5f0f6","type":"link in","z":"7e8bd831.628288","name":"atualizaListaOrdens","links":["72483862.dbaf08"],"x":135,"y":1280,"wires":[["12be908d.0cfedf"]]},{"id":"59b686bd.189088","type":"delay","z":"7e8bd831.628288","name":"Tempo","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":230,"y":1000,"wires":[["aee7989d.7dc658"]]},{"id":"2f99cdaf.2b9b42","type":"cloudant in","z":"7e8bd831.628288","name":"Consulta ordens","cloudant":"90d07383.5a36","database":"listadeordem","service":"_ext_","search":"_id_","design":"","index":"","x":840,"y":1280,"wires":[["101b1e91.4a7fa1"]]},{"id":"101b1e91.4a7fa1","type":"function","z":"7e8bd831.628288","name":"Traduz menssagem","func":"var item = msg.payload.payload;\nvar msg1 = {\"payload\": item.sku};\nvar msg2 = {\"payload\": item.ciclo};\nvar msg3 = {\"payload\": item.velocidade};\nvar msg4 = {\"payload\": item.tempo};\nvar msg5 = {\"payload\": item.data};\nreturn [msg1,msg2,msg3,msg4,msg5];\n","outputs":5,"noerr":0,"x":1070,"y":1280,"wires":[["5b666b45.b6cf04"],["d58084ec.cc5418"],["be2bd326.3b185"],["efa9ccb.950353"],["467339ed.fde998"]]},{"id":"5b666b45.b6cf04","type":"ui_text","z":"7e8bd831.628288","group":"bd160cb1.3394e","order":1,"width":0,"height":0,"name":"","label":"text213123","format":"{{msg.payload}}","layout":"row-spread","x":1290,"y":1140,"wires":[]},{"id":"d58084ec.cc5418","type":"ui_text","z":"7e8bd831.628288","group":"bd160cb1.3394e","order":1,"width":0,"height":0,"name":"","label":"text","format":"{{msg.payload}}","layout":"row-spread","x":1290,"y":1200,"wires":[]},{"id":"be2bd326.3b185","type":"ui_text","z":"7e8bd831.628288","group":"bd160cb1.3394e","order":1,"width":0,"height":0,"name":"","label":"text","format":"{{msg.payload}}","layout":"row-spread","x":1270,"y":1240,"wires":[]},{"id":"efa9ccb.950353","type":"ui_text","z":"7e8bd831.628288","group":"bd160cb1.3394e","order":1,"width":0,"height":0,"name":"","label":"text","format":"{{msg.payload}}","layout":"row-spread","x":1290,"y":1280,"wires":[]},{"id":"467339ed.fde998","type":"ui_text","z":"7e8bd831.628288","group":"bd160cb1.3394e","order":1,"width":0,"height":0,"name":"","label":"text","format":"{{msg.payload}}","layout":"row-spread","x":1290,"y":1320,"wires":[]},{"id":"ffa5832b.7115","type":"ui_ui_control","z":"49ecca28.ef9cc4","name":"","x":380,"y":1680,"wires":[[]]},{"id":"ed87949c.621e68","type":"comment","z":"49ecca28.ef9cc4","name":"Ui control para esconder e mostrar campos","info":"Try catch para erros do BD","x":280,"y":1560,"wires":[]},{"id":"57829c67.b67c24","type":"ui_button","z":"49ecca28.ef9cc4","name":"","group":"141a5297.cc40fd","order":3,"width":"4","height":"1","passthru":false,"label":"Criar SKU","tooltip":"","color":"","bgcolor":"{{background}}","icon":"","payload":"{\"group\":{\"hide\":[\"Receitas_Alterar_SKU\",\"Receitas_Deletar_SKU\"],\"show\":[\"Receitas_Criar_SKU\"]}}","payloadType":"json","topic":"","x":200,"y":1620,"wires":[["ffa5832b.7115"]]},{"id":"a61e586f.aebf98","type":"ui_button","z":"49ecca28.ef9cc4","name":"","group":"141a5297.cc40fd","order":5,"width":"4","height":"1","passthru":false,"label":"Alterar SKU","tooltip":"","color":"","bgcolor":"{{background}}","icon":"","payload":"{\"group\":{\"hide\":[\"Receitas_Criar_SKU\",\"Receitas_Deletar_SKU\"],\"show\":[\"Receitas_Alterar_SKU\"]}}","payloadType":"json","topic":"","x":190,"y":1680,"wires":[["ffa5832b.7115"]]},{"id":"a461117f.4ae3d","type":"ui_button","z":"49ecca28.ef9cc4","name":"","group":"141a5297.cc40fd","order":7,"width":"4","height":"1","passthru":false,"label":"Deletar SKU","tooltip":"","color":"","bgcolor":"{{background}}","icon":"","payload":"{\"group\":{\"hide\":[\"Receitas_Criar_SKU\",\"Receitas_Alterar_SKU\"],\"show\":[\"Receitas_Deletar_SKU\"]}}","payloadType":"json","topic":"","x":190,"y":1740,"wires":[["ffa5832b.7115"]]},{"id":"9f2000d2.14008","type":"ui_ui_control","z":"7e8bd831.628288","name":"","x":400,"y":1480,"wires":[[]]},{"id":"4976b4f7.e4ef5c","type":"comment","z":"7e8bd831.628288","name":"Ui control para esconder e mostrar campos","info":"Try catch para erros do BD","x":260,"y":1360,"wires":[]},{"id":"445f6d24.cf0504","type":"ui_button","z":"7e8bd831.628288","name":"","group":"3915cecb.4b6d32","order":3,"width":"10","height":"2","passthru":false,"label":"Abrir Ordem","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"hide\":[\"Ordem_Encerrar_ordem\"],\"show\":[\"Ordem_Abrir_ordem\"]}}","payloadType":"json","topic":"","x":210,"y":1440,"wires":[["9f2000d2.14008"]]},{"id":"2a711ab3.42df76","type":"ui_button","z":"7e8bd831.628288","name":"","group":"3915cecb.4b6d32","order":5,"width":"10","height":"2","passthru":false,"label":"Encerrar Ordem","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"hide\":[\"Ordem_Abrir_ordem\"],\"show\":[\"Ordem_Encerrar_ordem\"]}}","payloadType":"json","topic":"","x":200,"y":1500,"wires":[["9f2000d2.14008"]]},{"id":"52b75cfb.e3dd24","type":"ui_template","z":"b5ab8ba.7eb7578","group":"","name":"CSS","order":1,"width":0,"height":0,"format":"    <style>\n\n    body.nr-dashboard-theme {\n        background-color: #e9dfdf;\n        font-family: Arial;\n    }\n    button, html, input, select, textarea {\n        font-family: Arial;\n    }\n    body.nr-dashboard-theme md-content md-card {\n        background-color: #33333300;\n        color: #d0d0d0;\n    }\n\n    body.nr-dashboard-theme md-sidenav{\n        background-image: linear-gradient(to right, rgba(183,222,237,1) 0%, rgba(233,223,223,1) 100%);\n        font-family: Arial;;\n    }\n\n    body.nr-dashboard-theme md-list{\n        color: #707070;\n    }\n\n    body.nr-dashboard-theme .nr-menu-item-active {\n        color: rgb(55, 170, 216);\n    }\n\n    body.nr-dashboard-theme .md-list-item-inner{\n        background-image: linear-gradient(to right, rgba(183,222,237,1) 0%, rgba(233,223,223,1) 100%);\n    }\n\n    body.nr-dashboard-theme md-toolbar {\n        background-image: c;\n        box-shadow: 0px 1px 15px #000000;\n    }\n\n    body.nr-dashboard-theme md-toolbar .ng-binding {\n        color: black;\n    }\n\n    body.nr-dashboard-theme md-toolbar .ng-scope {\n        color: black;\n    }\n\n    .nr-dashboard-theme ui-card-panel {\n        background-image: linear-gradient(45deg, rgba(247,247,247,1) 0%, rgba(227,227,227,1) 51%, rgba(240,240,240,1) 74%, rgba(255,255,255,1) 100%);\n        border: 1px solid #555555;\n        box-shadow: 0 0 20px #00000066;\n    }\n\n    .nr-dashboard-theme ui-card-panel p.nr-dashboard-cardtitle {\n        width: 1000px;\n        height: 48px;\n        background-image: linear-gradient(to right, rgba(102,188,222,1) 0%, rgba(233,223,223,1) 100%);\n        border-radius: 20px 20px 20px 20px;\n        text-align: center;\n        box-shadow: 0px 0px 17px 1px rgba(0,0,0,0.75);\n        color: black;\n        text-shadow: 0 0 2px black;\n    }\n\n    .nr-dashboard-theme .nr-dashboard-form-button {\n        width: 210px;\n        height: 48px;\n        background-image: linear-gradient(to right, rgba(102,188,222,1) 0%, rgba(233,223,223,1) 100%);\n        color: #0a0a0a;\n        text-shadow: 0 0 2px #525252;\n        border-radius:6px;\n    }\n\n    .nr-dashboard-theme .nr-dashboard-form-button:hover {\n        background-image: linear-gradient(to right, rgb(0, 150, 209) 0%, rgb(179, 176, 176) 100%);;\n    }\n    \n    .nr-dashboard-theme .nr-dashboard-form-button:active {\n        background-image: linear-gradient(to right, rgb(0, 17, 255) 0%, rgb(179, 176, 176) 100%);;\n    }\n\n    .nr-dashboard-theme .nr-dashboard-button .md-button {\n        background-image: linear-gradient(to right, rgba(102,188,222,1) 0%, rgba(233,223,223,1) 100%);\n        color: #0a0a0a;\n        text-shadow: 0 0 2px #525252;\n        border-radius:6px;\n    }\n\n    .nr-dashboard-theme .nr-dashboard-button .md-button:hover {\n        background-image: linear-gradient(to right, rgb(0, 150, 209) 0%, rgb(179, 176, 176) 100%);;\n    }\n\n    .nr-dashboard-theme .nr-dashboard-button .md-button:active {\n        background-image: linear-gradient(to right, rgb(0, 17, 255) 0%, rgb(179, 176, 176) 100%);;\n    }\n\n    .nr-dashboard-theme .nr-dashboard-form md-switch .md-thumb {\n        background-image: linear-gradient(to bottom right, rgb(0, 17, 255), #115009);\n    }\n\n    .nr-dashboard-theme .nr-dashboard-switch md-switch .md-thumb {\n        background-image: linear-gradient(to bottom right, rgb(0, 17, 255), #115009);\n    }\n\n    .nr-dashboard-button .md-button {\n        box-shadow: 0 1px 3px 0 rgba(0,0,0,.26)!important;\n        width: 100%!important;\n        height: 100%!important;\n        margin: 0!important;\n        min-width: 0!important;\n        min-height: 0!important;\n    }\n    .nr-dashboard-theme .nr-dashboard-slider .md-thumb:after {\n        background-image: linear-gradient(to bottom right, #48b349, #115009);\n        border-style: none;\n    }\n    .nr-dashboard-theme .nr-dashboard-numeric .value {\n        background-color: #33333300;\n        color:#d0d0d0;\n    }\n\n    .nr-dashboard-numeric .value {\n        font-weight: 700;\n        text-align: center;\n        border: 0;\n    }\n\n    .nr-dashboard-form {\n        display: inline-block;\n        width: 100%;\n        overflow-y: visible;\n    }\n    #SETTINGS_TEATED_cards {\n        min-height: 260px;\n    }\n\n    </style>    <style>\n\n    body.nr-dashboard-theme {\n        background-color: #e9dfdf;\n        font-family: Arial;\n    }\n    button, html, input, select, textarea {\n        font-family: Arial;\n    }\n    body.nr-dashboard-theme md-content md-card {\n        background-color: #33333300;\n        color: #d0d0d0;\n    }\n\n    body.nr-dashboard-theme md-sidenav{\n        background-image: linear-gradient(to right, rgba(183,222,237,1) 0%, rgba(233,223,223,1) 100%);\n        font-family: Arial;;\n    }\n\n    body.nr-dashboard-theme md-list{\n        color: #707070;\n    }\n\n    body.nr-dashboard-theme .nr-menu-item-active {\n        color: rgb(55, 170, 216);\n    }\n\n    body.nr-dashboard-theme .md-list-item-inner{\n        background-image: linear-gradient(to right, rgba(183,222,237,1) 0%, rgba(233,223,223,1) 100%);\n    }\n\n    body.nr-dashboard-theme md-toolbar {\n        background-image: c;\n        box-shadow: 0px 1px 15px #000000;\n    }\n\n    body.nr-dashboard-theme md-toolbar .ng-binding {\n        color: black;\n    }\n\n    body.nr-dashboard-theme md-toolbar .ng-scope {\n        color: black;\n    }\n\n    .nr-dashboard-theme ui-card-panel {\n        background-image: linear-gradient(45deg, rgba(247,247,247,1) 0%, rgba(227,227,227,1) 51%, rgba(240,240,240,1) 74%, rgba(255,255,255,1) 100%);\n        border: 1px solid #555555;\n        box-shadow: 0 0 20px #00000066;\n    }\n\n    .nr-dashboard-theme ui-card-panel p.nr-dashboard-cardtitle {\n        width: 800px;\n        height: 48px;\n        background-image: linear-gradient(to right, rgba(102,188,222,1) 0%, rgba(233,223,223,1) 100%);\n        border-radius: 20px 20px 20px 20px;\n        text-align: center;\n        box-shadow: 0px 0px 17px 1px rgba(0,0,0,0.75);\n        color: black;\n        text-shadow: 0 0 2px black;\n    }\n\n    .nr-dashboard-theme .nr-dashboard-form-button {\n        width: 210px;\n        height: 48px;\n        background-image: linear-gradient(to right, rgba(102,188,222,1) 0%, rgba(233,223,223,1) 100%);\n        color: #0a0a0a;\n        text-shadow: 0 0 2px #525252;\n        border-radius:6px;\n    }\n\n    .nr-dashboard-theme .nr-dashboard-form-button:hover {\n        background-image: linear-gradient(to right, rgb(0, 150, 209) 0%, rgb(179, 176, 176) 100%);;\n    }\n    \n    .nr-dashboard-theme .nr-dashboard-form-button:active {\n        background-image: linear-gradient(to right, rgb(0, 17, 255) 0%, rgb(179, 176, 176) 100%);;\n    }\n\n    .nr-dashboard-theme .nr-dashboard-button .md-button {\n        background-image: linear-gradient(to right, rgba(102,188,222,1) 0%, rgba(233,223,223,1) 100%);\n        color: #0a0a0a;\n        text-shadow: 0 0 2px #525252;\n        border-radius:6px;\n    }\n\n    .nr-dashboard-theme .nr-dashboard-button .md-button:hover {\n        background-image: linear-gradient(to right, rgb(0, 150, 209) 0%, rgb(179, 176, 176) 100%);;\n    }\n\n    .nr-dashboard-theme .nr-dashboard-button .md-button:active {\n        background-image: linear-gradient(to right, rgb(0, 17, 255) 0%, rgb(179, 176, 176) 100%);;\n    }\n\n    .nr-dashboard-theme .nr-dashboard-form md-switch .md-thumb {\n        background-image: linear-gradient(to bottom right, rgb(0, 17, 255), #115009);\n    }\n\n    .nr-dashboard-theme .nr-dashboard-switch md-switch .md-thumb {\n        background-image: linear-gradient(to bottom right, rgb(0, 17, 255), #115009);\n    }\n\n    .nr-dashboard-button .md-button {\n        box-shadow: 0 1px 3px 0 rgba(0,0,0,.26)!important;\n        width: 100%!important;\n        height: 100%!important;\n        margin: 0!important;\n        min-width: 0!important;\n        min-height: 0!important;\n    }\n    .nr-dashboard-theme .nr-dashboard-slider .md-thumb:after {\n        background-image: linear-gradient(to bottom right, #48b349, #115009);\n        border-style: none;\n    }\n    .nr-dashboard-theme .nr-dashboard-numeric .value {\n        background-color: #33333300;\n        color:#d0d0d0;\n    }\n\n    .nr-dashboard-numeric .value {\n        font-weight: 700;\n        text-align: center;\n        border: 0;\n    }\n\n    .nr-dashboard-form {\n        display: inline-block;\n        width: 100%;\n        overflow-y: visible;\n    }\n    #SETTINGS_TEATED_cards {\n        min-height: 260px;\n    }\n\n    </style>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"global","x":130,"y":100,"wires":[[]]},{"id":"b9ca7a68.cc5b98","type":"comment","z":"b5ab8ba.7eb7578","name":"Inicialização do Tema","info":"Inicialização","x":180,"y":40,"wires":[]}]